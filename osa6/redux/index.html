<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/0.0d45a767add3d1210d1b.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);.element--flex{display:flex;flex-wrap:wrap}.element--space-around{justify-content:space-around}.element--space-between{justify-content:space-between}.element--column{flex-direction:column}.element--centered{align-items:center;justify-content:center!important}@media (min-width:992px){.element--centered-in-desktop{align-items:center;justify-content:center!important}}@media (min-width:992px){.element--horizontal-half{width:45%}}.element--auto-margin{margin:auto}.element--auto-bottom-margin{margin-bottom:auto}.element--flex-start{align-content:flex-start}.element--no-wrap{flex-wrap:nowrap}.element--relative{position:relative}.image__content{position:absolute;top:0;left:0;height:100%;width:100%;-o-object-fit:cover;object-fit:cover}.image--contain .image__content{-o-object-fit:contain;object-fit:contain}.image{border-radius:10px;overflow:hidden;width:100%;position:relative}@media (min-width:992px){.image{width:40%}}.image .image__container{height:0;position:relative;width:100%;padding-bottom:89.0625%}.image--circle{border-radius:50%}.image--circle .image__content{background-color:#e1e1e1}.image--square-big{width:100%}.image--square-big .image__container{width:100%;padding-bottom:100%}.image--extra-small{width:8%}.image--extra-small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--extra-small{width:calc(33.33333% - 1rem)}}.image--small{width:15%}.image--small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--small{width:calc(33.33333% - 1rem)}}.image--medium{width:50%}.image--medium .image__container{width:100%;padding-bottom:71.25%}.image--large{width:100%}@media (min-width:992px){.image--large{width:60%}}.image--large .image__container{padding-bottom:59.37%;width:100%}.image--full-width{width:100%}.image--full-width .image__container{padding-bottom:59.37%;width:100%}.image--actual-size{width:100%}.image--actual-size .image__container{height:0;position:relative;width:100%;padding-bottom:60%}html{font-family:IBM Plex Mono,monospace;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:IBM Plex Mono,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em IBM Plex Mono,monospace;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:IBM Plex Mono,monospace;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}body,html{margin:0;padding:0;font-family:IBM Plex Mono,monospace;font-weight:500;color:#33332d;font-size:14px;line-height:1.555rem}@media (min-width:992px){body,html{font-size:18px}}body{padding-top:80px}@media (min-width:992px){body{padding-top:2.055rem}}p{margin:0;text-align:left;line-height:1.5em}a,p{color:#33332d}a{text-decoration:none}.container{position:relative;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;width:90%;max-width:1200px}.container--right{margin-right:5%;width:54%;max-width:719.9856px}@media (min-width:1200px){.container--right{margin-right:calc((100% - 1200px)/2)}}.hidden{display:none!important}.centered{text-align:center}@media (max-width:639px){.centered--mobile{justify-content:center;align-content:center;align-items:center}}.spacing{margin-top:2rem}@media (min-width:992px){.spacing{margin-top:5rem}}.spacing--small{margin-top:1rem}@media (min-width:992px){.spacing--small{margin-top:3.444rem}}.spacing--large{margin-top:4rem}@media (min-width:992px){.spacing--large{margin-top:10rem}}.spacing--extra-large{margin-top:4rem}@media (min-width:992px){.spacing--extra-large{margin-top:20rem}}.spacing--after{margin-bottom:2rem}@media (min-width:992px){.spacing--after{margin-bottom:5rem}}@media (min-width:992px){.spacing--after-small{margin-bottom:2.5rem}}.spacing--after-large{margin-bottom:4rem}@media (min-width:992px){.spacing--after-large{margin-bottom:10rem}}@media (max-width:991px){.spacing--mobile{margin-top:2rem}}.col-1{width:100%}@media (min-width:992px){.col-1{width:10%}}.col-2{width:100%}@media (min-width:992px){.col-2{width:20%}}.col-3{width:100%}@media (min-width:992px){.col-3{width:30%}}.col-4{width:100%}@media (min-width:992px){.col-4{width:40%}}.col-5{width:100%}@media (min-width:992px){.col-5{width:50%}}.col-6{width:100%}@media (min-width:992px){.col-6{width:60%}}.col-7{width:100%}@media (min-width:992px){.col-7{width:70%}}.col-8{width:100%}@media (min-width:992px){.col-8{width:80%}}.col-9{width:100%}@media (min-width:992px){.col-9{width:90%}}.col-10{width:100%}@media (min-width:992px){.col-10{width:100%}}@media (min-width:992px){.push-right-1{margin-left:10%}.push-right-2{margin-left:20%}.push-right-3{margin-left:30%}.push-right-4{margin-left:40%}.push-right-5{margin-left:50%}.push-left-1{margin-right:10%}.push-left-2{margin-right:20%}.push-left-3{margin-right:30%}.push-left-4{margin-right:40%}.push-left-5{margin-right:50%}.push-left{margin-right:auto}.push-right{margin-left:auto}}@media (max-width:991px){.col-1--mobile{width:10%}.col-2--mobile{width:20%}.col-3--mobile{width:30%}.col-4--mobile{width:40%}.col-5--mobile{width:50%}.col-6--mobile{width:60%}.col-7--mobile{width:70%}.col-8--mobile{width:80%}.col-9--mobile{width:90%}.col-10--mobile{width:100%}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}.centered-vertically{display:flex;flex-direction:column;justify-content:center}.nav-item-hover{text-decoration:none;color:#33332d;font-weight:500;padding:.2em}@media (min-width:640px){.nav-item-hover{font-weight:600;font-size:1.111rem}}.nav-item-hover:active,.nav-item-hover:focus,.nav-item-hover:hover{color:#fff;background-color:#33332d}.nav-item-hover:active,.nav-item-hover:focus{outline:2px solid #706be4}.flex-fix-aligning:after,.flex-fix-aligning:before{content:"";width:30%;order:2}#footer .nav-item-hover{font-size:.777rem;font-weight:500}.index__main-title{font-size:1.571rem}@media (min-width:992px){.index__main-title{font-size:3rem}}.auto-bottom-margin{margin-bottom:auto}@media (min-width:992px){.absolute-top-right--desktop{position:absolute;top:0;right:0}}@media (min-width:640px){.frontpage__hero .image{top:-2em}}@media (min-width:992px){.frontpage__hero{flex-direction:column}.frontpage__hero .image{top:4em}}.header{position:fixed;z-index:200;top:0;transition:top .2s ease-in-out;box-sizing:border-box;width:100%;background-color:#fff;padding-top:1.444rem;padding-bottom:1rem;transition:all .2s ease-in-out}@media (min-width:992px){.navigation__wrapper{margin-left:auto}}.navigation{z-index:2;list-style:none;opacity:0;display:none;margin:0;padding:5%;flex-direction:column;justify-content:center;align-items:center;background:#e1e1e1;position:fixed;top:8%;right:5%;transition:opacity .3s ease-in-out;font-weight:200}@media (min-width:992px){.navigation{display:flex;opacity:1;font-weight:400;min-height:auto;width:auto;position:static;background:none;align-items:flex-start;justify-content:flex-start;overflow:hidden;flex-direction:row}}.navigation__toggle{z-index:3;position:absolute;top:0;right:0;width:50px;height:40px;cursor:pointer;border:none;background:none;outline:none;border-radius:4px}@media (min-width:992px){.navigation__toggle{display:none}}.navigation__mobile-logo{display:none}.navigation__toggle-icon{top:8px;left:10px}.navigation__toggle-icon,.navigation__toggle-icon:after,.navigation__toggle-icon:before{position:absolute;width:30px;height:3px;transition:all .3s ease;border-radius:4px;background-color:#33332d}.navigation__toggle-icon:after,.navigation__toggle-icon:before{content:"";display:block}.navigation__toggle-icon:before{top:10px}.navigation__toggle-icon:after{top:20px}.is-open--navigation{overflow:hidden}.is-open--navigation .navigation{opacity:1;display:unset}.is-open--navigation .navigation:before{content:"";background-color:#e1e1e1;position:absolute;width:25px;height:25px;top:-3px;right:13px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.is-open--navigation .navigation__mobile-logo{display:block;width:30px;height:30px;position:absolute;top:47px;left:5%}@media (min-width:992px){.is-open--navigation .navigation__mobile-logo{display:none}}.is-open--navigation .navigation__toggle-icon{-webkit-transform:translate3d(0,10px,0) rotate(45deg);transform:translate3d(0,10px,0) rotate(45deg)}.is-open--navigation .navigation__toggle-icon,.is-open--navigation .navigation__toggle-icon:after,.is-open--navigation .navigation__toggle-icon:before{background:#33332d}.is-open--navigation .navigation__toggle-icon:before{-webkit-transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);opacity:0}.is-open--navigation .navigation__toggle-icon:after{-webkit-transform:translate3d(0,-19px,0) rotate(-90deg);transform:translate3d(0,-19px,0) rotate(-90deg)}.navigation__item{margin:22px 0;white-space:nowrap}.navigation__item:first-of-type{margin:0 0 22px}.navigation__item:last-of-type{margin:22px 0 0}@media (min-width:992px){.navigation__item{margin:0 30px;padding:2;border:3px solid #fff}.navigation__item:first-of-type{margin:0 30px 0 0}.navigation__item:last-of-type{margin:0 0 0 30px}}.triple-border{position:relative;padding:2px;border-radius:5px 0;transition:color .1s ease-in-out,background-color .1s ease-in-out}.triple-border:after,.triple-border:before{content:"";border:2px solid #33332d;border-radius:5px;position:absolute;width:calc(100% + 5px);height:calc(100% + 5px)}.triple-border:before{left:0;top:0}.triple-border:after{bottom:0;right:0}.triple-border__container{overflow:hidden;border-radius:3px 0}.triple-border--large-margin{margin:13px;padding:3px}.triple-border--large-margin:after,.triple-border--large-margin:before{content:"";border-width:3px;border-radius:13px;width:calc(100% + 13px);height:calc(100% + 13px)}.triple-border--large-margin .triple-border__container{border-radius:10px 0}.triple-border__logo{padding:.2rem;font-size:1.111rem;font-weight:600}.triple-border__return-tasks{font-size:.9rem;padding:1rem .2rem}</style><style data-href="/app.f588656cc80a065e5f1e.css">code[class*=language-],pre[class*=language-]{color:#fff;background:none;text-shadow:0 -.1em .2em #000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#4d4033}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:.3em solid #7a6652;border-radius:.5em;box-shadow:inset 1px 1px .5em #000}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998066}.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#d1949e}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#bde052}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f5b83d}.token.atrule,.token.attr-value,.token.keyword{color:#d1949e}.token.important,.token.regex{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}</style><style data-href="/component---src-templates-content-template-js.460b1f1e29cfc2ab4416.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);.course{position:relative;width:100%}.course p{margin-left:3rem}.course p:not(:last-of-type){margin-bottom:1rem}.course h1,.course h2,.course h3,.course h4{margin-left:3rem;padding-bottom:2rem}.course h2:not(:first-of-type){margin-top:2rem}.course pre{margin:2rem 0;background-color:#33332d;color:#fff}.course em{font-family:Courier;font-style:normal;background-color:#e1e1e1;padding:1px 5px 2px}.course img{border:11px solid transparent}.course .banner,.course .container{position:static}.course .letter{width:4rem;height:4rem;border-width:5px;border-style:solid;border-radius:2.5rem;text-align:center;margin:1rem;line-height:.8em}@media (min-width:640px){.course .letter{-webkit-transform:translate(-3rem,5rem);transform:translate(-3rem,5rem)}}.course .letter,.course h1{font-size:3.444rem;font-weight:700}.course-content a,.tasks a{border:0;border-bottom-width:2px;border-style:solid;padding:2px}.tasks a{border-color:#33332d!important}.gatsby-highlight-code-line{background-color:hsla(0,0%,88.2%,.3);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em}code[class*=language-],pre[class*=language-]{text-shadow:none}.arrow-go-up{width:24px;height:24px;position:fixed;bottom:5%;right:5%;-webkit-transform:rotate(90deg);transform:rotate(90deg);z-index:99999;cursor:pointer}@media (max-width:639px){.arrow-go-up{display:none!important}}.arrow__container{position:relative}.arrow__container:not():first-child{border-left:none}.arrow__container:not():first-child:before{content:"";background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NzcuMTc1IDQ3Ny4xNzUiPjxwYXRoIGQ9Ik0zNjAuNzMxIDIyOS4wNzVsLTIyNS4xLTIyNS4xYy01LjMtNS4zLTEzLjgtNS4zLTE5LjEgMHMtNS4zIDEzLjggMCAxOS4xbDIxNS41IDIxNS41LTIxNS41IDIxNS41Yy01LjMgNS4zLTUuMyAxMy44IDAgMTkuMSAyLjYgMi42IDYuMSA0IDkuNSA0IDMuNCAwIDYuOS0xLjMgOS41LTRsMjI1LjEtMjI1LjFjNS4zLTUuMiA1LjMtMTMuOC4xLTE5eiIvPjwvc3ZnPg==) no-repeat;background-size:contain;position:absolute;top:0;left:0;height:100%;width:100%}.arrows--horizontal{display:flex;position:relative;margin:0;align-items:flex-start}.arrow__wrapper{display:flex;justify-content:flex-start;align-items:center;margin:0}.arrow__wrapper:first-of-type{border-right:none;z-index:20}.arrow__wrapper:nth-of-type(n+2){margin-left:-4rem;z-index:10}.arrow__wrapper:nth-of-type(n+2) .arrow__rectangle{border-left:none;padding-left:4rem}.arrow__wrapper:nth-of-type(3){z-index:5}.arrow__rectangle{padding:1rem;justify-content:center;align-items:center;border:2px solid #33332d;border-right:none;z-index:2;overflow:hidden}.arrow__rectangle .bold{font-weight:600}.arrow__rectangle--thick-border{border:3px solid #33332d;border-right:none}.arrow__point{padding:1.25rem;border:2px solid #33332d;border-bottom:none;border-left:none;-webkit-transform:translate(-1.3rem) rotate(45deg);transform:translate(-1.3rem) rotate(45deg);z-index:1;overflow:hidden}.arrow__point--thick-border{border:3px solid #33332d;border-bottom:none;border-left:none}.arrow__wrapper--stacked{display:flex;justify-content:flex-start;align-items:center;margin:auto auto auto 0}.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:-2px}.arrow--stacked-letter{margin-right:2rem}.arrow--stacked-title{text-transform:uppercase;white-space:nowrap}.arrow__container--with-link{width:100%!important}.banner{display:flex;width:100%;align-items:center;position:relative;padding:2rem 0;background-color:#e1e1e1}@media (min-width:992px){.banner{padding:3.444rem 3.444rem 4.444rem}}.edit-link{border-bottom-width:3px;border-bottom-style:solid}.body-text:not(:last-of-type){margin-bottom:2.5rem}.body-text__title{color:#33332d;font-size:1.44rem;line-height:1.25em;font-weight:700;margin:0;position:relative;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.body-text__content:not(:last-of-type){padding-bottom:2em}.bold{font-weight:700}.body-text--no-padding{padding:0!important}.scroll-navigation{padding-right:1rem;max-width:20%;position:-webkit-sticky;position:sticky;align-self:flex-start;left:20%;top:148px;z-index:9999}@media (max-width:991px){.scroll-navigation{display:none}}.scroll-navigation li{list-style-type:none}.scroll-navigation li:hover{cursor:pointer}.scroll-navigation li:hover a{background-color:#33332d;color:#fff!important}.scroll-navigation li:before{content:"-"}.left-navigation-link{padding-left:1.2rem;text-indent:-1.2rem}.left-navigation-link:hover{background-color:#33332d!important;color:#fff!important}.level-h1{font-weight:700;padding-left:2.8rem;text-indent:-2.8rem}.level-h2{padding-left:1.6rem;text-indent:-1.6rem}.accordion__container{margin-bottom:1rem}.accordion__title{padding-left:2.149rem!important;padding-right:2.149rem!important;font-size:1.111rem!important;font-weight:600}.accordion{background-color:#fff;border:3px solid #33332d;border-radius:5px;color:#444;cursor:pointer;padding:1rem;width:100%;text-align:left;outline:none;font-size:15px;transition:max-width .4s}.accordion:hover,.active{background-color:#ccc}.accordion:after{content:"\2795";font-size:1rem;color:#33332d;float:right;margin-left:5px}.active{border-color:#fff}.active:after{content:"\2796"}.panel{background-color:#fff;transition:height .3s;transition-timing-function:ease-in-out;overflow:hidden}.accordion--side-navigation{width:100%;margin-left:unset}.accordion--side-navigation .accordion{border:none;padding:0!important;background-color:transparent!important;color:#33332d!important;border-radius:0}.accordion--side-navigation .accordion__title{font-weight:unset;background-color:transparent}.accordion--side-navigation .accordion__title:hover{background-color:#33332d!important;color:#fff!important}.accordion--side-navigation .panel{padding:1rem 0 0!important;background-color:transparent}.accordion--side-navigation .accordion:hover,.accordion--side-navigation .active{background-color:#33332d;color:#fff}.accordion--side-navigation .accordion:after,.accordion--side-navigation .active:after{content:""}.sub-header{color:#33332d;font-family:IBM Plex Mono,monospace;padding-bottom:1.357rem}@media (min-width:992px){.sub-header{padding-bottom:2.333rem}}</style><meta name="generator" content="Gatsby 2.0.53"/><title data-react-helmet="true"></title><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/app-a3afcc3090199b7f6d12.js"/><link as="script" rel="preload" href="/component---src-templates-content-template-js-afce20df754b65dc684d.js"/><link as="script" rel="preload" href="/0-e4f4414306634f49516a.js"/><link as="script" rel="preload" href="/13-fc730b3ced992af1ecdc.js"/><link as="script" rel="preload" href="/2-59836067dfb7441ad4ca.js"/><link as="script" rel="preload" href="/webpack-runtime-1d00ecdb3155d0eb1b81.js"/><link rel="preload" href="/static/d/825/path---osa-6-redux-4-b-6-755-mcDSTnFJxYUKBICK87AnkIOK98.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="header "><div class="container" style="align-items:center"><a style="text-decoration:none" href="/"><div class="triple-border nav-item-hover " style="padding:0.2em"><div class="triple-border__container triple-border__logo" style="background-color:transparent">{() =&gt; fs}</div></div></a><div class="navigation__wrapper "><button aria-label="Navigation menu" aria-expanded="false" class="navigation__toggle"><div class="navigation__toggle-icon"></div></button><nav><ul class="navigation"><li class="navigation__item "><a class="nav-item-hover" href="/about">KURSSISTA</a></li><li class="navigation__item "><a class="nav-item-hover" href="/#course-contents">KURSSIN SISÄLTÖ</a></li><li class="navigation__item "><a class="nav-item-hover" href="/faq">FAQs</a></li></ul></nav></div></div></div><div class="arrow-go-up"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzEuNDk0IDMxLjQ5NCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzEuNDk0IDMxLjQ5NDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggc3R5bGU9ImZpbGw6IzFFMjAxRDsiIGQ9Ik0xMC4yNzMsNS4wMDljMC40NDQtMC40NDQsMS4xNDMtMC40NDQsMS41ODcsMGMwLjQyOSwwLjQyOSwwLjQyOSwxLjE0MywwLDEuNTcxbC04LjA0Nyw4LjA0N2gyNi41NTQNCgljMC42MTksMCwxLjEyNywwLjQ5MiwxLjEyNywxLjExMWMwLDAuNjE5LTAuNTA4LDEuMTI3LTEuMTI3LDEuMTI3SDMuODEzbDguMDQ3LDguMDMyYzAuNDI5LDAuNDQ0LDAuNDI5LDEuMTU5LDAsMS41ODcNCgljLTAuNDQ0LDAuNDQ0LTEuMTQzLDAuNDQ0LTEuNTg3LDBsLTkuOTUyLTkuOTUyYy0wLjQyOS0wLjQyOS0wLjQyOS0xLjE0MywwLTEuNTcxTDEwLjI3Myw1LjAwOXoiLz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjwvc3ZnPg0K" alt="arrow-up"/></div><div class="course-container spacing--small spacing--after"><div class="banner spacing--after" style="background-image:url(/static/part-6-d6924a30e54668b01a539aa7bc2db9e8.svg);background-position:center left;background-size:80%;background-repeat:no-repeat;background-color:#B795F3"><div class="container"><div class="col-10 spacing spacing--after"><div class="arrow__container arrows--horizontal"><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:#B795F3;color:black"><a href="/about">FULLSTACK</a></div><div class="arrow__point " style="background-color:#B795F3;color:black"></div></div><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:#B795F3;color:black"><a href="/osa6">OSA 6</a></div><div class="arrow__point " style="background-color:#B795F3;color:black"></div></div><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:black;color:white">REDUX</div><div class="arrow__point " style="background-color:black;color:white"></div></div></div></div></div></div><div class="course element--flex"><div class="scroll-navigation  element--flex element--column" tag="ul"><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  " style="background-color:#B795F3;border-color:#B795F3">a Redux</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><a class="left-navigation-link" style="border-color:#B795F3" href="/osa6/react_redux">b React+Redux</a><a class="left-navigation-link" style="border-color:#B795F3" href="/osa6/react">c React</a></div><div class="container container--right" style="margin-top:-0"><div class="course-content element--auto-bottom-margin"><p class="col-1 letter" style="border-color:#B795F3">a</p><h1 class="sub-header " style="font-size:3rem">Redux</h1></div></div><div class="container container--right"><div class="course-content">
<h2>Muistiinpano-sovelluksen refaktorointia</h2>
<p>Jatketaan osan 5 loppupuolella tehdyn muistiinpanosovelluksen yksinkertaistetun <a href="/osa5#redux-muistiinpanot">redux-version</a> laajentamista.</p>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part5-6">githubissa</a> tagissa <em>part5-6</em>.</p>
<p>Tehdään koodiin muutamia rakenteellisia muutoksia. Siirretään reducerin määrittelevä tiedosto <em>noteReducer.js</em> hakemistoon <em>src/reducers</em>.</p>
<p>Sovelluskehitystä helpottaaksemme laajennetaan reduceria siten, että storelle määritellään alkutila, jossa on pari muistiinpanoa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;reduxin storen toiminnan määrittelee reduceri&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;storen tilassa voi olla mielivaltaista dataa&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">noteReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> noteReducer<span class="token punctuation">;</span></code></pre></div>
<p>Siirretään <a href="https://redux.js.org/advanced/async-actions#synchronous-action-creators">action creatorit</a>, eli sopivia <a href="https://redux.js.org/basics/actions">action</a>-olioita generoivat apufunktiot reducerin kanssa samaan moduuliin:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;reduxin storen toiminnan määrittelee reduceri&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;storen tilassa voi olla mielivaltaista dataa&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">noteReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;NEW_NOTE&#x27;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;TOGGLE_IMPORTANCE&#x27;</span><span class="token punctuation">:</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> action<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
      <span class="token keyword">const</span> noteToChange <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> changedNote <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>noteToChange<span class="token punctuation">,</span>
        important<span class="token punctuation">:</span> <span class="token operator">!</span>noteToChange<span class="token punctuation">.</span>important<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>note<span class="token punctuation">.</span>id <span class="token operator">!==</span> id <span class="token operator">?</span> note <span class="token punctuation">:</span> changedNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">generateId</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">noteCreation</span> <span class="token operator">=</span> content <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&#x27;NEW_NOTE&#x27;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      content<span class="token punctuation">,</span>
      important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      id<span class="token punctuation">:</span> <span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">importanceToggling</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&#x27;TOGGLE_IMPORTANCE&#x27;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> noteReducer<span class="token punctuation">;</span></code></pre></div>
<p>Moduulissa on nyt useita <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export">export</a>-komentoja.</p>
<p>Reducer-funktio palautetaan edelleen komennolla <em>export default</em>. Tämän ansiosta reducer importataan (tiedostossa <em>index.js</em>) tuttuun tapaan:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> noteReducer <span class="token keyword">from</span> <span class="token string">&#x27;./reducers/noteReducer&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>Moduulilla voi olla vain <em>yksi default export</em>, mutta useita &quot;normaaleja&quot; exporteja, kuten <em>Action creator</em> -funktiot esimerkissämme</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">noteCreation</span> <span class="token operator">=</span> content <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">importanceToggling</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Normaalisti exportattujen funktioiden käyttöönotto tapahtuu aaltosulkusyntaksilla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> noteCreation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./../reducers/noteReducer&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-1">githubissa</a> tagissä <em>part6-1</em>.</p>
<h2>ESlint</h2>
<p>Konfiguroimme osassa 3 koodin tyylistä huolehtivan <a href="/osa3#lint">ESlintin</a> backendiin. Otetaan nyt ESlint käyttöön myös frontendissa.</p>
<p>Create-react-app on asentanut projektille eslintin valmiiksi, joten ei tarvita muuta kun sopiva konfiguraatio tiedoston <em>.eslintrc.js</em>.</p>
<p>Tiedoston voi generoida komennolla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">npx eslint --init</code></pre></div>
<p>ja vastailemalla sopivasti kysymyksiin:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/354495f1cf3ab7a581a690e6c465f45f/14be6/1a.png"/></picture>
<p>Jotta pääsemme eroon testeissä olevista turhista huomautuksista asennetaan <a href="https://www.npmjs.com/package/eslint-plugin-jest">eslint-jest-plugin</a></p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> add --save-dev eslint-plugin-jest</code></pre></div>
<p>ja otetaan se käyttöön manuaalin opastamalla tavalla.</p>
<p>Jos vastailit initialisoinnissa kysymyksiin kuvan osoittamalla tavalla, asentuu projektiin <a href="https://github.com/yannickcr/eslint-plugin-react">eslint-plugin-react</a>. Laajennetaan konfiguraatiota pluginin <a href="https://github.com/yannickcr/eslint-plugin-react#configuration">manuaalin</a> ohjeen mukaan.</p>
<p>Joudumme asentamaan myös <a href="https://github.com/babel/babel-eslint">babel-eslint</a>-pluginin, jotta ESlint osaisi tulkita koodissa käyttämäämme <em>class property</em> -syntaksia. Pluginin asennus tapahtuu komennolla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> babel-eslint --save-dev</code></pre></div>
<p>ja se tulee muistaa ottaa käyttöön konfiguraatiossa.</p>
<p>Seuraavassa lopullinen konfiguraatio, mihin on lisätty muutama muukin osassa 3 käyttöönotettu sääntö:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">module.exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;env&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;browser&quot;</span><span class="token keyword">:</span> true,
        <span class="token string">&quot;es6&quot;</span><span class="token keyword">:</span> true,
        <span class="token string">&quot;jest/globals&quot;</span><span class="token keyword">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;extends&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;eslint:recommended&quot;</span>,
        <span class="token string">&quot;plugin:react/recommended&quot;</span>
    <span class="token punctuation">]</span>,
    <span class="token string">&quot;parser&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;babel-eslint&quot;</span>,
    <span class="token string">&quot;parserOptions&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;ecmaFeatures&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;jsx&quot;</span><span class="token keyword">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ecmaVersion&quot;</span><span class="token keyword">:</span> 2018,
        <span class="token string">&quot;sourceType&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;module&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;plugins&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;react&quot;</span>, <span class="token string">&quot;jest&quot;</span>
    <span class="token punctuation">]</span>,
    <span class="token string">&quot;rules&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;indent&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;error&quot;</span>,
            2
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;linebreak-style&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;error&quot;</span>,
            <span class="token string">&quot;unix&quot;</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;quotes&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;error&quot;</span>,
            <span class="token string">&quot;single&quot;</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;semi&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;error&quot;</span>,
            <span class="token string">&quot;never&quot;</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;eqeqeq&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;error&quot;</span>,
        <span class="token string">&quot;no-trailing-spaces&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;error&quot;</span>,
        <span class="token string">&quot;object-curly-spacing&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;error&quot;</span>, <span class="token string">&quot;always&quot;</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;arrow-spacing&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;error&quot;</span>, <span class="token punctuation">{</span> <span class="token string">&quot;before&quot;</span><span class="token keyword">:</span> true, <span class="token string">&quot;after&quot;</span><span class="token keyword">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;no-console&quot;</span><span class="token keyword">:</span> 0,
        <span class="token string">&quot;react/prop-types&quot;</span><span class="token keyword">:</span> 0
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<h2>Monimutkaisempi tila storessa</h2>
<p>Toteutetaan sovellukseen näytettävien muistiinpanojen filtteröinti, jonka avulla näytettäviä muistiinpanoja voidaan rajata. Filtterin toteutus tapahtuu <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/radio">radiobuttoneiden</a> avulla:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/e3c779c1ee086430ef1ca18b298a87f1/14be6/1.png"/></picture>
<p>Aloitetaan todella suoraviivaisella toteutuksella:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  filterSelected = (value) =&gt; () =&gt; {
    console.log(value)
  }
  render() {
    return (
      &lt;div&gt;
        &lt;NoteForm /&gt;
        &lt;div&gt;
          kaikki    &lt;input type=&quot;radio&quot; name=&quot;filter&quot;
                      onChange={this.filterSelected(&#x27;ALL&#x27;)}/&gt;
          tärkeät   &lt;input type=&quot;radio&quot; name=&quot;filter&quot;
                      onChange={this.filterSelected(&#x27;IMPORTANT&#x27;)}/&gt;
          eitärkeät &lt;input type=&quot;radio&quot; name=&quot;filter&quot;
                      onChange={this.filterSelected(&#x27;NONIMPORTANT&#x27;)}/&gt;
        &lt;/div&gt;
        &lt;NoteList /&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Koska painikkeiden attribuutin <em>name</em> arvo on kaikilla sama, muodostavat ne <em>nappiryhmän</em>, joista ainoastaan yksi voi olla kerrallaan valittuna.</p>
<p>Napeille on määritelty muutoksenkäsittelijä, joka tällä hetkellä ainoastaan tulostaa painettua nappia vastaavan merkkijonon konsoliin.</p>
<p>Päätämme toteuttaa filtteröinnin siten, että talletamme muistiinpanojen lisäksi sovelluksen storeen myös <em>filtterin arvon</em>. Eli muutoksen jälkeen storessa olevan tilan tulisi näyttää seuraavalta:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> content<span class="token punctuation">:</span> <span class="token string">&#x27;reduxin storen toiminnan määrittelee reduceri&#x27;</span><span class="token punctuation">,</span> important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> content<span class="token punctuation">:</span> <span class="token string">&#x27;storen tilassa voi olla mielivaltaista dataa&#x27;</span><span class="token punctuation">,</span> important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  filter<span class="token punctuation">:</span> <span class="token string">&#x27;IMPORTANT&#x27;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Tällä hetkellähän tilassa on ainoastaan muistiinpanot sisältävä taulukko. Uudessa ratkaisussa tilalla on siis kaksi avainta, <em>notes</em> jonka arvona muistiinpanot ovat sekä <em>filter</em>, jonka arvona on merkkijono joka kertoo mitkä muistiinpanoista tulisi näyttää ruudulla.</p>
<h3>Yhdistetyt reducerit</h3>
<p>Voisimme periaatteessa muokata jo olemassaolevaa reduceria ottamaan huomioon muuttuneen tilanteen. Parempi ratkaisu on kuitenkin määritellä tässä tilanteessa uusi, filtterin arvosta huolehtiva reduceri:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> filterReducer <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;SET_FILTER&#x27;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>filter<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Filtterin arvon asettavat actionit ovat siis muotoa</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">&#x27;SET_FILTER&#x27;</span><span class="token punctuation">,</span>
  filter<span class="token punctuation">:</span> <span class="token string">&#x27;IMPORTANT&#x27;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Määritellään samalla myös sopiva <em>action creator</em> -funktio. Sijoitetaan koodi moduuliin <em>src/reducers/filterReducer.js</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> filterReducer <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">filterChange</span> <span class="token operator">=</span> filter <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&#x27;SET_FILTER&#x27;</span><span class="token punctuation">,</span>
    filter<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> filterReducer<span class="token punctuation">;</span></code></pre></div>
<p>Saamme nyt muodostettua varsinaisen reducerin yhdistämällä kaksi olemassaolevaa reduceria funktion <a href="https://redux.js.org/api-reference/combinereducers">combineReducers</a> avulla.</p>
<p>Määritellään yhdistetty reduceri tiedostossa <em>index.js</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import { createStore, combineReducers } from &#x27;redux&#x27;
import { Provider } from &#x27;react-redux&#x27;
import App from &#x27;./App&#x27;
import noteReducer from &#x27;./reducers/noteReducer&#x27;
import filterReducer from &#x27;./reducers/filterReducer&#x27;

const reducer = combineReducers({
  notes: noteReducer,
  filter: filterReducer
})

const store = createStore(reducer)

console.log(store.getState())

ReactDOM.render(
  &lt;Provider store={store}&gt;
    &lt;div&gt; &lt;/div&gt;
  &lt;/Provider&gt;,
document.getElementById(&#x27;root&#x27;))</code></pre></div>
<p>Koska sovelluksemme hajoaa tässä vaiheessa täysin, komponentin <em>App</em> sijasta renderöidään tyhjä <em>div</em>-elementti.</p>
<p>Konsoliin tulostuu storen tila:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/5051fd826fdf82f90e9326b9b2e82875/14be6/2.png"/></picture>
<p>eli store on juuri siinä muodossa missä haluammekin sen olevan!</p>
<p>Tarkastellaan vielä yhdistetyn reducerin luomista</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> noteReducer<span class="token punctuation">,</span>
  filter<span class="token punctuation">:</span> filterReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Näin tehdyn reducerin määrittelemän storen tila on olio, jossa on kaksi kenttää, <em>notes</em> ja <em>filter</em>. Tilan kentän <em>notes</em> arvon määrittelee <em>noteReducer</em>, jonka ei tarvitse välittää mitään tilan muista kentistä. Vastaavasti <em>filter</em> kentän käsittely tapahtuu <em>filterReducer</em>:in avulla.</p>
<p>Ennen muun koodin muutoksia, kokeillaan vielä konsolista, miten actionit muuttavat yhdistetyn reducerin muodostamaa staten tilaa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token comment">//...</span>
<span class="token keyword">import</span> noteReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> noteCreation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./reducers/noteReducer&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> filterReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> filterChange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./reducers/filterReducer&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> noteReducer<span class="token punctuation">,</span>
  filter<span class="token punctuation">:</span> filterReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">filterChange</span><span class="token punctuation">(</span><span class="token string">&#x27;IMPORTANT&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">noteCreation</span><span class="token punctuation">(</span><span class="token string">&#x27;combineReducers muodostaa yhdistetyn reducerin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Konsoliin tulostuu storen tila:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/83a1b076646fee2dc3280855e651286c/14be6/3.png"/></picture>
<p>Jo tässä vaiheessa kannattaa laittaa mieleen eräs tärkeä detalji. Jos lisäämme <em>molempien reducerien alkuun</em> konsoliin tulostuksen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> filterReducer <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ACTION: &#x27;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Näyttää konsolin perusteella siltä, että jokainen action kahdentuu:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/430abd5399e0ac8080e0d93a83683c41/14be6/4.png"/></picture>
<p>Onko koodissa bugi? Ei. Yhdistetty reducer toimii siten, että jokainen <em>action</em> käsitellään <em>kaikissa</em> yhdistetyn reducerin osissa. Usein tietystä actionista on kiinnostunut vain yksi reduceri, on kuitenkin tilanteita, joissa useampi reduceri muuttaa hallitsemaansa staten tilaa jonkin actionin seurauksena.</p>
<h3>Sovelluksen viimeistely</h3>
<p>Viimeistellään nyt sovellus käyttämään yhdistettyä reduceria, eli palautetaan tiedostossa <em>index.js</em> suoritettava renderöinti muotoon</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">ReactDOM.render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById(&#x27;root&#x27;))</code></pre></div>
<p>Korjataan sitten bugi, joka johtuu siitä, että koodi olettaa storen tilan olevan mustiinpanot tallettava taulukko:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/bdf7db7bc2a52ec058453dd1bf264eff/14be6/5.png"/></picture>
<p>Korjaus on helppo. Viitteen <code>this.context.store.getState()</code> sijaan kaikki muistiinpanot sisältävään taulukkoon viitataan <code>this.context.store.getState().notes</code>.</p>
<p>Ennakoiden tulevaa eriytetään näytettävien muistiinpanojen selvittämisen huolehtiminen funktioon <em>notesToShow</em>, joka vielä tässä vaiheessa palauttaa kaikki muistiinpanot:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class NoteList extends React.Component {
  // ...

  render() {
    const notesToShow = () =&gt; {
      return this.context.store.getState().notes
    }

    return (
      &lt;ul&gt;
        {notesToShow().map(note =&gt;
          &lt;Note
            key={note.id}
            note={note}
            handleClick={this.toggleImportance(note.id)}
          /&gt;
        )}
      &lt;/ul&gt;
    )
  }
}</code></pre></div>
<p>Eriytetään näkyvyyden säätelyfiltteri omaksi, tiedostoon sijoitettavaksi <em>src/components/VisibilityFilter.js</em> komponentiksi:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import PropTypes from &#x27;prop-types&#x27;
import { filterChange } from &#x27;../reducers/filterReducer&#x27;

class VisibilityFilter extends React.Component {
  componentDidMount() {
    const { store } = this.context
    this.unsubscribe = store.subscribe(() =&gt;
      this.forceUpdate()
    )
  }

  componentWillUnmount() {
    this.unsubscribe()
  }

  filterClicked = (value) =&gt; () =&gt; {
    this.context.store.dispatch(filterChange(value))
  }

  render() {
    return (
      &lt;div&gt;
        kaikki    &lt;input type=&quot;radio&quot; name=&quot;filter&quot; onChange={this.filterClicked(&#x27;ALL&#x27;)} /&gt;
        tärkeät   &lt;input type=&quot;radio&quot; name=&quot;filter&quot; onChange={this.filterClicked(&#x27;IMPORTANT&#x27;)} /&gt;
        eitärkeät &lt;input type=&quot;radio&quot; name=&quot;filter&quot; onChange={this.filterClicked(&#x27;NONIMPORTANT&#x27;)} /&gt;
      &lt;/div&gt;
    )
  }
}

VisibilityFilter.contextTypes = {
  store: PropTypes.object
}

export default VisibilityFilter</code></pre></div>
<p>Toteutus on suoraviivainen, radiobuttonin klikkaaminen muuttaa storen kentän <em>filter</em> tilaa.</p>
<p>Muutetaan vielä komponentin <em>NoteList</em> metodi <em>notesToShow</em> ottamaan huomioon filtteri</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">notesToShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> notes<span class="token punctuation">,</span> filter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>filter <span class="token operator">===</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> notes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> filter <span class="token operator">===</span> <span class="token string">&#x27;IMPORTANT&#x27;</span>
    <span class="token operator">?</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Huomaa miten storen tilan kentät on otettu tuttuun tapaan destrukturoimalla apumuuttujiin</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> notes<span class="token punctuation">,</span> filter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>siis on sama kuin kirjoittaisimme</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>notes<span class="token punctuation">;</span>
<span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">;</span></code></pre></div>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-2">githubissa</a> tagissä <em>part6-2</em>.</p>
<p>Sovelluksessa on vielä pieni kauneusvirhe, vaikka oletusarvosesti filtterin arvo on <em>ALL</em>, eli näytetään kaikki muistiinpanot, ei vastaava radiobutton ole valittuna. Ongelma on luonnollisestikin mahdollista korjata, mutta koska kyseessä on ikävä, mutta harmiton feature, jätämme korjauksen myöhemmäksi.</p>
<h2>Tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t/#osa-6">6.1-6.5</a></p>
<h2>Connect</h2>
<p>Kaikissa Redux-storea käyttävissä komponenteissa on runsaasti samaa koodia</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ComponentUsingReduxStore</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ComponentUsingReduxStore<span class="token punctuation">.</span>contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Vaikka rivit on helppo copy-pasteta aina uusiin komponentteihin, ei tämä ole tarkoituksenmukaista. Osan 5 luvussa <a href="/osa5#staten-v%C3%A4litt%C3%A4minen-propseissa-ja-contextissa">staten välittäminen propseissa ja contextissa</a> myös varoiteltiin luottamasta liikaa Reactin Context API:iin, se on kokeellinen ja saattaa poistua tulevissa versioissa. Contextia on siis ainakin tässä vaiheessa käytettävä varovasti.</p>
<p><a href="https://github.com/reactjs/react-redux">React Redux</a> -kirjaston määrittelemä funktio <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options">connect</a> on paras ratkaisu siihen, miten Redux-store saadaan välitettyä React-componenteille.</p>
<p>Connect voi olla aluksi haastava sisäistää, mutta hieman vaivaa kannattaa ehdottomasti nähdä. Tutustutaan nyt connectin käyttöön. Asensimme jo edellisessä osassa kirjaston, joten voimme aloittaa sen käytön suoraan.</p>
<p>Tutkitaan ensin komponenttia <em>NoteList</em>. Funktiota <em>connect</em> käyttämällä &quot;normaaleista&quot; React-komponenteista saadaan muodostettua komponentteja, joiden <em>propseihin</em> on &quot;mäpätty&quot; eli yhdistetty haluttuja osia storen määrittelemästä tilasta.</p>
<p>Muodostetaan ensin komponentista <em>NoteList</em> connectin avulla <em>yhdistetty komponentti</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-redux&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NoteList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ConnectedNoteList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NoteList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ConnectedNoteList<span class="token punctuation">;</span></code></pre></div>
<p>Moduuli eksporttaa nyt alkuperäisen komponentin sijaan <em>yhdistetyn komponentin</em>, joka toimii toistaiseksi täsmälleen alkuperäisen komponentin kaltaisesti.</p>
<p>Komponentti tarvitsee storesta sekä muistiinpanojen listan, että filtterin arvon. Funktion <em>connect</em> ensimmäisenä parametrina voidaan määritellä funktio <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#arguments">mapStateToProps</a>, joka liittää joitakin storen tilan perusteella määriteltyjä asioita connectilla muodostetun <em>yhdistetyn komponentin</em> propseiksi.</p>
<p>Jos määritellään:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    notes<span class="token punctuation">:</span> state<span class="token punctuation">.</span>notes<span class="token punctuation">,</span>
    filter<span class="token punctuation">:</span> state<span class="token punctuation">.</span>filter<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ConnectedNoteList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>NoteList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ConnectedNoteList<span class="token punctuation">;</span></code></pre></div>
<p>on komponentin <em>NoteList</em> sisällä mahdollista viitata storen tilaan, esim. muistiinpanoihin suoraan propsin kautta <em>props.notes</em> sen sijaan, että käytettäisiin suoraan contextia muodossa <em>this.context.store.getState().notes</em>. Vastaavasti <em>props.filter</em> viittaa storessa olevaan filter-kentän tilaan.</p>
<p>Metodin <em>render</em> sisältö pelkistyy seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NoteList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">notesToShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> notes<span class="token punctuation">,</span> filter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>filter <span class="token operator">===</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> notes<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> filter <span class="token operator">===</span> <span class="token string">&#x27;IMPORTANT&#x27;</span>
        <span class="token operator">?</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Connect-komennolla, ja <em>mapStateToProps</em>-määrittelyllä aikaan saatua tilannetta voidaan visualisoida seuraavasti:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/9b0db201aaba8e035a782f2f07364ab2/14be6/5b.png"/></picture>
<p>eli komponentin <em>NoteList</em> sisältä on propsien <em>props.notes</em> ja <em>props.filter</em> kautta &quot;suora pääsy&quot; tarkastelemaan Redux storen sisällä olevaa tilaa.</p>
<p><em>NoteList</em> viittaa edelleen suoraan kontekstin kautta storen metodiin <em>dispatch</em>, jota se tarvitsee action creatorin <em>importanceToggling</em> avulla tehdyn actionin dispatchaamiseen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">toggleImportance</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>
    <span class="token function">importanceToggling</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">)</span></code></pre></div>
<p>Connect-funktion toisena parametrina voidaan määritellä <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#arguments">mapDispatchToProps</a> eli joukko <em>action creator</em> -funktioita, jotka välitetään yhdistetylle komponentille propseina. Laajennetaan connectausta seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    notes<span class="token punctuation">:</span> state<span class="token punctuation">.</span>notes<span class="token punctuation">,</span>
    filter<span class="token punctuation">:</span> state<span class="token punctuation">.</span>filter<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  importanceToggling<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ConnectedNoteList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>NoteList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ConnectedNoteList<span class="token punctuation">;</span></code></pre></div>
<p>Nyt komponentti voi dispatchata suoraan action creatorin <em>importanceToggling</em> määrittelemän actionin kutsumalla propsien kautta saamaansa funktiota koodissa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NoteList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">toggleImportance</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">importanceToggling</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Storen <em>dispatch</em>-funktiota ei enää tarvitse kutsua, sillä <em>connect</em> on muokannut action creatorin <em>importanceToggling</em> sellaiseen muotoon, joka sisältää dispatchauksen.</p>
<p><em>mapDispatchToProps</em> lienee aluksi hieman haastava ymmärtää, etenkin sen kohta käsiteltävä <a href="/osa6/#mapdispatchtopropsin-vaihtoehtoinen-k%C3%A4ytt%C3%B6tapa">vaihtoehtoinen käyttötapa</a>.</p>
<p>Connectin aikaansaamaa tilannetta voidaan havainnollistaa seuraavasti:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/f41667cdd6a8f0dfb230ba0207d60a20/14be6/5c.png"/></picture>
<p>eli sen lisäksi että <em>NoteList</em> pääsee storen tilaan propsien <em>props.notes</em> ja <em>props.filter</em> kautta, se viittaa <em>props.importanceToggling</em>:lla funktioon, jonka avulla storeen saadaan dispatchattua <em>TOGGLE</em>IMPORTANCE_-tyyppisiä actioneja.</p>
<p>Koska komponentti saa storeen liittyvät asiat propseina, voidaan koodista poistaa metodit <em>componentDidMount</em> ja <em>componentWillUnMount</em> jotka huolehtivat komponentin uudelleenrenderöitymisestä storen tilan muuttuessa. Connect tekee tämän puolestamme.</p>
<p>Komponentti <em>NoteList</em> ei tarvitse storea enää mihinkään, se saa kaiken tarvitsemansa propseina <em>connect</em>-funktion ansiosta. Komponentti ei käytä enää suoraan contextia, joten koodi yksinkertaistuu seuraavaan muotoon:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import { connect } from &#x27;react-redux&#x27;
import { importanceToggling } from &#x27;./../reducers/noteReducer&#x27;
import Note from &#x27;./Note&#x27;

class NoteList extends React.Component {
  render() {
    const notesToShow = () =&gt; {
      const { notes, filter } = this.props
      if (filter === &#x27;ALL&#x27;) {
        return notes
      }

      return filter === &#x27;IMPORTANT&#x27;
        ? notes.filter(note =&gt; note.important)
        : notes.filter(note =&gt; !note.important)
    }

    return (
      &lt;ul&gt;
        {notesToShow().map(note =&gt;
          &lt;Note
            key={note.id}
            note={note}
            handleClick={() =&gt; this.props.importanceToggling(note.id)}
          /&gt;
        )}
      &lt;/ul&gt;
    )
  }
}

const mapStateToProps = (state) =&gt; {
  return {
    notes: state.notes,
    filter: state.filter
  }
}

const ConnectedNoteList = connect(
  mapStateToProps,
  { importanceToggling }
)(NoteList)

export default ConnectedNoteList</code></pre></div>
<p>Koodi sisältää pari muutakin oikaisua, mm. apumetodista <em>toggleImportance</em> on hankkiuduttu eroon.
Itseasiassa komponentti on nyt niin yksinkertainen että se voitaisiin määritellä funktionaalisena komponenttina. Emme kuitenkaan tee muutosta nyt.</p>
<p>Otetaan <em>connect</em> käyttöön myös uuden muistiinpanon luomisessa:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import { noteCreation } from &#x27;./../reducers/noteReducer&#x27;
import { connect } from &#x27;react-redux&#x27;

class NoteForm extends React.Component {

  addNote = (event) =&gt; {
    event.preventDefault()
    this.props.noteCreation(event.target.note.value)
    event.target.note.value = &#x27;&#x27;
  }

  render() {
    return (
      &lt;form onSubmit={this.addNote}&gt;
        &lt;input name=&quot;note&quot; /&gt;
        &lt;button&gt;lisää&lt;/button&gt;
      &lt;/form&gt;
    )
  }
}

export default connect(
  null,
  { noteCreation }
)(NoteForm)</code></pre></div>
<p>Koska komponentti ei tarvitse storen tilasta mitään, on funktion <em>connect</em> ensimmäinen parametri <em>null</em>.</p>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-3">githubissa</a> tagissä <em>part6-3</em>.</p>
<h3>Provider</h3>
<p>Funktion <em>connect</em> käytön edellytyksenä on se, että sovellus on määritelty React redux kirjaston tarjoaman <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#provider-store">Provider</a>-komponentin lapseksi ja että sovelluksen käyttämä store on annettu Provider-komponentin attribuutiksi <em>store</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import { createStore, combineReducers } from &#x27;redux&#x27;
import { Provider } from &#x27;react-redux&#x27;
import App from &#x27;./App&#x27;
import noteReducer from &#x27;./reducers/noteReducer&#x27;
import filterReducer from &#x27;./reducers/filterReducer&#x27;

const reducer = combineReducers({
  notes: noteReducer,
  filter: filterReducer
})

const store = createStore(reducer)

ReactDOM.render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById(&#x27;root&#x27;))</code></pre></div>
<p>Lisäsimme jo edellisen osan lopussa sovellukseen <em>Providerin</em>, joten <em>connect</em> oli tällä kertaa suoraan käytettävissä.</p>
<h3>Huomio propsina välitettyyn action creatoriin viittaamisesta</h3>
<p>Tarkastellaan vielä erästä mielenkiintoista seikkaa komponentista <em>NoteForm</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import { noteCreation } from &#x27;./../reducers/noteReducer&#x27;
import { connect } from &#x27;react-redux&#x27;

class NoteForm extends React.Component {

  addNote = (event) =&gt; {
    event.preventDefault()
    this.props.noteCreation(event.target.note.value)
    event.target.note.value = &#x27;&#x27;
  }

  render() {
    // ...
  }
}

export default connect(
  null,
  { noteCreation }
)(NoteForm)</code></pre></div>
<p>Aloittelevalle connectin käyttäjälle aiheuttaa joskus ihmetystä se, että action creatorista <em>noteCreation</em> on komponentin sisällä käytettävissä <em>kaksi eri versiota</em>.</p>
<p>Funktioon tulee viitata propsien kautta, eli <em>this.props.noteCreation</em>, tällöin kyseessä on <em>connectin</em> muotoilema, <em>dispatchauksen sisältävä</em> versio funktiosta.</p>
<p>Moduulissa olevan import-lauseen</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> noteCreation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./../reducers/noteReducer&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>ansiosta komponentin sisältä on mahdollista viitata funktioon myös suoraan, eli <em>noteCreation</em>. Näin ei kuitenkaan tule tehdä, sillä silloin on kyseessä alkuperäinen action creator joka <em>ei sisällä dispatchausta</em>.</p>
<p>Jos tulostamme funktiot koodin sisällä (emme olekaan vielä käyttäneet kurssilla tätä erittäin hyödyllistä debug-kikkaa)</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">render() {
  console.log(noteCreation)
  console.log(this.props.noteCreation)
  return (
    &lt;form onSubmit={this.addNote}&gt;
      &lt;input name=&quot;note&quot; /&gt;
      &lt;button&gt;lisää&lt;/button&gt;
    &lt;/form&gt;
  )
}</code></pre></div>
<p>näemme eron:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/eb383dd9fbafd64a8231aae424434fee/14be6/5d.png"/></picture>
<p>Ensimmäinen funktioista siis on normaali <em>action creator</em>, toinen taas connectin muotoilema funktio, joka sisältää storen metodin dispatch-kutsun.</p>
<p>Connect on erittäin kätevä työkalu, mutta abstraktiutensa takia kenties käsitteellisesti haastavin kurssin tähänastisista asioista.</p>
<p>Viimeistään nyt kannattaa katsoa kokonaisuudessaan Egghead.io:ta Reduxin kehittäjän Dan Abramovin loistava tuoriaali <a href="https://egghead.io/courses/getting-started-with-redux">Getting started with Redux</a>. Neljässä viimeisessä videossa käsitellään <em>connect</em>-metodia.</p>
<p>Siinä vaiheessa kun videot on tehty, connectin käyttö oli asteen verran nykyistä hankalampaa, sillä esimerkeissä käyttämämme tapa määritellä connectin toinen parametri <em>mapDispatchToProps</em> suoraan <em>action creator</em> -funktioiden avulla ei ollut vielä mahdollinen. Katsotaan seuraavassa luvussa lyhyesti vaihtoehtoista, &quot;hankalampaa&quot; tapaa, sitä näkee usein vanhemmassa React-koodissa, joten sen tunteminen on oleellista.</p>
<h3>mapDispatchToPropsin vaihtoehtoinen käyttötapa</h3>
<p>Määrittelimme siis connectin komponentille <em>NoteForm</em> antamat actioneja dispatchaavan funktion seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NoteForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> noteCreation <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>NoteForm<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Eli määrittelyn ansiosta komponentti dispatchaa uuden muistiinpanon lisäyksen suorittavan actionin suoraan komennolla <code>this.props.noteCreation(&#x27;uusi muistiinpano&#x27;)</code>.</p>
<p>Parametrin <em>mapDispatchToProps</em> kenttinä ei voi antaa mitä tahansa funktiota, vaan funktion on oltava <em>action creator</em>, eli Redux-actionin palauttava funktio.</p>
<p>Kannattaa huomata, että parametri <em>mapDispatchToProps</em> on nyt <em>olio</em>, sillä määrittely</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">{</span>
  noteCreation<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>on lyhempi tapa määritellä olioliteraali</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">{</span>
  noteCreation<span class="token punctuation">:</span> noteCreation<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>eli olio, jonka ainoan kentän <em>noteCreation</em> arvona on funktio <em>noteCreation</em>.</p>
<p>Voimme määritellä saman myös &quot;pitemmän kaavan&quot; kautta, antamalla <em>connectin</em> toisena parametrina seuraavanlaisen <em>funktion</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NoteForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> dispatch <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    createTodo<span class="token punctuation">:</span> value <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">noteCreation</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  <span class="token keyword">null</span><span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>NoteForm<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tässä vaihtoehtoisessa tavassa <em>mapDispatchToProps</em> on funktio, jota <em>connect</em> kutsuu antaen sille parametriksi storen <em>dispatch</em>-funktion. Funktion paluuarvona on olio, joka määrittelee joukon funktioita, jotka annetaan connectoitavalle komponentille propsiksi. Esimerkkimme määrittelee propsin <em>createTodo</em> olevan funktion</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">value <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">noteCreation</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>eli action creatorilla luodun actionin dispatchaus.</p>
<p>Komponentti siis viittaa funktioon propsin <em>this.props.createTodo</em> kautta:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class NoteForm extends React.Component {

  addNote = (event) =&gt; {
    event.preventDefault()
    this.props.createTodo(event.target.note.value)
    event.target.note.value = &#x27;&#x27;
  }

  render() {
    return (
      &lt;form onSubmit={this.addNote}&gt;
        &lt;input name=&quot;note&quot; /&gt;
        &lt;button&gt;lisää&lt;/button&gt;
      &lt;/form&gt;
    )
  }
}</code></pre></div>
<p>Konsepti on hiukan monimutkainen ja sen selittäminen sanallisesti on haastavaa. Kannattaa katsoa huolellisesti Dan Abramovin videot ja koittaa miettiä mistä on kyse.</p>
<p>Useimmissa tapauksissa riittää <em>mapDispatchToProps</em>:in yksinkertaisempi muoto. On kuitenkin tilanteita, joissa monimutkaisempi muoto on tarpeen, esim. jos määriteltäessä propseiksi mäpättyjä <em>dispatchattavia actioneja</em> on <a href="https://github.com/gaearon/redux-devtools/issues/250#issuecomment-186429931">viitattava komponentin omiin propseihin</a>.</p>
<h2>Presentational/Container revisited</h2>
<p>Komponentti <em>NoteList</em> käyttää apumetodia <em>notesToShow</em>, joka päättelee filtterin perusteella näytettävien muistiinpanojen listan:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">notesToShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> notes<span class="token punctuation">,</span> filter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>filter <span class="token operator">===</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> notes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> filter <span class="token operator">===</span> <span class="token string">&#x27;IMPORTANT&#x27;</span>
    <span class="token operator">?</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Komponentin on tarpeetonta sisältää kaikkea tätä logiikkaa. Eriytetään se komponentin ulkopuolelle <em>connect</em>-metodin parametrin <em>mapStateToProps</em> yhteyteen. Muutetaan komponentti samalla funktionaaliseksi:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import { connect } from &#x27;react-redux&#x27;
import { importanceToggling } from &#x27;./../reducers/noteReducer&#x27;
import Note from &#x27;./Note&#x27;

const NoteList = (props) =&gt; (
  &lt;ul&gt;
    {props.visibleNotes.map(note =&gt;
      &lt;Note
        key={note.id}
        note={note}
        handleClick={() =&gt; props.importanceToggling(note.id)}
      /&gt;
    )}
  &lt;/ul&gt;
)

const notesToShow = (notes, filter) =&gt; {
  if (filter === &#x27;ALL&#x27;) {
    return notes
  }
  return filter === &#x27;IMPORTANT&#x27;
    ? notes.filter(note =&gt; note.important)
    : notes.filter(note =&gt; !note.important)
}

const mapStateToProps = (state) =&gt; {
  return {
    visibleNotes: notesToShow(state.notes, state.filter)
  }
}

export default connect(
  mapStateToProps,
  { importanceToggling }
)(NoteList)</code></pre></div>
<p><em>mapStateToProps</em> ei siis tällä kertaa mäppää propsiksi suoraan storessa olevaa asiaa, vaan storen tilasta funktion <em>notesToShow</em> avulla muodostetun sopivasti filtteröidyn datan.</p>
<p>Uudistettu <em>NoteList</em> keskittyy lähes ainoastaan muistiinpanojen renderöimiseen, se on hyvin lähellä sitä minkä sanotaan olevan <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">presentational</a>-komponentti, joita Dan Abramovin <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">sanoin</a> kuvailee seuraavasti:</p>
<ul>
<li>Are concerned with how things look.</li>
<li>May contain both presentational and container components inside, and usually have some DOM markup and styles of their own.</li>
<li>Often allow containment via this.props.children.</li>
<li>Have no dependencies on the rest of the app, such Redux actions or stores.</li>
<li>Don’t specify how the data is loaded or mutated.</li>
<li>Receive data and callbacks exclusively via props.</li>
<li>Rarely have their own state (when they do, it’s UI state rather than data).</li>
<li>Are written as functional components unless they need state, lifecycle hooks, or performance optimizations.</li>
</ul>
<p>Connect-metodin avulla muodostettu <em>yhdistetty komponentti</em></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">notesToShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span>notes<span class="token punctuation">,</span> filter<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>filter <span class="token operator">===</span> <span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> notes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> filter <span class="token operator">===</span> <span class="token string">&#x27;IMPORTANT&#x27;</span>
    <span class="token operator">?</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    visibleNotes<span class="token punctuation">:</span> <span class="token function">notesToShow</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">,</span> state<span class="token punctuation">.</span>filter<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> importanceToggling <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>NoteList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>taas on selkeästi <em>container</em>-komponentti, joita Dan Abramov <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">luonnehtii</a> seuraavasti:</p>
<ul>
<li>Are concerned with how things work.</li>
<li>May contain both presentational and container components inside but usually don’t have any DOM markup of their own except for some wrapping divs, and never have any styles.</li>
<li>Provide the data and behavior to presentational or other container components.</li>
<li>Call Redux actions and provide these as callbacks to the presentational components.</li>
<li>Are often stateful, as they tend to serve as data sources.</li>
<li>Are usually generated using higher order components such as connect from React Redux, rather than written by hand.</li>
</ul>
<p>Komponenttien presentational vs. container -jaottelu on eräs hyväksi havaittu tapa strukturoida React-sovelluksia. Jako voi olla toimiva tai sitten ei, kaikki riippuu kontekstista.</p>
<p>Abramov mainitsee jaon <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">eduiksi</a> muunmuassa seuraavat</p>
<ul>
<li>Better separation of concerns. You understand your app and your UI better by writing components this way.</li>
<li>Better reusability. You can use the same presentational component with completely different state sources, and turn those into separate container components that can be further reused.</li>
<li>Presentational components are essentially your app’s “palette”. You can put them on a single page and let the designer tweak all their variations without touching the app’s logic. You can run screenshot regression tests on that page.</li>
</ul>
<p>Abramov mainitsee termin <a href="https://reactjs.org/docs/higher-order-components.html">high order component</a>. Esim. <em>NoteList</em> on normaali komponentti, React-reduxin <em>connect</em> metodi taas on <em>high order komponentti</em>, eli käytännössä funktio, joka haluaa parametrikseen komponentin muuttuakseen &quot;normaaliksi&quot; komponentiksi.</p>
<p>High order componentit eli HOC:t ovatkin yleinen tapa määritellä geneeristä toiminnallisuutta, joka sitten erikoistetaan esim. renderöitymisen määrittelyn suhteen parametrina annettavan komponentin avulla. Kyseessä on funktionaalisen ohjelmoinnin etäisesti olio-ohjelmoinnin perintää muistuttava käsite.</p>
<p>HOC:it ovat oikeastaan käsitteen <a href="https://en.wikipedia.org/wiki/Higher-order_function">High Order Function</a> (HOF) yleistys. HOF:eja ovat sellaiset funkiot, jotka joko ottavat parametrikseen funktioita tai palauttavat funkioita. Olemme oikeastaan käyttäneet HOF:eja läpi kurssin, esim. lähes kaikki taulukoiden käsittelyyn tarkoitetut metodit, kuten <em>map, filter ja find</em> ovat HOF:eja, samoin jo monta kertaa käyttämämme funktioita palauttavat (eli kahden nuolen) funktiot, esim.</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">filterClicked</span> <span class="token operator">=</span> value <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">filterChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-4">githubissa</a> tagissa <em>part6-4</em>.</p>
<p>Mukana on myös edellisestä unohtunut <em>VisibilityFilter</em>-komponentin <em>connect</em>-funktiota käyttävä versio, jota on myös paranneltu siten, että nappi <em>kaikki</em> on oletusarvoisesti valittuna. Koodissa on pieni ikävä copypaste mutta kelvatkoon.</p>
<h2>Tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#connect">6.6-6.9</a></p>
<h2>Redux-sovelluksen kommunikointi palvelimen kanssa</h2>
<p>Laajennetaan sovellusta siten, että muistiinpanot talletetaan backendiin. Käytetään osasta 2 tuttua <a href="/osa2#datan-haku-palvelimelta">json-serveriä</a>.</p>
<p>Tallennetaan projektin juuren tiedostoon <em>db.json</em> tietokannan alkutila:</p>
<div class="gatsby-highlight" data-language="json"><pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;notes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;reduxin storen toiminnan määrittelee reduceri&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;important&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;storen tilassa voi olla mielivaltaista dataa&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;important&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Asennetaan projektiin json-server</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> json-server --save</code></pre></div>
<p>ja lisätään tiedoston <em>package.json</em> osaan <em>scripts</em> rivi</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token string">&quot;scripts&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;server&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;json-server -p3001 db.json&quot;</span>,
  // <span class="token punctuation">..</span>.
<span class="token punctuation">}</span></code></pre></div>
<p>Käynnistetään json-server komennolla <em>npm run server</em>.</p>
<p>Tehdään sitten tuttuun tapaan <em>axiosia</em> hyödyntävä backendistä dataa hakeva metodi tiedostoon <em>services/notes.js</em></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#x27;axios&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getAll <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> getAll <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Asennetaan myös axios projektiin</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> axios --save</code></pre></div>
<p>Muutetaan <em>nodeReducer</em>:issa tapahtuva muistiinpanojen tilan alustusta, siten että oletusarvoisesti mustiinpanoja ei ole:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">noteReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Nopea tapa saada storen tila alustettua palvelimella olevan datan perusteella on hakea muistiinpanot tiedostossa <em>index.js</em> ja dispatchata niille yksitellen action <em>NEW</em>NOTE_:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">import</span> noteService <span class="token keyword">from</span> <span class="token string">&#x27;./services/notes&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> noteReducer<span class="token punctuation">,</span>
  filter<span class="token punctuation">:</span> filterReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span>
  notes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&#x27;NEW_NOTE&#x27;</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> note <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span></code></pre></div>
<p>Lisätään reduceriin tuki actionille <em>INIT</em>NOTES<em>, jonka avulla alustus voidaan tehdä dispatchaamalla yksittäinen action. Luodaan myös sitä varten oma action creator -funktio _noteInitialization</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token function-variable function">noteReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ACTION:&#x27;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;NEW_NOTE&#x27;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;INIT_NOTES&#x27;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">noteInitialization</span> <span class="token operator">=</span> data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&#x27;INIT_NOTES&#x27;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span></code></pre></div>
<p><em>index.js</em> yksinkertaistuu:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> noteReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> noteInitialization <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./reducers/noteReducer&#x27;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">noteInitialization</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<blockquote>
<p><strong>HUOM:</strong> miksi emme käyttäneet koodissa promisejen ja <em>then</em>-metodilla rekisteröidyn tapahtumankäsittelijän sijaan awaitia?</p>
<p>await toimii ainoastaan <em>async</em>-funktioiden sisällä, ja <em>index.js</em>:ssä oleva koodi ei ole funktiossa, joten päädyimme tilanteen yksinkertaisuuden takia tällä kertaa jättämään <em>async</em>:in käyttämättä.</p>
</blockquote>
<p>Päätetään kuitenkin siirtää muistiinpanojen alustus <em>App</em>-komponentin metodiin <em><a href="https://reactjs.org/docs/react-component.html#componentdidmount">componentDidMount</a></em>, se on luonteva paikka alustuksille, sillä metodi suoritetaan heti sovelluksemme ensimmäisen renderöinnin jälkeen.</p>
<p>Jotta saamme action creatorin <em>noteInitialization</em> käyttöön komponentissa <em>App</em> tarvitsemme jälleen <em>connect</em>-metodin apua:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import NoteForm from &#x27;./components/NoteForm.js&#x27;
import NoteList from &#x27;./components/NoteList.js&#x27;
import VisibilityFilter from &#x27;./components/VisibilityFilter&#x27;
import { connect } from &#x27;react-redux&#x27;
import { noteInitialization } from &#x27;./reducers/noteReducer&#x27;
import noteService from &#x27;./services/notes&#x27;

class App extends React.Component {
  componentDidMount = async () =&gt; {
    const notes = await noteService.getAll()
    this.props.noteInitialization(notes)
  }

  render() {
    return (
      &lt;div&gt;
        &lt;NoteForm /&gt;
        &lt;VisibilityFilter /&gt;
        &lt;NoteList /&gt;
      &lt;/div&gt;
    )
  }
}

export default connect(
  null,
  { noteInitialization }
)(App)</code></pre></div>
<p>Näin funktio <em>noteInitialization</em> tulee komponentin <em>App</em> propsiksi <em>this.props.noteInitialization</em> ja sen kutsumiseen ei tarvita <em>dispatch</em>-metodia koska <em>connect</em> hoitaa asian puolestamme.</p>
<p>Pääsimme nyt myös käyttämään aina mukavaa async/awaitia. Palvelimen kanssa kommunikointi tapahtuu joka tapauksessa funktiossa, joten sen määrittely asyncina on vaivatonta:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">componentDidMount <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">await</span> noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">noteInitialization</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Voimme toimia samoin myös uuden muistiinpanon luomisen suhteen. Laajennetaan palvelimen kanssa kommunikoivaa koodia:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getAll <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> createNew <span class="token operator">=</span> <span class="token keyword">async</span> content <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> content<span class="token punctuation">,</span> important<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  getAll<span class="token punctuation">,</span>
  createNew<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Komponentin <em>NoteForm</em> metodi <em>addNote</em> muuttuu hiukan:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import { noteCreation } from &#x27;./../reducers/noteReducer&#x27;
import { connect } from &#x27;react-redux&#x27;
import noteService from &#x27;../services/notes&#x27;

class NoteForm extends React.Component {

  addNote = async (event) =&gt; {
    event.preventDefault()
    const content = event.target.note.value
    event.target.note.value = &#x27;&#x27;
    const newNote = await noteService.createNew(content)
    this.props.noteCreation(newNote)
  }

  render() {
    //...
  }
}

export default connect(
  null,
  {noteCreation}
)(NoteForm)</code></pre></div>
<p>Koska backend generoi muistiinpanoille id:t, muutetaan action creator <em>noteCreation</em> muotoon</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">noteCreation</span> <span class="token operator">=</span> data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&#x27;NEW_NOTE&#x27;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Muistiinpanojen tärkeyden muuttaminen olisi mahdollista toteuttaa samalla periaatteella, eli tehdä palvelimelle ensin asynkroninen metodikutsu ja sen jälkeen dispatchata sopiva action.</p>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-5">githubissa</a> tagissä <em>part6-5</em>.</p>
<h2>Tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#redux-ja-backend">6.10-6.12</a></p>
<h3>Asynkroniset actionit ja redux thunk</h3>
<p>Lähestymistapamme on ok, mutta siinä mielessä ikävä, että palvelimen kanssa kommunikointi tapahtuu komponenttien metodeissa. Olisi parempi, jos kommunikointi voitaisiin abstrahoida komponenteilta siten, että niiden ei tarvitsisi kuin kutsua sopivaa <em>action creatoria</em>, esim. <em>App</em> alustaisi sovelluksen tilan seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">initializeNotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ja <em>NoteForm</em> loisi uuden muistiinpanon seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NoteForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  addNote <span class="token operator">=</span> <span class="token keyword">async</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>note<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>note<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">createNote</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Molemmat komponentit käyttäisivät ainoastaan propsina saamaansa funktiota, välittämättä siitä että taustalla tapahtuu todellisuudessa palvelimen kanssa tapahtuvaa kommunikointia.</p>
<p>Asennetaan nyt <a href="https://github.com/gaearon/redux-thunk">redux-thunk</a>-kirjasto, joka mahdollistaa <em>asynkronisten actionien</em> luomisen. Asennus tapahtuu komennolla:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save redux-thunk</code></pre></div>
<p>redux-thunk-kirjasto on ns. <em>redux-middleware</em> joka täytyy ottaa käyttöön storen alustuksen yhteydessä. Eriytetään samalla storen määrittely omaan tiedostoon <em>store.js</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;redux&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">&#x27;redux-thunk&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> noteReducer <span class="token keyword">from</span> <span class="token string">&#x27;./reducers/noteReducer&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> filterReducer <span class="token keyword">from</span> <span class="token string">&#x27;./reducers/filterReducer&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> noteReducer<span class="token punctuation">,</span>
  filter<span class="token punctuation">:</span> filterReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></code></pre></div>
<p>Tiedosto <em>src/index.js</em> on muutoksen jälkeen seuraava</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import { Provider } from &#x27;react-redux&#x27;
import App from &#x27;./App&#x27;
import store from &#x27;./store&#x27;

ReactDOM.render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById(&#x27;root&#x27;)
)</code></pre></div>
<p>redux-thunkin ansiosta on mahdollista määritellä <em>action creatoreja</em> siten, että ne palauttavat funktion, jonka parametrina on redux-storen <em>dispatch</em>-metodi. Tämän ansiosta on mahdollista tehdä asynkronisia action creatoreja, jotka ensin odottavat jonkin toimenpiteen valmistumista ja vasta sen jälkeen dispatchaavat varsinaisen actionin.</p>
<p>Voimme nyt määritellä muistiinpanojen alkutilan palvelimelta hakevan action creatorin <em>initializeNotes</em> seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initializeNotes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> dispatch <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">await</span> noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">&#x27;INIT_NOTES&#x27;</span><span class="token punctuation">,</span>
      data<span class="token punctuation">:</span> notes<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Sisemmässä funktiossaan, eli <em>asynkronisessa actionissa</em> operaatio hakee ensin palvelimelta kaikki muistiinpanot ja sen jälkeen <em>dispatchaa</em> muistiinpanot storeen lisäävän actionin.</p>
<p>Komponentti <em>App</em> voidaan nyt määritellä seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  componentDidMount () {
    this.props.initializeNotes()
  }

  render() {
    return (
      &lt;div&gt;
        &lt;NoteForm /&gt;
        &lt;NoteList /&gt;
        &lt;VisibilityFilter /&gt;
      &lt;/div&gt;
    )
  }
}

export default connect(
  null, { initializeNotes }
)(App)</code></pre></div>
<p>Ratkaisu on elegantti, muistiinpanojen alustuslogiikka on eriytetty kokonaan React-komponenttien ulkopuolelle.</p>
<p>Uuden muistiinpanon lisäävä action creator <em>createNew</em> on seuraavassa</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createNew</span> <span class="token operator">=</span> content <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> dispatch <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newNote <span class="token operator">=</span> <span class="token keyword">await</span> noteService<span class="token punctuation">.</span><span class="token function">createNew</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">&#x27;NEW_NOTE&#x27;</span><span class="token punctuation">,</span>
      data<span class="token punctuation">:</span> newNote<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Periaate on jälleen sama, ensin suoritetaan asynkroninen operaatio, ja sen valmistuttua <em>dispatchataan</em> storen tilaa muuttava action.</p>
<p>Lomake muuttuu seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class NoteForm extends React.Component {

  addNote = async (event) =&gt; {
    event.preventDefault()
    const content = event.target.note.value
    event.target.note.value = &#x27;&#x27;
    this.props.createNew(content)
  }

  render() {
    return (
      &lt;form onSubmit={this.addNote}&gt;
        &lt;input name=&#x27;note&#x27; /&gt;
        &lt;button&gt;lisää&lt;/button&gt;
      &lt;/form&gt;
    )
  }
}

export default connect(
  null, { createNew }
)(NoteForm)</code></pre></div>
<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-6">githubissa</a> tagissä <em>part6-6</em>.</p>
<h3>Redux DevTools</h3>
<p>Chromeen on asennettavissa <a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd">Redux DevTools</a>, jonka avulla Redux-storen tilaa ja sitä muuttavia actioneja on mahdollisuus seurata selaimen konsolista.</p>
<p>Selaimen lisäosan lisäksi debugatessa tarvitaan kirjastoa <a href="https://www.npmjs.com/package/redux-devtools-extension">redux-devtools-extension</a>. Asennetaan se komennolla</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">npm install <span class="token operator">--</span>save redux<span class="token operator">-</span>devtools<span class="token operator">-</span>extension</code></pre></div>
<p>Storen luomistapaa täytyy hieman muuttaa, että kirjasto saadaan käyttöön:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">// ...
import { createStore, combineReducers, applyMiddleware } from &#x27;redux&#x27;
import thunk from &#x27;redux-thunk&#x27;
import { composeWithDevTools } from &#x27;redux-devtools-extension&#x27;

import noteReducer from &#x27;./reducers/noteReducer&#x27;
import filterReducer from &#x27;./reducers/filterReducer&#x27;

const reducer = combineReducers({
  notes: noteReducer,
  filter: filterReducer
})

const store = createStore(
  reducer,
  composeWithDevTools(
    applyMiddleware(thunk)
  )
)

export default store</code></pre></div>
<p>Kun nyt avaat konsolin, välilehti <em>redux</em> näyttää seuraavalta:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/4df255f283ff5181ab9a3039b5ca7cf6/14be6/5e.png"/></picture>
<p>Konsolin avulla on myös mahdollista dispatchata actioneja storeen</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/7ee4e1c35e7391f5f880c7f88307d935/14be6/5f.png"/></picture>
<p>Storen tietyn hetkisen tilan lisäksi on myös mahdollista tarkastella, mikä on kunkin actionin tilalle aiheuttama muutos:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/408ae9b7ac135ad5e5259b2bbd7c94a6/14be6/5g.png"/></picture>
<h2>tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#thunk">6.13-6.15</a></p>
<h2>React router</h2>
<p>Palataan jälleen Reduxittoman Reactin pariin.</p>
<p>On erittäin tyypillistä, että web-sovelluksissa on navigaatiopalkki, jonka avulla on mahdollista vaihtaa sovelluksen näkymää. Muistiinpanosovelluksemme voisi sisältää pääsivun:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/9dede0061c8eac733e37e2e60d2717b6/14be6/6.png"/></picture>
<p>ja omat sivunsa muistiinpanojen ja käyttäjien tietojen näyttämiseen:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/5b335e01f8915d3c3cab42be7f78460c/14be6/7.png"/></picture>
<p><a href="/osa0#perinteinen-web-sovellus">Vanhan koulukunnan websovelluksessa</a> sovelluksen näyttämän sivun vaihto tapahtui siten että selain teki palvelimelle uuden HTTP GET -pyynnön ja renderöi sitten palvelimen palauttaman näkymää vastaavan HTML-koodin.</p>
<p>Single page appeissa taas ollaan todellisuudessa koko ajan samalla sivulla, ja selaimessa suoritettava Javascript-koodi luo illuusion eri &quot;sivuista&quot;. Jos näkymää vaihdettaessa tehdään HTTP-kutsuja, niiden avulla haetaan ainoastaan JSON-muotoista dataa jota uuden näkymän näyttäminen ehkä edellyttää.</p>
<p>Navigaatiopalkki ja useita näkymiä sisältävä sovellus on erittäin helppo toteuttaa Reactilla.</p>
<p>Seuraavassa on eräs tapa:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Home = () =&gt; (
  &lt;div&gt; &lt;h2&gt;TKTL notes app&lt;/h2&gt; &lt;/div&gt;
)

const Notes = () =&gt; (
  &lt;div&gt; &lt;h2&gt;Notes&lt;/h2&gt; &lt;/div&gt;
)

const Users = () =&gt; (
  &lt;div&gt; &lt;h2&gt;Users&lt;/h2&gt; &lt;/div&gt;
)

class App extends React.Component {
  constructor() {
    super()
    this.state = {
      page: &#x27;home&#x27;
    }
  }

  toPage = (page) =&gt; (event) =&gt; {
    event.preventDefault()
    this.setState({ page })
  }

  render() {
    const content = () =&gt; {
      if (this.state.page === &#x27;home&#x27;) {
        return &lt;Home /&gt;
      } else if (this.state.page === &#x27;notes&#x27;) {
        return &lt;Notes /&gt;
      } else if (this.state.page === &#x27;users&#x27;) {
        return &lt;Users /&gt;
      }
    }

    return (
      &lt;div&gt;
        &lt;div&gt;
          &lt;a href=&quot;&quot; onClick={ this.toPage(&#x27;home&#x27;) }&gt;home&lt;/a&gt; &amp;nbsp;
          &lt;a href=&quot;&quot; onClick={ this.toPage(&#x27;notes&#x27;) }&gt;notes&lt;/a&gt; &amp;nbsp;
          &lt;a href=&quot;&quot; onClick={ this.toPage(&#x27;users&#x27;) }&gt;users&lt;/a&gt;
        &lt;/div&gt;

        {content()}
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Eli jokainen näkymä on toteutettu omana komponenttinaan ja sovelluksen tilassa pidetään tieto siitä, minkä näkymää vastaava komponentti menupalkin alla näytetään.</p>
<p><strong>Huom:</strong> navigointivalikossa oleva <em>&amp;nbsp;</em> tarkoittaa <em>a</em>-tagien väliin sjijoitettavaa välilyöntiä. CSS:n käyttö olisi luonnollisesti parempi tapa sivun ulkoasun muotoilulle mutta nyt tyydymme quick&#x27;n&#x27;dirty-ratkaisuun.</p>
<p>Menetelmä ei kuitenkaan ole optimaalinen. Kuten kuvista näkyy, sivuston osoite pysyy samana vaikka välillä ollaankin eri näkymässä. Jokaisella näkymällä tulisi kuitenkin olla oma osoitteensa, jotta esim. bookmarkien tekeminen olisi mahdollista. Sovelluksessamme ei myöskään selaimen <em>back</em>-painike toimi loogisesti, eli <em>back</em> ei vie edelliseksi katsottuun sovelluksen näkymään vaan jonnekin ihan muualle. Jos sovellus kasvaisi suuremmaksi ja sinne haluttaisiin esim. jokaiselle käyttäjälle sekä muistiinpanolle oma yksittäinen näkymänsä, itse koodattu <em>reititys</em> eli sivuston navigaationhallinta menisi turhan monimutkaiseksi.</p>
<p>Reactissa on onneksi valmis komponentti <a href="https://github.com/ReactTraining/react-router">React router</a> joka tarjoaa erinomaisen ratkaisun React-sovelluksen navigaation hallintaan.</p>
<p>Muutetaan ylläoleva sovellus käyttämään React routeria. Asennetaan React router komennolla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save react-router-dom</code></pre></div>
<p>React routerin tarjoama reititys saadaan käyttöön muuttamalla sovellusta seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import { BrowserRouter as Router, Route, Link } from &#x27;react-router-dom&#x27;

class App extends React.Component {

  render() {
    return (
      &lt;div&gt;
        &lt;Router&gt;
          &lt;div&gt;
            &lt;div&gt;
              &lt;Link to=&quot;/&quot;&gt;home&lt;/Link&gt; &amp;nbsp;
              &lt;Link to=&quot;/notes&quot;&gt;notes&lt;/Link&gt; &amp;nbsp;
              &lt;Link to=&quot;/users&quot;&gt;users&lt;/Link&gt;
            &lt;/div&gt;
            &lt;Route exact path=&quot;/&quot; render={() =&gt; &lt;Home /&gt;} /&gt;
            &lt;Route path=&quot;/notes&quot; render={() =&gt; &lt;Notes /&gt;} /&gt;
            &lt;Route path=&quot;/users&quot; render={() =&gt; &lt;Users /&gt;} /&gt;
          &lt;/div&gt;
        &lt;/Router&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Reititys, eli komponenttien ehdollinen, selaimen <em>urliin perustuva</em> renderöinti otetaan käyttöön sijoittamalla komponentteja <em>Router</em>-komponentin lapsiksi, eli <em>Router</em>-tagien sisälle.</p>
<p>Huomaa, että vaikka komponenttiin viitataan nimellä <em>Router</em> kyseessä on <a href="https://reacttraining.com/react-router/web/api/BrowserRouter">BrowserRouter</a>, sillä
importtaus tapahtuu siten, että importattava olio uudelleennimetään:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token keyword">as</span> Router <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-router-dom&#x27;</span></code></pre></div>
<p>Manuaalin mukaan</p>
<blockquote>
<p><em>BrowserRouter</em> is a <em>Router</em> that uses the HTML5 history API (pushState, replaceState and the popstate event) to keep your UI in sync with the URL.</p>
</blockquote>
<p>Normaalisti selain lataa uuden sivun osoiterivillä olevan urlin muuttuessa. <a href="https://css-tricks.com/using-the-html5-history-api/">HTML5 history API</a>:n avulla <em>BrowserRouter</em> kuitenkin mahdollistaa sen, että selaimen osoiterivillä olevaa urlia voidaan käyttää React-sovelluksen sisäiseen &quot;reitittämiseen&quot;, eli vaikka osoiterivillä oleva url muuttuu, sivun sisältöä manipuloidaan ainoastaan Javascriptillä ja selain ei lataa uutta sisältöä palvelimelta. Selaimen toiminta back- ja forward-toimintojen ja bookmarkien tekemisen suhteen on kuitenkin loogista, eli toimii kuten perinteisillä web-sivuilla.</p>
<p>Routerin sisälle määritellään selaimen osoiteriviä muokkaavia <em>linkkejä</em> komponentin <a href="https://reacttraining.com/react-router/web/api/Link">Link</a> avulla. Esim.</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span><span class="token operator">&gt;</span>notes<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span></code></pre></div>
<p>luo sovellukseen linkin, jonka teksti on <em>notes</em> ja jonka klikkaaminen vaihtaa selaimen osoiteriville urliksi <em>/notes</em>.</p>
<p>Selaimen urliin perustuen renderöitävät komponentit määritellään komponentin <a href="https://reacttraining.com/react-router/web/api/Route">Route</a> avulla. Esim.</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Notes /<span class="token operator">&gt;</span><span class="token punctuation">}</span> /<span class="token operator">&gt;</span></code></pre></div>
<p>määrittelee, että jos selaimen osoiteena on <em>/notes</em>, renderöidään komponentti <em>Notes</em>.</p>
<p>Sovelluksen juuren, eli osoitteen <em>/</em> määritellään renderöivän komponentti <em>Home</em>:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Home /<span class="token operator">&gt;</span><span class="token punctuation">}</span> /<span class="token operator">&gt;</span></code></pre></div>
<p>joudumme käyttämään routen <em>path</em> attribuutin edessä määrettä <em>exact</em>, muuten <em>Home</em> renderöityy kaikilla muillakin poluilla, sillä juuri <em>/</em> on kaikkien muiden polkujen <em>alkuosa</em>.</p>
<h3>parametroitu route</h3>
<p>Tarkastellaan sitten hieman modifioitua versiota edellisestä esimerkistä. Esimerkin koodi kokonaisuudessaan on <a href="https://github.com/FullStack-HY/FullStack-Hy.github.io/wiki/router-esimerkki">täällä</a>.</p>
<p>Sovellus sisältää nyt viisi eri näkymää, joiden näkyvyyttä kontrolloidaan routerin avulla. Edellisestä esimerkistä tuttujen komponenttien <em>Home</em>, <em>Notes</em> ja <em>Users</em> lisäksi mukana on kirjautumisnäkymää vastaava <em>Login</em> ja yksittäisen muistiinpanon näkymää vastaava <em>Note</em>.</p>
<p><em>Home</em> ja <em>Users</em> ovat kuten aiemmassa esimerkissä. <em>Notes</em> on hieman monimutkaisempi, se renderöi propseina saamansa muistiinpanojen listan siten, että jokaisen muistiinpanon nimi on klikattavissa</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/c734eb7d3963d927a2849f6d2967e9e1/14be6/8.png"/></picture>
<p>Nimen klikattavuus on toteutettu komponentilla <em>Link</em> ja esim. muistiinpanon, jonka id on 3 nimen klikkaaminen aiheuttaa selaimen osoitteen arvon päivittymisen muotoon <em>notes/3</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Notes = ({notes}) =&gt; (
  &lt;div&gt;
    &lt;h2&gt;Notes&lt;/h2&gt;
    &lt;ul&gt;
      {notes.map(note=&gt;
        &lt;li key={note.id}&gt;
          &lt;Link to={`/notes/${note.id}`}&gt;{note.content}&lt;/Link&gt;
        &lt;/li&gt;
      )}
    &lt;/ul&gt;
  &lt;/div&gt;
)</code></pre></div>
<p>Kun selain siirtyy muistiinpanon yksilöivään osoitteeseen, esim. <em>notes/3</em>, renderöidään komponentti <em>Note</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Note = ({note}) =&gt; {
  return(
  &lt;div&gt;
    &lt;h2&gt;{note.content}&lt;/h2&gt;
    &lt;div&gt;{note.user}&lt;/div&gt;
    &lt;div&gt;&lt;strong&gt;{note.important ? &#x27;tärkeä&#x27; : &#x27;&#x27;}&lt;/strong&gt;&lt;/div&gt;
  &lt;/div&gt;
)}</code></pre></div>
<p>Tämä tapahtuu laajentamalla komponentissa <em>App</em> olevaa reititystä seuraavasti:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>home<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span><span class="token operator">&gt;</span>notes<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token operator">&gt;</span>users<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Home /<span class="token operator">&gt;</span><span class="token punctuation">}</span> /<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Notes notes<span class="token operator">=</span><span class="token punctuation">{</span>this.state.notes<span class="token punctuation">}</span> /<span class="token operator">&gt;</span><span class="token punctuation">}</span>
      /<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/notes/:id&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span>match<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>noteById<span class="token punctuation">(</span>match.params.id<span class="token punctuation">)</span><span class="token punctuation">}</span> /<span class="token operator">&gt;</span><span class="token punctuation">}</span>
      /<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Router<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span></code></pre></div>
<p>Kaikki muistiinpanon renderöivään routeen on lisätty määre <em>exact path=&quot;/notes&quot;</em> sillä muuten se renderöityisi myös <em>/notes/3</em>-muotoisten polkujen yhteydessä.</p>
<p>Yksittäisen muistiinpanon näkymän renderöivä route määritellään &quot;expressin tyyliin&quot; merkkaamalla reitin parametrina oleva osa merkinnällä <em>:id</em></p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">&lt;Route exact path=&quot;/notes/:id&quot; /&gt;</code></pre></div>
<p>Renderöityvän komponentin määrittävä <em>render</em>-attribuutti pääsee käsiksi id:hen parametrinsa <a href="https://reacttraining.com/react-router/web/api/match">match</a> avulla seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">render={({match}) =&gt; &lt;Note note={noteById(match.params.id)} /&gt;}</code></pre></div>
<p>Muuttujassa <em>match.params.id</em> olevaa id:tä vastaava muistiinpano selvitetään apufunktion <em>noteById</em> avulla</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const noteById = (id) =&gt;
  this.state.notes.find(note =&gt; note.id === Number(id))</code></pre></div>
<p>renderöityvä <em>Note</em>-komponentti saa siis propsina urlin yksilöivää osaa vastaavan muistiinpanon.</p>
<h3>history</h3>
<p>Sovellukseen on myös toteutettu erittäin yksinkertainen kirjautumistoiminto. Jos sovellukseen ollaan kirjautuneena, talletetaan tieto kirjautuneesta käyttäjästä komponentin <em>App</em> tilaan <em>this.state.user</em>.</p>
<p>Mahdollisuus <em>Login</em>-näkymään navigointiin renderöidään menuun ehdollisesti</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>home<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span><span class="token operator">&gt;</span>notes<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token operator">&gt;</span>users<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
      <span class="token punctuation">{</span>this.state.user
        ? <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token punctuation">{</span>this.state.user<span class="token punctuation">}</span> logged in<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span>
        <span class="token keyword">:</span> <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span><span class="token operator">&gt;</span>login<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
  <span class="token punctuation">..</span>.
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/Router<span class="token operator">&gt;</span></code></pre></div>
<p>eli jos käyttäjä on kirjaantunut, renderöidäänkin linkin <em>Login</em> sijaan kirjautuneen käyttäjän käyttäjätunnus:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/9d8e5389508c4a3415ca5140d00ad25b/14be6/9.png"/></picture>
<p>Kirjautumisen toteuttamiseen liittyy eräs mielenkiintoinen seikka. Kirjaantumislomakkeelle mennään selaimen osoitteen ollessa <em>/login</em>. Toiminnallisuuden määrittelevä Route on seuraavassa</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Login history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span> onLogin<span class="token operator">=</span><span class="token punctuation">{</span>this.login<span class="token punctuation">}</span> /<span class="token operator">&gt;</span><span class="token punctuation">}</span>
/<span class="token operator">&gt;</span></code></pre></div>
<p>Routen render-attribuutissa määritelty metodi ottaa nyt vastaan olion <a href="https://reacttraining.com/react-router/web/api/history">history</a>, joka tarjoaa mm. mahdollisuuden manipuloida selaimen osoiterivin arvoa ohjelmallisesti.</p>
<p>Renderöitävälle <em>Login</em>-näkymälle annetaan parametriksi <em>history</em>-olio ja kirjautumisen komponentin <em>App</em> tilaan synkronoiva funktio <em>this.login</em>:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Login history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span> onLogin<span class="token operator">=</span><span class="token punctuation">{</span>this.login<span class="token punctuation">}</span>/<span class="token operator">&gt;</span><span class="token punctuation">}</span></code></pre></div>
<p>Komponentin koodi seuraavassa</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Login = ({onLogin, history}) =&gt; {
  const onSubmit = (event) =&gt; {
    event.preventDefault()
    onLogin(event.target.username.value)
    history.push(&#x27;/&#x27;)
  }
  return (
    &lt;div&gt;
      &lt;h2&gt;login&lt;/h2&gt;
      &lt;form onSubmit={onSubmit}&gt;
        &lt;div&gt;
          username: &lt;input /&gt;
        &lt;/div&gt;
        &lt;div&gt;
          password: &lt;input type=&quot;password&quot; /&gt;
        &lt;/div&gt;
        &lt;button type=&quot;submit&quot;&gt;login&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Kirjautumisen yhteydessä funktiossa <em>onSubmit</em> kutsutaan <a href="https://reacttraining.com/react-router/web/api/history">history</a>-olion metodia <em>push</em>. Käytetty komento <code>history.push(&#x27;/&#x27;)</code> saa aikaan sen, että selaimen osoiteriville tulee osoitteeksi <em>/</em> ja sovellus renderöi osoitetta vastaavan komponentin <em>Home</em>.</p>
<h3>redirect</h3>
<p>Näkymän <em>Users</em> routeen liittyy vielä eräs mielenkiintoinen detalji:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
  this.state.user
    ? <span class="token operator">&lt;</span>Users /<span class="token operator">&gt;</span>
    <span class="token keyword">:</span> <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span> /<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>/<span class="token operator">&gt;</span></code></pre></div>
<p>Jos käyttäjä ei ole kirjautuneena, ei renderöidäkään näkymää <em>Users</em> vaan sen sijaan <em>uudelleenohjataan</em> käyttäjä <em>Redirect</em>-komponentin avulla kirjautumisnäkymään</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">&lt;Redirect to=&quot;/login&quot; /&gt;</code></pre></div>
<p>Todellisessa sovelluksessa olisi kenties parempi olla kokonaan näyttämättä navigaatiovalikossa kirjautumista edellyttäviä näkymiä jos käyttäjä ei ole kirjautunut sovellukseen.</p>
<p>Seuraavassa vielä komponentin <em>App</em> koodi kokonaisuudessaan:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  constructor() {
    super()
    this.state = {
      notes: [
        {
          id: 1,
          content: &#x27;HTML on helppoa&#x27;,
          important: true,
          user: &#x27;Matti Luukkainen&#x27;
        },
        // ...
      ],
      user: null
    }
  }

  login = (user) =&gt; {
    this.setState({user})
  }

  render() {
    const noteById = (id) =&gt;
      this.state.notes.find(note =&gt; note.id === Number(id))

    return (
      &lt;div&gt;
        &lt;Router&gt;
          &lt;div&gt;
            &lt;div&gt;
              &lt;Link to=&quot;/&quot;&gt;home&lt;/Link&gt; &amp;nbsp;
              &lt;Link to=&quot;/notes&quot;&gt;notes&lt;/Link&gt; &amp;nbsp;
              &lt;Link to=&quot;/users&quot;&gt;users&lt;/Link&gt; &amp;nbsp;
              {this.state.user
                ? &lt;em&gt;{this.state.user} logged in&lt;/em&gt;
                : &lt;Link to=&quot;/login&quot;&gt;login&lt;/Link&gt;
              }
            &lt;/div&gt;

            &lt;Route exact path=&quot;/&quot; render={() =&gt; &lt;Home /&gt;} /&gt;
            &lt;Route exact path=&quot;/notes&quot; render={() =&gt; &lt;Notes notes={this.state.notes}/&gt;} /&gt;
            &lt;Route exact path=&quot;/notes/:id&quot; render={({match}) =&gt;
              &lt;Note note={noteById(match.params.id)} /&gt;}
            /&gt;
            &lt;Route path=&quot;/users&quot; render={() =&gt;
              this.state.user
                ? &lt;Users /&gt;
                : &lt;Redirect to=&quot;/login&quot; /&gt;
              }/&gt;
            &lt;Route path=&quot;/login&quot; render={({history}) =&gt;
              &lt;Login history={history} onLogin={this.login} /&gt;}
            /&gt;
          &lt;/div&gt;
        &lt;/Router&gt;
        &lt;div&gt;
          &lt;em&gt;Note app, Department of Computer Science 2018&lt;/em&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Render-metodissa määritellään myös kokonaan <em>Router</em>:in ulkopuolella oleva nykyisille web-sovelluksille tyypillinen <em>footer</em>-elementti, eli sivuston pohjalla oleva osa, joka on näkyvillä riippumatta siitä mikä komponentti sovelluksen reititetyssä osassa näytetään.</p>
<p><strong>Huom:</strong> edellä olevassa esimerkissä käytetään React Routerin versiota 4.2.6. Jos ja kun etsit esimerkkejä internetistä, kannattaa varmistaa, että niissä käytetään Routerista vähintään versiota 4.0. Nelosversio ei ole ollenkaan alaspäinyhteensopiva kolmosen kanssa, eli vanhaa React Routeria käyttävä koodi on täysin käyttökelvotonta Routerin versiota 4 käytettäessä.</p>
<h2>tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#router">6.16-6.18</a></p>
<h2>Inline-tyylit</h2>
<p>Osan 2 <a href="/osa2#tyylien-lis%C3%A4%C3%A4minen">lopussa</a> lisäsimme React-sovellukseen tyylejä vanhan koulukunnan tapaan yhden koko sovelluksen tyylit määrittelevän CSS-tiedoston avulla.</p>
<p>Olemme jo muutamaan kertaan määritelleet komponenteille <a href="https://react-cn.github.io/react/tips/inline-styles.html">inline</a>-tyylejä, eli määritelleet CSS:ää suoraan komponentin muun koodin seassa.</p>
<p>Edellisessä osassa piilotimme inline-tyylin avulla napin ruudusta tietyissä tapauksissa:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const hideWhenVisible = { display: this.state.visible ? &#x27;none&#x27; : &#x27;&#x27; }

&lt;div style={hideWhenVisible}&gt;
  &lt;button onClick={this.toggleVisibility}&gt;{this.props.buttonLabel}&lt;/button&gt;
&lt;/div&gt;</code></pre></div>
<p>eli jos <em>this.state.visible</em> oli arvoltaan tosi, liitetään <em>div</em>-komponenttiin sen näkymättömäksi asettava tyyli</p>
<div class="gatsby-highlight" data-language="css"><pre><code class="language-css">{ display: &#x27;none&#x27; }</code></pre></div>
<p>Periaate inline-tyylien määrittelyssä on siis erittäin yksinkertainen. Mihin tahansa React-komponenttiin tai elementtiin voi liittää attribuutin <em>style</em>, jolle annetaan arvoksi Javascript-oliona määritelty joukko <em>CSS</em>-sääntöjä.</p>
<p>CSS-säännöt määritellään hieman eri tavalla kuin normaaleissa CSS-tiedostoissa. Jos haluamme asettaa jollekin elementille vihreän, kursivoidun ja 16 pikselin korkuisen fontin, eli CSS-syntaksilla ilmaistuna</p>
<div class="gatsby-highlight" data-language="css"><pre><code class="language-css">{
  color: green;
  font-style: italic;
  font-size: 16px;
}</code></pre></div>
<p>tulee tämä muotilla Reactin inline-tyylin määrittelevänä oliona seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> footerStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
  color<span class="token punctuation">:</span> <span class="token string">&#x27;green&#x27;</span><span class="token punctuation">,</span>
  fontStyle<span class="token punctuation">:</span> <span class="token string">&#x27;italic&#x27;</span><span class="token punctuation">,</span>
  fontSize<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Jokainen CSS-sääntö on olion kenttä, joten ne erotetaan Javascript-syntaksin mukaan pilkuilla. Pikseleinä ilmaistut numeroarvot voidaan määritellä kokonaislukuina. Merkittävin ero normaaliin CSS:ään on väliviivan sisältämien CSS-ominaisuuksien kirjoittaminen <em>camelCase</em>-muodossa.</p>
<p>Voimme muotoilla edellisen luvun footer-elementin olion <em>footerStyle</em> avulla seuraavasti:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>footerStyle<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>br /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Note app, Department of Computer Science 2018<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span></code></pre></div>
<p>Inline-tyyleillä on tiettyjä rajoituksia, esim. ns. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-classes">pseudo-selektoreja</a> ei ole mahdollisuutta käyttää (ainakaan helposti).</p>
<p>Inline-tyylit ja muutamat seuraavassa osassa katsomamme tavat lisätä tyylejä Reactiin ovat periaatteessa täysin vastoin vanhoja hyviä periaatteita, joiden mukaan Web-sovellusten ulkoasujen määrittely eli CSS tulee erottaa sisällön (HTML) ja toiminnallisuuden (Javascript) määrittelystä. Vanha koulukunta pyrkiikin siihen että sovelluksen CSS, HTML ja Javascript on kaikki kirjoitettu omiin tiedostoihinsa.</p>
<p>Itseasiassa Reactin filosofia on täysin päinvastainen. Koska CSS:n, HTML:n ja Javascriptin erottelu eri tiedostoihin ei ole kuitenkaan osoittautunut erityisen skaalautuvaksi ratkaisuksi suurissa järjestelmissä, on Reactissa periaatteena tehdä erottelu (eli jakaa sovelluksen koodi eri tiedostoihin) noudattaen <em>sovelluksen loogisia toiminnallisia kokonaisuuksia</em>.</p>
<p>Toiminnallisen kokonaisuuden strukturointiyksikkö on React-komponentti, joka määrittelee niin sisällön rakenteen kuvaavan HTML:n, toiminnan määrittelevät Javascript-funktiot kuin komponentin tyylinkin yhdessä paikassa, siten että komponenteista tulee mahdollisimman riippumattomia ja yleiskäyttöisiä.</p>
<h2>tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#inline-tyylit">6.19 ja 6.20</a></p>
<h2>Valmiit käyttöliittymätyylikirjastot</h2>
<p>Eräs lähestymistapa sovelluksen tyylien määrittelyyn on valmiin &quot;UI frameworkin&quot;, eli suomeksi ehkä käyttöliittymätyylikirjaston käyttö.</p>
<p>Ensimmäinen laajaa kuuluisuutta saanut UI framework oli Twitterin kehittämä <a href="https://getbootstrap.com/">Bootstrap</a>, joka lienee edelleen UI frameworkeista eniten käytetty. Viime aikoina UI frameworkeja on noussut kuin sieniä sateella. Valikoima on niin iso, ettei tässä kannata edes yrittää tehdä tyhjentävää listaa.</p>
<p>Monet UI-frameworkit sisältävät web-sovellusten käyttöön valmiiksi määriteltyjä teemoja sekä &quot;komponentteja&quot;, kuten painikkeita, menuja, taulukkoja. Termi komponentti on edellä kirjotettu hipsuissa sillä kyse ei ole samasta asiasta kuin React-komponentti. Useimmiten UI-frameworkeja käytetään sisällyttämällä sovellukseen frameworkin määrittelemät CSS-tyylitiedostot sekä Javascript-koodi.</p>
<p>Monesta UI-frameworkista on tehty React-ystävällisiä versiota, joissa UI-frameworkin avulla määritellyistä &quot;komponenteista&quot; on tehty React-komponentteja. Esim. Bootstrapista on olemassa parikin React-versiota <a href="http://reactstrap.github.io/">reactstrap</a> ja <a href="https://react-bootstrap.github.io/">react-bootstrap</a>.</p>
<p>Katsotaan seuraavaksi kahta UI-framworkia bootstrapia ja <a href="https://semantic-ui.com/">semantic ui</a>:ta.
Lisätään molempien avulla samantapaiset tyylit luvun <a href="/osa6/#react-router">React-router</a> sovellukseen.</p>
<h3>react bootstrap</h3>
<p>Aloitetaan bootstrapista, käytetään kirjastoa <a href="https://react-bootstrap.github.io/">react-bootstrap</a>.</p>
<p>Asennetaan kirjasto suorittamalla komento</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save react-bootstrap</code></pre></div>
<p>Lisätään sitten sovelluksen <em>public/index.html</em> tiedoston <em>head</em>-tagin sisään bootstrapin css-määrittelyt lataava rivi:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
    <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
  // ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Kun sovellus ladataan uudelleen, näyttää se jo aavistuksen tyylikkäämmältä:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/b914b0fefd57ab72760d4c8a8e32445b/14be6/10.png"/></picture>
<p>Bootstrapissa koko sivun sisältö renderöidään yleensä <a href="https://getbootstrap.com/docs/4.0/layout/overview/#containers">container</a>:ina, eli käytännössä koko sovelluksen ympäröivä <em>div</em>-elementti merkitään luokalla <em>container</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">// ...

class App extends React.Component {
  // ...
  render() {
    return (
      &lt;div className=&quot;container&quot;&gt;
        // ...
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Sovelluksen ulkoasu muuttuu siten, että sisältö ei ole enää yhtä kiinni selaimen reunoissa:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/c7e8beb2f708315545d1560cf80f6c8a/14be6/11.png"/></picture>
<p>Muutetaan seuraavaksi komponenttia <em>Notes</em> siten, että se renderöi muistiinpanojen listan <a href="https://getbootstrap.com/docs/4.0/content/tables/">taulukkona</a>. React bootstrap tarjoaa valmiin komponentin <a href="https://react-bootstrap.github.io/components/table/">Table</a>, joten CSS-luokan käyttöön ei ole tarvetta.</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Notes = ({notes}) =&gt; (
  &lt;div&gt;
    &lt;h2&gt;Notes&lt;/h2&gt;
    &lt;Table striped&gt;
      &lt;tbody&gt;
        {notes.map(note=&gt;
          &lt;tr key={note.id}&gt;
            &lt;td&gt;
              &lt;Link to={`/notes/${note.id}`}&gt;{note.content}&lt;/Link&gt;
            &lt;/td&gt;
            &lt;td&gt;
              {note.user}
            &lt;/td&gt;
          &lt;/tr&gt;
        )}
      &lt;/tbody&gt;
    &lt;/Table&gt;
  &lt;/div&gt;
)</code></pre></div>
<p>Ulkoasu on varsin tyylikäs:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/d5175aa09c6e0f57668bc371c0525185/14be6/12.png"/></picture>
<p>Huomaa, että koodissa käytettävät React bootstrapin komponentit täytyy importata, eli koodiin on lisättävä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Table <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-bootstrap&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<h4>Lomake</h4>
<p>Parannellaan seuraavaksi näkymän <em>Login</em> kirjautumislomaketta Bootstrapin <a href="https://getbootstrap.com/docs/4.0/components/forms/">lomakkeiden</a> avulla.</p>
<p>React bootstrap tarjoaa valmiit <a href="https://react-bootstrap.github.io/components/forms/">komponentit</a> myös lomakkeiden muodostamiseen (dokumentaatio tosin ei ole paras mahdollinen):</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Login = ({onLogin, history}) =&gt; {
  // ...
  return (
    &lt;div&gt;
      &lt;h2&gt;login&lt;/h2&gt;
      &lt;form onSubmit={onSubmit}&gt;
        &lt;FormGroup&gt;
          &lt;ControlLabel&gt;username:&lt;/ControlLabel&gt;
          &lt;FormControl
            type=&quot;text&quot;
            name=&quot;username&quot;
          /&gt;
          &lt;ControlLabel&gt;password:&lt;/ControlLabel&gt;
          &lt;FormControl
            type=&quot;password&quot;
          /&gt;
          &lt;Button bsStyle=&quot;success&quot; type=&quot;submit&quot;&gt;login&lt;/Button&gt;
        &lt;/FormGroup&gt;
      &lt;/form&gt;
    &lt;/div&gt;
)}</code></pre></div>
<p>Importoitavien komponenttien määrä kasvaa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Table<span class="token punctuation">,</span>
  FormGroup<span class="token punctuation">,</span>
  FormControl<span class="token punctuation">,</span>
  ControlLabel<span class="token punctuation">,</span>
  Button<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-bootstrap&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>Lomake näyttää parantelun jälkeen seuraavalta:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/1cc551bb5de16a29ae9571e49bdd5a68/14be6/12b.png"/></picture>
<h4>Notifikaatio</h4>
<p>Toteutetaan sovellukseen kirjautumisen jälkeinen <em>notifikaatio</em>:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/600dba48f9410ec48a8df6ec00dfd37f/14be6/13.png"/></picture>
<p>Asetetaan notifikaatio kirjautumisen yhteydessä komponentin <em>App</em> tilan kenttään <em>message</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">login</span> <span class="token operator">=</span> user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`welcome </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>ja renderöidään viesti Bootstrapin <a href="https://getbootstrap.com/docs/4.0/components/alerts/">Alert</a>-komponentin avulla. React bootstrap tarjoaa tähän jälleen valmiin <a href="https://react-bootstrap.github.io/components/alerts/">React-komponentin</a>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">{(this.state.message &amp;&amp;
  &lt;Alert color=&quot;success&quot;&gt;
    {this.state.message}
  &lt;/Alert&gt;
)}</code></pre></div>
<h4>Navigaatiorakenne</h4>
<p>Muutetaan vielä lopuksi sovelluksen navigaatiomenu käyttämään Bootstrapin <a href="https://getbootstrap.com/docs/4.0/components/navbar/">Navbaria</a>. Tähänkin React bootstrap tarjoaa <a href="https://react-bootstrap.github.io/components/navbar/#navbars-mobile-friendly">valmiit komponentit</a>, dokumentaatio on hieman kryptistä, mutta trial and error johtaa lopulta toimivaan ratkaisuun:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Navbar inverse collapseOnSelect<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Navbar.Header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Navbar.Brand<span class="token operator">&gt;</span>
      Anecdote app
    <span class="token operator">&lt;</span>/Navbar.Brand<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Navbar.Toggle /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Navbar.Header<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Navbar.Collapse<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Nav<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>NavItem href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>home<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>/NavItem<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>NavItem href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span><span class="token operator">&gt;</span>notes<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>/NavItem<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>NavItem href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token operator">&gt;</span>users<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>/NavItem<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>NavItem<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>this.state.user
          ? <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token punctuation">{</span>this.state.user<span class="token punctuation">}</span> logged in<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span>
          <span class="token keyword">:</span> <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span><span class="token operator">&gt;</span>login<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>/NavItem<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/Nav<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Navbar.Collapse<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/Navbar<span class="token operator">&gt;</span></code></pre></div>
<p>Ulkoasu on varsin tyylikäs</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/696d1b1584cfe3f1d804e451f94b2071/14be6/14.png"/></picture>
<p>Jos selaimen kokoa kaventaa, huomaamme että menu &quot;kollapsoituu&quot; ja sen saa näkyville vain klikkaamalla:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/75e9480851bbe5c84f1483da328e72af/14be6/15.png"/></picture>
<p>Bootstrap ja valtaosa tarjolla olevista UI-frameworkeista tuottavat <a href="https://en.wikipedia.org/wiki/Responsive_web_design">responsiivisia</a> näkymiä, eli sellaisia jotka renderöityvät vähintään kohtuullisesti monen kokoisilla näytöillä.</p>
<p>Chromen konsolin avulla on mahdollista simuloida sovelluksen käyttöä erilaisilla mobiilipäätteillä</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/1af080ec23cf2268f7ffd62979bb2996/14be6/16.png"/></picture>
<p>Sovellus toimii hyvin, mutta konsoliin vilkaisu paljastaa erään ikävän detaljin:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/a780f2c5c127b477b0266ad4fc2f0cd0/14be6/17.png"/></picture>
<p>Syy valituksiin on navigaatiorakenteessa</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>NavItem href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>home<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/NavItem<span class="token operator">&gt;</span></code></pre></div>
<p>Nämä sisäkkäiset komponentit sisältävät molemmat <em>a</em>-tagin ja React hermostuu tästä.</p>
<p>Ongelma on ikävä ja sen kiertäminen on toki mahdollista, katso esim.
<a href="https://serverless-stack.com/chapters/adding-links-in-the-navbar.html">https://serverless-stack.com/chapters/adding-links-in-the-navbar.html</a></p>
<p>Esimerkin sovelluksen koodi kokonaisuudessaan <a href="https://github.com/FullStack-HY/FullStack-Hy.github.io/wiki/bootstrap">täällä</a>.</p>
<h3>Semantic UI</h3>
<p>Olen käyttänyt bootstrapia vuosia, mutta siirryin hiljattain <a href="https://semantic-ui.com/">Semantic UI</a>:n käyttäjäksi. Kurssin tehtävien <a href="https://studies.cs.helsinki.fi/fs-stats">palautusovellus</a> on tehty Semanticilla ja kokemukset ovat olleet rohkaisevia, erityisesti semanticin <a href="https://react.semantic-ui.com">React-tuki</a> on ensiluokkainen ja dokumentaatiokin huomattavasti parempi kuin bootstrapissa.</p>
<p>Lisätään nyt <a href="/osa6/#react-router">React-router</a>-sovellukselle edellisen luvun tapaan tyylit semanticilla.</p>
<p>Aloitetaan asentamalla <a href="https://react.semantic-ui.com">semantic-ui-react</a>-kirjasto:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save semantic-ui-react</code></pre></div>
<p>Lisätään sitten sovelluksen tiedostoon <em>public/index.html</em> head-tagin sisään semanticin css-määrittelyt lataava rivi (joka löytyy <a href="https://react.semantic-ui.com/usage#content-delivery-network-cdn">tästä</a>):</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>link</span><span class="token punctuation">&gt;</span></span>
  // ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Sijoitetaan koko sovelluksen renderöimä sisältö Semanticin komponentin <a href="https://react.semantic-ui.com/elements/container">Container</a> sisälle.</p>
<p>Semanticin dokumentaatio sisältää jokaisesta komponentista useita esimerkkikoodinpätkiä, joiden avulla komponenttien käytön periaatteet on helppo omaksua:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/b9e6e01b48699a864c31b3a70af7ce71/14be6/18.png"/></picture>
<p>Muutetaan komponentin App uloin <em>div</em>-elementti <em>Containeriksi</em>:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">import</span> <span class="token punctuation">{</span> Container <span class="token punctuation">}</span> from <span class="token string">&#x27;semantic-ui-react&#x27;</span>

// <span class="token punctuation">..</span>.

class App extends React.Component <span class="token punctuation">{</span>
  // <span class="token punctuation">..</span>.
  render<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span>
        // <span class="token punctuation">..</span>.
      <span class="token operator">&lt;</span>/Container<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Sivun sisältö ei ole enää reunoissa kiinni:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/8e375f968b5bc220820e8151bce8fa4d/14be6/19.png"/></picture>
<p>Edellisen luvun tapaan, renderöidään muistiinpanot taulukkona, komponentin <a href="https://react.semantic-ui.com/collections/table">Table</a> avulla. Koodi näyttää seuraavalta</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import { Table } from &#x27;semantic-ui-react&#x27;

const Notes = ({ notes }) =&gt; (
  &lt;div&gt;
    &lt;h2&gt;Notes&lt;/h2&gt;
    &lt;Table striped celled&gt;
      &lt;Table.Body&gt;
        {notes.map(note =&gt;
          &lt;Table.Row key={note.id}&gt;
            &lt;Table.Cell&gt;
              &lt;Link to={`/notes/${note.id}`}&gt;{note.content}&lt;/Link&gt;
            &lt;/Table.Cell&gt;
            &lt;Table.Cell&gt;
              {note.user}
            &lt;/Table.Cell&gt;
          &lt;/Table.Row&gt;
        )}
      &lt;/Table.Body&gt;
    &lt;/Table&gt;
  &lt;/div&gt;
)</code></pre></div>
<p>Muistiinpanojen lista näyttää seuraavalta:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/d0606c506c403790adfc0de9f42a67ec/14be6/20.png"/></picture>
<h4>Lomake</h4>
<p>Otetaan kirjautumissivulla käyttöön Semanticin <a href="https://react.semantic-ui.com/collections/form">Form</a>-komponentti:</p>
<div class="gatsby-highlight" data-language="text"><pre><code class="language-text">import { Form, Button } from &#x27;semantic-ui-react&#x27;

const Login = ({ onLogin, history }) =&gt; {
  const onSubmit = (event) =&gt; {
    // ...
  }
  return (
    &lt;div&gt;
      &lt;h2&gt;login&lt;/h2&gt;
      &lt;Form onSubmit={onSubmit}&gt;
        &lt;Form.Field&gt;
          &lt;label&gt;username&lt;/label&gt;
          &lt;input name=&#x27;username&#x27; /&gt;
        &lt;/Form.Field&gt;
        &lt;Form.Field&gt;
          &lt;label&gt;password&lt;/label&gt;
          &lt;input type=&#x27;password&#x27; /&gt;
        &lt;/Form.Field&gt;
        &lt;Button type=&#x27;submit&#x27;&gt;login&lt;/Button&gt;
      &lt;/Form&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Ulkoasu näyttää seuraavalta:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/d48b0e0c1325bf6e19c3ddc6e70419d0/14be6/21.png"/></picture>
<h4>Notifikaatio</h4>
<p>Edellisen luvun tapaan, toteutetaan sovellukseen kirjautumisen jälkeinen <em>notifikaatio</em>:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/7ee600a5c64170469543b2a9d7fc7e5d/14be6/22.png"/></picture>
<p>Kuten edellisessä luvussa, asetetaan notifikaatio kirjautumisen yhteydessä komponentin <em>App</em> tilan kenttään <em>message</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">login</span> <span class="token operator">=</span> user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`welcome </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>ja renderöidään viesti käyttäen komponenttia <a href="https://react.semantic-ui.com/collections/message">Message</a>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">{(this.state.message &amp;&amp;
  &lt;Message success&gt;
    {this.state.message}
  &lt;/Message&gt;
)}</code></pre></div>
<h4>Navigaatiorakenne</h4>
<p>Navigaatiorakenne toteutetaan komponentin <a href="https://react.semantic-ui.com/collections/menu">Menu</a> avulla:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Menu inverted<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Menu.Item link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>home<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Menu.Item<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Menu.Item link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/notes&quot;</span><span class="token operator">&gt;</span>notes<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Menu.Item<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Menu.Item link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token operator">&gt;</span>users<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/Menu.Item<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Menu.Item link<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>this.state.user
      ? <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token punctuation">{</span>this.state.user<span class="token punctuation">}</span> logged in<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span>
      <span class="token keyword">:</span> <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span><span class="token operator">&gt;</span>login<span class="token operator">&lt;</span>/Link<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>/Menu.Item<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/Menu<span class="token operator">&gt;</span></code></pre></div>
<p>Lopputulos näyttää seuraavalta:</p>
<picture><img style="border-color:#B795F3" alt="fullstack content" src="/static/4d9567f0b1d250dacb099d30d764db21/14be6/23.png"/></picture>
<p>Bootstrapin yhteydessä esiintynyttä sisäkkäisen <em>a</em>-tagien ongelmaa ei semanticin kanssa ole.</p>
<p>Esimerkin sovelluksen koodi kokonaisuudessaan <a href="https://github.com/FullStack-HY/FullStack-Hy.github.io/wiki/semantic-ui">täällä</a>.</p>
<h3>Loppuhuomioita</h3>
<p>Ero react-bootstrapin ja semantic-ui-reactin välillä ei ole suuri. On makuasia kummalla tuotettu ulkoasu on tyylikkäämpi. Oma vuosia kestäneen bootstrapin käytön jälkeinen siirtymiseni semanticiin johtuu semanticin saumattomammasta React-tuesta, laajemmasta valmiiden komponenttien valikoimasta ja paremmasta sekä selkeämmästä dokumentaatiosta. Semantic UI projektin kehitystyön jatkuvuuden suhteen on kuitenkin viime aikoina ollut ilmoilla muutamia <a href="https://github.com/Semantic-Org/Semantic-UI/issues/6109">kysymysmerkkejä</a>, ja tilannetta kannattaakin seurata.</p>
<p>Esimerkissä käytettiin UI-frameworkeja niiden React-integraatiot tarjoavien kirjastojen kautta.</p>
<p>Sen sijaan että käytimme kirjastoa <a href="https://react-bootstrap.github.io/">React bootstrap</a>, olisimme voineet aivan yhtä hyvin käyttää Bootstrapia suoraan, liittämällä HTML-elementteihin CSS-luokkia. Eli sen sijaan että määrittelimme esim. taulukon komponentin <em>Table</em> avulla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>Table striped<span class="token operator">&gt;</span>
  // <span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>/Table<span class="token operator">&gt;</span></code></pre></div>
<p>olisimme voineet käyttää normaalia HTML:n taulukkoa <em>table</em> ja CSS-luokkaa</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token operator">&lt;</span>table className<span class="token operator">=</span><span class="token string">&quot;table striped&quot;</span><span class="token operator">&gt;</span>
  // <span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>/table<span class="token operator">&gt;</span></code></pre></div>
<p>Taulukon määrittelyssä React bootstrapin tuoma etu ei ole suuri.</p>
<p>Tiiviimmän ja ehkä paremmin luettavissa olevan kirjoitusasun lisäksi toinen etu React-kirjastoina olevissa UI-frameworkeissa on se, että kirjastojen mahdollisesti käyttämä Javascript-koodi on sisällytetty React-komponentteihin. Esim. osa Bootstrapin komponenteista edellyttää toimiakseen muutamaakin ikävää <a href="https://getbootstrap.com/docs/4.0/getting-started/introduction/#js">Javascript-riippuvuutta</a> joita emme mielellään halua React-sovelluksiin sisällyttää.</p>
<p>React-kirjastoina tarjottavien UI-frameworkkien ikävä puoli verrattuna frameworkin &quot;suoraan käyttöön&quot; on React-kirjastojen API:n mahdollinen epästabiilius ja osittain huono dokumentaatio. Tosin <a href="https://react.semantic-ui.com">react-semanticin</a> suhteen tilanne on paljon parempi kuin monien muiden UI-frameworkien sillä kyseessä on virallinen React-integraatio.</p>
<p>Kokonaan toinen kysymys on se kannattaako UI-frameworkkeja ylipäätän käyttää. Kukin muodostakoon oman mielipiteensä, mutta CSS:ää taitamattomalle ja puutteellisilla design-taidoilla varustetulle ne ovat varsin käyttökelpoisia työkaluja.</p>
<h3>Muita UI-frameworkeja</h3>
<p>Luetellaan tässä kaikesta huolimatta muitakin UI-frameworkeja. Jos oma suosikkisi ei ole mukana, tee pull request</p>
<ul>
<li><a href="http://www.material-ui.com/">http://www.material-ui.com/</a></li>
<li><a href="https://bulma.io/">https://bulma.io/</a></li>
<li><a href="https://ant.design/">https://ant.design/</a></li>
<li><a href="https://foundation.zurb.com/">https://foundation.zurb.com/</a></li>
</ul>
<p>Alun perin tässä osassa oli tarkoitus käyttää <a href="http://www.material-ui.com/">Material UI</a>:ta, mutta kirjasto on juuri nyt kiivaan kehityksen alla ennen version 1.0 julkaisemista ja osa dokumentaation esimerkeistä ei toiminut uusimmalla versiolla. Voikin olla viisainta odotella Materialin kanssa versiota 1.0.</p>
<h2>Tehtäviä</h2>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#ui-framework">6.21-6.23</a></p>
</div></div></div><div class="container spacing element--flex element--column element--centered"><div class="body-text "><p class="body-text__content bold">Tehtävien palautus</p></div><a href="https://studies.cs.helsinki.fi/fullstackopen/" style="padding:1rem 0" class="col-2 centered spacing--small"><div class="triple-border nav-item-hover triple-border--large-margin" style="padding:"><div class="triple-border__container triple-border__return-tasks" style="background-color:transparent">Palauta tehtävät palautussovellukseen</div></div></a></div><div class="container spacing element--flex element--centered"><a class="edit-link" target="__BLANK" href="https://github.com/fullstack-hy2019/fullstack-hy2019.github.io/edit/source/src/content/osa6/osa6a.md">Muokkaa sisältöä</a></div><div class="container spacing spacing--after-large "><a class="push-right-1" href="/osa5"><div class=" element--flex element--column"><p style="text-align:right">Osa <!-- -->5</p><b>Edellinen osa</b></div></a><a class="push-left-1" href="/osa7"><div class=" element--flex element--column"><p>Osa <!-- -->7</p><b>Seuraava osa</b></div></a></div></div><div class="container spacing--after " id="footer" style="justify-content:space-between"><div class="col-4" style="display:flex;justify-content:space-between"><a href="https://www.helsinki.fi/" class="image--large image--contain" style="width:100%"><div class="image image--large image--contain "><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/hgin_yliopisto-30c68104749d830b6cef6ea8c6339b16.png" alt=""/></div></div></a><a href="https://www.houston-inc.com/" class="push-right-2" style="width:100%"><div class="image image--large image--contain "><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/houston_logo-356bd2a9a75b44bdf7897b2cdd387600.png" alt=""/></div></div></a></div><div class="col-2 order-1--mobile element--flex" style="display:flex;justify-content:space-between;align-items:center"><a class="nav-item-hover" style="margin-left:4.5rem" href="/about">KURSSISTA</a><a class="nav-item-hover" href="/faq">FAQs</a></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-content-template-js","jsonName":"osa-6-redux-4b6","path":"/osa6/redux"};window.dataPath="825/path---osa-6-redux-4-b-6-755-mcDSTnFJxYUKBICK87AnkIOK98";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.f588656cc80a065e5f1e.css","/app-a3afcc3090199b7f6d12.js"],"component---src-templates-content-template-js":["/component---src-templates-content-template-js.460b1f1e29cfc2ab4416.css","/component---src-templates-content-template-js-afce20df754b65dc684d.js"],"component---src-templates-part-intro-template-js":["/component---src-templates-part-intro-template-js.6655ae6c1d548f9d7a97.css","/component---src-templates-part-intro-template-js-a63e89f3991b7ef8d003.js"],"component---src-pages-404-js":["/component---src-pages-404-js-88d0797cd2f1052f0aac.js"],"component---src-pages-about-js":["/component---src-pages-about-js.0e7ea90a2d6c7c84d2f5.css","/component---src-pages-about-js-6dddf4a7f73d5859f319.js"],"component---src-pages-companies-js":["/component---src-pages-companies-js-c74de87049d53cfcde6a.js"],"component---src-pages-faq-js":["/component---src-pages-faq-js-e551d8988a130dfd5b14.js"],"component---src-pages-index-js":["/component---src-pages-index-js.054d4c52cecca6da6c62.css","/component---src-pages-index-js-ff9784c4a312ecd2aab6.js"]};/*]]>*/</script><script src="/webpack-runtime-1d00ecdb3155d0eb1b81.js" async=""></script><script src="/2-59836067dfb7441ad4ca.js" async=""></script><script src="/13-fc730b3ced992af1ecdc.js" async=""></script><script src="/0-e4f4414306634f49516a.js" async=""></script><script src="/component---src-templates-content-template-js-afce20df754b65dc684d.js" async=""></script><script src="/app-a3afcc3090199b7f6d12.js" async=""></script></body></html>
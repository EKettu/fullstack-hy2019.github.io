<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/1.c9b26394eb74a6b0d81d.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);.arrow__container{position:relative}.arrow__container:not():first-child{border-left:none}.arrow__container:not():first-child:before{content:"";background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NzcuMTc1IDQ3Ny4xNzUiPjxwYXRoIGQ9Ik0zNjAuNzMxIDIyOS4wNzVsLTIyNS4xLTIyNS4xYy01LjMtNS4zLTEzLjgtNS4zLTE5LjEgMHMtNS4zIDEzLjggMCAxOS4xbDIxNS41IDIxNS41LTIxNS41IDIxNS41Yy01LjMgNS4zLTUuMyAxMy44IDAgMTkuMSAyLjYgMi42IDYuMSA0IDkuNSA0IDMuNCAwIDYuOS0xLjMgOS41LTRsMjI1LjEtMjI1LjFjNS4zLTUuMiA1LjMtMTMuOC4xLTE5eiIvPjwvc3ZnPg==) no-repeat;background-size:contain;position:absolute;top:0;left:0;height:100%;width:100%}.arrows--horizontal{display:flex;position:relative;margin:0;align-items:flex-start}.arrow__wrapper{display:flex;justify-content:flex-start;align-items:center;margin:0}.arrow__wrapper:first-of-type{border-right:none;z-index:20}.arrow__wrapper:nth-of-type(n+2){margin-left:-4rem;z-index:10}.arrow__wrapper:nth-of-type(n+2) .arrow__rectangle{border-left:none;padding-left:4rem}.arrow__wrapper:nth-of-type(3){z-index:5}.arrow__rectangle{padding:1rem;justify-content:center;align-items:center;border:2px solid #33332d;border-right:none;z-index:2;overflow:hidden}.arrow__rectangle .bold{font-weight:600}.arrow__rectangle--thick-border{border:3px solid #33332d;border-right:none}.arrow__point{padding:1.25rem;border:2px solid #33332d;border-bottom:none;border-left:none;-webkit-transform:translate(-1.3rem) rotate(45deg);transform:translate(-1.3rem) rotate(45deg);z-index:1;overflow:hidden}.arrow__point--thick-border{border:3px solid #33332d;border-bottom:none;border-left:none}.arrow__wrapper--stacked{display:flex;justify-content:flex-start;align-items:center;margin:auto auto auto 0}.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:-2px}.arrow--stacked-letter{margin-right:2rem}.arrow--stacked-title{text-transform:uppercase;white-space:nowrap}.arrow__container--with-link{width:100%!important}.element--flex{display:flex;flex-wrap:wrap}.element--space-around{justify-content:space-around}.element--space-between{justify-content:space-between}.element--column{flex-direction:column}.element--centered{align-items:center}.element--horizontal-half{width:45%}.element--auto-bottom-margin{margin-bottom:auto}.element--flex-start{align-content:flex-start}.image__content{position:absolute;top:0;left:0;height:100%;width:100%;-o-object-fit:cover;object-fit:cover}.image--contain .image__content{-o-object-fit:contain;object-fit:contain}.image{border-radius:10px;overflow:hidden;width:100%;position:relative}@media (min-width:992px){.image{width:40%}}.image .image__container{height:0;position:relative;width:100%;padding-bottom:89.0625%}.image--circle{border-radius:50%}.image--circle .image__content{background-color:#e1e1e1}.image--square-big{width:100%}.image--square-big .image__container{width:100%;padding-bottom:100%}.image--extra-small{width:8%}.image--extra-small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--extra-small{width:calc(33.33333% - 1rem)}}.image--small{width:15%}.image--small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--small{width:calc(33.33333% - 1rem)}}.image--medium{width:50%}.image--medium .image__container{width:100%;padding-bottom:71.25%}.image--large{width:100%}@media (min-width:992px){.image--large{width:60%}}.image--large .image__container{padding-bottom:59.37%;width:100%}.image--full-width{width:100%}.image--full-width .image__container{padding-bottom:59.37%;width:100%}.image--actual-size{width:100%}.image--actual-size .image__container{height:0;position:relative;width:100%;padding-bottom:60%}html{font-family:IBM Plex Mono,monospace;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:IBM Plex Mono,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em IBM Plex Mono,monospace;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:IBM Plex Mono,monospace;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.banner{display:flex;align-items:center;position:relative;padding:2rem 0;background-color:#e1e1e1}@media (min-width:992px){.banner{padding:3.444rem 3.444rem 4.444rem}}body,html{margin:0;padding:0;font-family:IBM Plex Mono,monospace;font-weight:500;color:#33332d;font-size:14px;line-height:1.555rem}@media (min-width:992px){body,html{font-size:18px}}body{padding-top:2.055rem}p{margin:0;text-align:left;line-height:1.5em}a,p{color:#33332d}a{text-decoration:none}.container{position:relative;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;width:90%;max-width:1200px}.hidden{display:none!important}.centered{text-align:center}.spacing{margin-top:2rem}@media (min-width:992px){.spacing{margin-top:5rem}}.spacing--small{margin-top:1rem}@media (min-width:992px){.spacing--small{margin-top:3.444rem}}.spacing--large{margin-top:4rem}@media (min-width:992px){.spacing--large{margin-top:10rem}}.spacing--extra-large{margin-top:4rem}@media (min-width:992px){.spacing--extra-large{margin-top:20rem}}.spacing--after{margin-bottom:2rem}@media (min-width:992px){.spacing--after{margin-bottom:5rem}}.spacing--after-small{margin-bottom:1rem}@media (min-width:992px){.spacing--after-small{margin-bottom:2.5rem}}.spacing--after-large{margin-bottom:4rem}@media (min-width:992px){.spacing--after-large{margin-bottom:10rem}}@media (max-width:991px){.spacing--mobile{margin-top:2rem}}.col-1{width:100%}@media (min-width:992px){.col-1{width:10%}}.col-2{width:100%}@media (min-width:992px){.col-2{width:20%}}.col-3{width:100%}@media (min-width:992px){.col-3{width:30%}}.col-4{width:100%}@media (min-width:992px){.col-4{width:40%}}.col-5{width:100%}@media (min-width:992px){.col-5{width:50%}}.col-6{width:100%}@media (min-width:992px){.col-6{width:60%}}.col-7{width:100%}@media (min-width:992px){.col-7{width:70%}}.col-8{width:100%}@media (min-width:992px){.col-8{width:80%}}.col-9{width:100%}@media (min-width:992px){.col-9{width:90%}}.col-10{width:100%}@media (min-width:992px){.col-10{width:100%}}@media (min-width:992px){.push-right-1{margin-left:10%}.push-right-2{margin-left:20%}.push-right-3{margin-left:30%}.push-right-4{margin-left:40%}.push-right-5{margin-left:50%}.push-left-1{margin-right:10%}.push-left-2{margin-right:20%}.push-left-3{margin-right:30%}.push-left-4{margin-right:40%}.push-left-5{margin-right:50%}.push-left{margin-right:auto}.push-right{margin-left:auto}}@media (max-width:991px){.col-5--mobile{width:50%}.col-10--mobile{width:100%}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}.centered-vertically{display:flex;flex-direction:column;justify-content:center}.nav-item-hover{font-size:1.111rem;font-weight:600;text-decoration:none;color:#33332d;padding:.2em}.nav-item-hover:active,.nav-item-hover:focus,.nav-item-hover:hover{color:#fff;background-color:#33332d}.nav-item-hover:active,.nav-item-hover:focus{outline:2px solid #706be4}.flex-fix-aligning:after,.flex-fix-aligning:before{content:"";width:30%;order:2}#footer .nav-item-hover{font-size:.777rem;font-weight:500}.triple-border{margin:5px;position:relative;padding:2px;border-radius:5px 0;transition:color .1s ease-in-out,background-color .1s ease-in-out}.triple-border:after,.triple-border:before{content:"";border:2px solid #33332d;border-radius:5px;position:absolute;width:calc(100% + 5px);height:calc(100% + 5px)}.triple-border:before{left:0;top:0}.triple-border:after{bottom:0;right:0}.triple-border__container{overflow:hidden;border-radius:3px 0}.triple-border--large-margin{margin:13px;padding:3px}.triple-border--large-margin:after,.triple-border--large-margin:before{content:"";border-width:3px;border-radius:13px;width:calc(100% + 13px);height:calc(100% + 13px)}.triple-border--large-margin .triple-border__container{border-radius:10px 0}.triple-border__logo{padding:.2rem;font-size:1.111rem;font-weight:600}.triple-border__return-tasks{font-size:.9rem;padding:1rem .2rem}</style><style data-href="/app.f588656cc80a065e5f1e.css">code[class*=language-],pre[class*=language-]{color:#fff;background:none;text-shadow:0 -.1em .2em #000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#4d4033}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:.3em solid #7a6652;border-radius:.5em;box-shadow:inset 1px 1px .5em #000}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998066}.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#d1949e}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#bde052}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f5b83d}.token.atrule,.token.attr-value,.token.keyword{color:#d1949e}.token.important,.token.regex{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}</style><style data-href="/component---src-templates-content-template-js.c0d0f03baf394c11b8c4.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);.course{position:relative}.course p{margin-left:3rem}.course p:not(:last-of-type){margin-bottom:1rem}.course h1,.course h2,.course h3,.course h4{margin-left:3rem;padding-bottom:2rem}.course h2:not(:first-of-type){margin-top:2rem}.course pre{margin:2rem 0;background-color:#33332d;color:#fff}.course em{font-family:Courier;font-style:normal;background-color:#e1e1e1;padding:1px 5px 2px}.course img{border:11px solid transparent}.course .banner,.course .container{position:static}.course .letter{width:4rem;height:4rem;border-width:5px;border-style:solid;border-radius:2.5rem;text-align:center;margin:1rem;line-height:.8em}@media (min-width:640px){.course .letter{-webkit-transform:translate(-3rem,5rem);transform:translate(-3rem,5rem)}}.course .letter,.course h1{font-size:3.444rem;font-weight:700}.course-content a{border:0;border-bottom-width:2px;border-style:solid;padding:2px}.gatsby-highlight-code-line{background-color:hsla(0,0%,88.2%,.3);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em}code[class*=language-],pre[class*=language-]{text-shadow:none}.body-text:not(:last-of-type){margin-bottom:2.5rem}.body-text__title{color:#33332d;font-size:1.44rem;line-height:1.25em;font-weight:700;margin:0;position:relative;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.body-text__content:not(:last-of-type){padding-bottom:2em}.bold{font-weight:700}.body-text--no-padding{padding:0!important}.scroll-navigation{padding-right:1rem}.course li{list-style-type:none}.level-h1{font-weight:700;padding-left:2.8rem;text-indent:-2.8rem}.level-h2{padding-left:1.6rem;text-indent:-1.6rem}.level-h1:hover,.level-h2:hover{cursor:pointer;background-color:#000;color:#fff}.level-h1:before,.level-h2:before{content:"-";margin-right:1rem}.accordion__container{margin-bottom:1rem}.accordion__title{padding-left:2.149rem!important;padding-right:2.149rem!important;font-size:1.111rem!important;font-weight:600}.accordion{background-color:#fff;border:3px solid #33332d;border-radius:5px;color:#444;cursor:pointer;padding:1rem;width:100%;text-align:left;outline:none;font-size:15px;transition:max-width .4s}.accordion:hover,.active{background-color:#ccc}.accordion:after{content:"\2795";font-size:1rem;color:#33332d;float:right;margin-left:5px}.active{border-color:#fff}.active:after{content:"\2796"}.panel{background-color:#fff;transition:height .3s;transition-timing-function:ease-in-out;overflow:hidden}.accordion--side-navigation .accordion{border:none;padding:0}.accordion--side-navigation .accordion:hover,.accordion--side-navigation .active{background-color:#33332d;color:#fff}.accordion--side-navigation .accordion:after,.accordion--side-navigation .active:after{content:""}.sub-header{color:#33332d;font-family:IBM Plex Mono,monospace;padding-bottom:1.357rem}@media (min-width:992px){.sub-header{padding-bottom:2.333rem}}</style><meta name="generator" content="Gatsby 2.0.53"/><title data-react-helmet="true"></title><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/app-fa244daad336a8aa7e8d.js"/><link as="script" rel="preload" href="/component---src-templates-content-template-js-2a50e8f99d285d1eb2fa.js"/><link as="script" rel="preload" href="/1-2caf8348e3ff7cbc2e8e.js"/><link as="script" rel="preload" href="/13-f61652fac8eae3082b73.js"/><link as="script" rel="preload" href="/2-a7fa0caf03e95b04c98b.js"/><link as="script" rel="preload" href="/webpack-runtime-da32002e7694c54ce478.js"/><link rel="preload" href="/static/d/408/path---osa-3-mongo-959-220-34dIRIS7m3iQK3lHj2jBbSHs.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div class="container" style="align-items:center"><a style="text-decoration:none" href="/"><div class="triple-border nav-item-hover " style="padding:0.2em"><div class="triple-border__container triple-border__logo" style="background-color:transparent">{() =&gt; fs}</div></div></a><div class="col-5 push-left-3" style="display:flex;justify-content:space-between;font-weight:bold"><a class="nav-item-hover" href="/about">KURSSISTA</a><a class="nav-item-hover" href="/#course-contents">KURSSIN SISÄLTÖ</a><a class="nav-item-hover" href="/faq">FAQs</a></div></div><div class="spacing--small spacing--after"><div class="course-container"><div class="banner spacing--after" style="background-image:url(/static/part-3-6502baf3ac1171cebf38f6bc8b3a36dc.svg);background-position:center center;background-size:80%;background-repeat:no-repeat;background-color:#EEAC5D"><div class="container"><div class="col-10 spacing spacing--after"><div class="arrow__container arrows--horizontal"><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:#EEAC5D;color:black"><a href="/about">FULLSTACK</a></div><div class="arrow__point " style="background-color:#EEAC5D;color:black"></div></div><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:#EEAC5D;color:black"><a href="/osa3">OSA 3</a></div><div class="arrow__point " style="background-color:#EEAC5D;color:black"></div></div><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:black;color:white">MONGO</div><div class="arrow__point " style="background-color:black;color:white"></div></div></div></div></div></div><div class="course"><div class="container"><div class="col-7 course-content push-right-3"><p class="col-1 letter" style="border-color:#EEAC5D">c</p><h1 class="sub-header ">Mongo</h1></div></div><h2>Mongo</h2>
<p>Jotta saisimme talletettua muistiinpanot pysyvästi, tarvitsemme tietokannan. Useimmilla laitoksen kursseilla on käytetty relaatiotietokantoja. Tällä kurssilla käytämme <a href="https://www.mongodb.com/">MongoDB</a>:tä, joka on ns. <a href="https://en.wikipedia.org/wiki/Document-oriented_database">dokumenttitietokanta</a>.</p>
<p>Dokumenttitietokannat poikkeavat jossain määrin relaatiotietokannoista niin datan organisointitapansa kuin kyselykielensäkin suhteen. Dokumenttitietokantojen ajatellaan kuuluvan sateenvarjotermin <a href="https://en.wikipedia.org/wiki/NoSQL">NoSQL</a> alle. Lisää dokumenttitietokannoista ja NoSQL:stä Tietokantojen perusteiden <a href="https://materiaalit.github.io/tikape-s17/part7/">viikon 7 materiaalista</a>.</p>
<p><strong>Lue nyt Tietokantojen perusteiden dokumenttitietokantoja kuvaava osuus.</strong> Jatkossa oletetaan, että hallitset käsitteet <em>dokumentti</em> ja <em>kokoelma</em> (collection).</p>
<p>MongoDB:n voi luonnollisesti asentaa omalle koneelle. Internetistä löytyy kuitenkin myös palveluna toimivia Mongoja (esim <a href="https://mlab.com/">mlab</a> ja <a href="https://www.mongodb.com/cloud/atlas">MongoDbCloud</a>) ja seuraava ohje olettaa, että käytössä on jo vuosien kokemuksella luotettavaksi havaittu <a href="https://mlab.com/">mlab</a>.</p>
<p>Mlab-kanta on helppo ottaa käyttöön suoraan <a href="https://elements.heroku.com/addons/mongolab">Herokun kautta</a>; vaikka tämä on maksutonta, edellyttää se luottokorttitietojen antamista Herokulle.</p>
<p>Määrittelemmekin seuraavassa kannan suoraan <a href="https://mlab.com/">mlab</a>:iin, jolloin luottokorttitietoja ei tarvita.</p>
<p>Aloita luomalla mlabiin käyttäjätili, saatuasi mlabilta verifiointimailin ja kirjauduttuasi mailin linkin kautta sisään, voit luoda tietokannan:</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/484a541bdc284efa4e2e7bd43874eafd/14be6/12a.png"/></picture>
<p>Määrittele esim. <em>Amazon web services</em>, tyypiksi ilmainen <em>sandbox</em> ja sijoituspaikaksi Irlanti ja anna kannalle sopiva nimi.</p>
<p>Kun kanta on hetken kuluttua valmis, mene tietokannan hallintanäkymään</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/0f2d39ba44b2ef84b0528475e1768265/14be6/12b.png"/></picture>
<p>Näkymä kertoo <em>MongoDB URI:n</em> eli osoitteen, jonka avulla sovelluksemme käyttämä MongoDB-kirjasto saa yhteyden kantaan.</p>
<p>Osoite näyttää seuraavalta:</p>
<div class="gatsby-highlight" data-language="text"><pre><code class="language-text">mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds211088.mlab.com:11088/fullstack-notes</code></pre></div>
<p>Tarvitsemme kannan käyttöä varten <em>dbuserin</em> eli käyttäjätunnuksen. Käyttäjätunnuksen luominen tapahtuu tietokannan hallintanäkymästä</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/6294bf96cc38b65eafb46ac177605404/14be6/12c.png"/></picture>
<p>Jos luotiin käyttäjätunnus <em>fullstack</em> jonka salasana on <em>sekred</em>, on tietokannan osoite seuraava:</p>
<div class="gatsby-highlight" data-language="text"><pre><code class="language-text">mongodb://fullstack:sekred@ds211088.mlab.com:11088/fullstack-notes</code></pre></div>
<p>Olemme nyt valmiina kannan käyttöön.</p>
<p>Voisimme käyttää kantaa Javascript-koodista suoraan Mongon virallisen
<a href="https://mongodb.github.io/node-mongodb-native/">MongoDB Node.js driver</a> -kirjaston avulla, mutta se on ikävän työlästä. Käytämmekin hieman korkeammalla tasolla toimivaa <a href="http://mongoosejs.com/index.html">mongoose</a>-kirjastoa.</p>
<p>Mongoosesta voisi käyttää luonnehdintaa <em>object document mapper</em> (ODM), ja sen avulla Javascript-olioiden tallettaminen mongon dokumenteiksi on suoraviivaista.</p>
<p>Asennetaan mongoose:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> mongoose --save</code></pre></div>
<p>Ei lisätä mongoa käsittelevää koodia heti backendin koodin sekaan, vaan tehdään erillinen kokeilusovellus tiedostoon <em>mongo.js</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// korvaa url oman tietokantasi urlilla. ethän laita salasanaa Githubiin!</span>
<span class="token keyword">const</span> url <span class="token operator">=</span>
  <span class="token string">&#x27;mongodb://fullstack:sekred@ds211088.mlab.com:11088/fullstack-notes&#x27;</span><span class="token punctuation">;</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Note <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Note&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Note</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> <span class="token string">&#x27;HTML on helppoa&#x27;</span><span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

note<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;note saved!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Kun koodi suoritetaan komennolla <em>node mongo.js</em> lisää mongoose tietokantaaan uuden dokumentin.</p>
<p>Mlab:in hallintanäkymä näyttää lisäämämme datan:</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/c08bcdb798d2ac00b72eb1396bcdf1f8/14be6/13a.png"/></picture>
<p>Kuten näkymä kertoo, on muistiinpanoa vastaava <em>dokumentti</em> lisätty kokoelmaan (collection) nimeltään <em>notes</em>.</p>
<p>Koodi sisältää muutamia mielenkiintoisia asioita. Aluksi avataan yhteys ja määritellään, että mongoose käyttää <em>promiseja</em>, eikä oldschool-takaisinkutsufunktioita:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> url <span class="token operator">=</span>
  <span class="token string">&#x27;mongodb://fullstack:fullstack@ds211088.mlab.com:11088/fullstack-notes&#x27;</span><span class="token punctuation">;</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Valitettavasti mongoosen dokumentaatiossa käytetään joka paikassa takaisinkutsufunktioita, joten sieltä ei kannata suoraan copypasteta koodia, sillä promisejen ja vanhanaikaisten callbackien sotkeminen samaan koodiin ei ole kovin järkevää.</p>
<div class="important">
Kannattaa muistaa, että tietokannan salasanaa ei kannata laittaa missään vaiheessa Githubiin!
</div>
<h3>Skeema</h3>
<p>Yhteyden avaamisen jälkeen määritellään mustiinpanoa vastaava <a href="http://mongoosejs.com/docs/models.html">model</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> Note <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Note&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Modelin parametrina määritellään <em>muistiinpanon</em> <a href="http://mongoosejs.com/docs/guide.html">skeema</a>, joka kertoo mongooselle, miten muistiinpano-oliot tulee tallettaa tietokantaan.</p>
<p>Ensimmäisenä parametrina oleva <em>Note</em> määrittelee, että mongoose tallettaa muistiinpanoa vastaavat oliot kokoelmaan nimeltään <em>notes</em> sillä <a href="http://mongoosejs.com/docs/models.html">mongoosen konventiona</a> on määritellä kokoelmien nimet monikossa (esim. <em>notes</em>), kun niihin viitataan modelin määrittelyssä yksikkömuodossa (esim. <em>Note</em>).</p>
<p>Mongoosen dokumentaatiossa skeema ja sitä vastaava model määritellään kumpikin erikseen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> noteSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Note <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Note&#x27;</span><span class="token punctuation">,</span> noteSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Koska meillä ei ole skeema-oliolle muuta käyttöä kuin modelin parametrina, käytämme hyväksemme sitä, että skeema voidaan määritellä modeleille suoraan antamalla toisena parametrina skeeman määrittelevä olio.</p>
<p>Dokumenttikannat, kuten Mongo ovat <em>skeemattomia</em>, eli tietokanta itsessään ei välitä mitään sinne talletettavan tiedon muodosta. Samaan kokoelmaankin on mahdollista tallettaa olioita joilla on täysin eri kentät.</p>
<p>Mongoosea käytettäessä periaatteena on kuitenkin se, että tietokantaan talletettavalle tiedolle määritellään <em>sovelluksen koodin tasolla skeema</em>, joka määrittelee minkä muotoisia olioita kannan eri kokoelmiin talletetaan.</p>
<h3>Olioiden luominen ja tallettaminen</h3>
<p>Seuraavaksi sovellus luo muistiinpanoa vastaavan <a href="http://mongoosejs.com/docs/models.html">model</a>:in avulla muistiinpano-olion:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Note</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> <span class="token string">&#x27;Selain pystyy suorittamaan vain javascriptiä&#x27;</span><span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Modelit ovat ns. <em>konstruktorifunktioita</em>, jotka luovat parametrien perusteella Javascript-olioita. Koska oliot on luotu modelien konstruktorifunktiolla, niillä on kaikki modelien ominaisuudet, eli joukko metodeja, joiden avulla olioita voidaan mm. tallettaa tietokantaan.</p>
<p>Tallettaminen tapahtuu metodilla <em>save</em>. Metodi palauttaa <em>promisen</em>, jolle voidaan rekisteröidä <em>then</em>-metodin avulla tapahtumankäsittelijä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">note<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;note saved!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Kun olio on tallennettu kantaan, kutsutaan <em>then</em>:in parametrina olevaa tapahtumankäsittelijää, joka sulkee tietokantayhteyden komennolla <code>mongoose.connection.close()</code>. Ilman yhteyden sulkemista ohjelman suoritus ei pääty.</p>
<p>Tallennusoperaation tulos on takaisinkutsun parametrissa <em>result</em>. Yhtä olioa tallentaessamme tulos ei ole kovin mielenkiintoinen, olion sisällön voi esim. tulostaa konsoliin jos haluaa tutkia sitä tarkemmin sovelluslogiikassa tai esim. debugatessa.</p>
<p>Talletetaan kantaan myös pari muuta muistiinpanoa muokkaamalla dataa koodista ja suorittamalla ohjelma uudelleen.</p>
<h3>Olioiden hakeminen tietokannasta</h3>
<p>Kommentoidaan koodista uusia muistiinpanoja generoiva osa, ja korvataan se seuraavalla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">Note<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>note<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Kun koodi suoritetaan, kantaan talletetut muistiinpanot tulostuvat.</p>
<p>Oliot haetaan kannasta <em>Note</em>-modelin metodilla <a href="http://mongoosejs.com/docs/api.html#find_find">find</a>. Metodin parametrina on hakuehto. Koska hakuehtona on tyhjä olio <code>{}</code>, saimme kannasta kaikki <em>notes</em>-kokoelmaan talletetut oliot.</p>
<p>Hakuehdot noudattavat mongon <a href="https://docs.mongodb.com/manual/reference/operator/">syntaksia</a>.</p>
<p>Voisimme hakea esim. ainoastaan tärkeät muistiinpanot seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">Note<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> important<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3>Tehtäviä</h3>
<p>Tee nyt tehtävä <a href="/teht%C3%A4v%C3%A4t#mongoosen-alkeet">3.12</a></p>
<h2>Tietokantaa käyttävä backend</h2>
<p>Nyt meillä on periaatteessa hallussamme riittävä tietämys ottaa mongo käyttöön sovelluksessamme.</p>
<p>Aloitetaan nopean kaavan mukaan, copypastetaan tiedostoon <em>index.js</em> mongoosen määrittelyt, eli</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> url <span class="token operator">=</span>
  <span class="token string">&#x27;mongodb://fullstack:sekred@ds211088.mlab.com:11088/fullstack-notes&#x27;</span><span class="token punctuation">;</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Note <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Note&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ja muutetaan kaikkien muistiinpanojen hakemisesta vastaava käsittelijä seuraavaan muotoon</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Voimme todeta selaimella, että backend toimii kaikkien dokumenttien näyttämisen osalta:</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/2ac106c1b6fddd3626f67bda6577c2ce/14be6/14.png"/></picture>
<p>Toiminnallisuus on muuten kunnossa, mutta frontend olettaa, että olioiden yksikäsitteinen tunniste on kentässä <em>id</em>. Emme myöskään halua näyttää frontendille mongon versiointiin käyttämää kenttää <em>__v</em>. Tehdään pieni apufunktio, jonka avulla yksittäinen muistiinpano saadaan muutettua mongon sisäisestä esitysmuodosta haluamaamme muotoon:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">formatNote</span> <span class="token operator">=</span> note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> note<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> note<span class="token punctuation">.</span>date<span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> note<span class="token punctuation">.</span>important<span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> note<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>ja palautetaan HTTP-pyynnön vastauksena funktion avulla muotoiltuja oliota:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>formatNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Nyt siis muuttujassa <em>notes</em> on taulukollinen mongon palauttamia olioita. Kun suoritamme operaation <code>notes.map(formatNote)</code> seurauksena on uusi taulukko, missä on jokaista alkuperäisen taulukon alkiota vastaava funktion <em>formatNote</em> avulla muodostettu alkio.</p>
<p>Jos kannasta haettavilla olioilla olisi suuri määrä kenttiä, apufunktio <em>formatNote</em> kannattaisi muotoilla hieman geneerisemmässä muodossa, esim:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">formatNote</span> <span class="token operator">=</span> note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> formattedNote <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>note<span class="token punctuation">.</span>_doc<span class="token punctuation">,</span> id<span class="token punctuation">:</span> note<span class="token punctuation">.</span>_id <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span> formattedNote<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> formattedNote<span class="token punctuation">.</span>__v<span class="token punctuation">;</span>

  <span class="token keyword">return</span> formattedNote<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Ensimmäinen rivi luo uuden olion, mihin kopioituu kaikki vanhan olion kentät. Uuteen olioon lisätään myös kenttä <em>id</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> formattedNote <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>note<span class="token punctuation">.</span>_doc<span class="token punctuation">,</span> id<span class="token punctuation">:</span> note<span class="token punctuation">.</span>_id <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Ennen olion palauttamista turhat kentät poistetaan.</p>
<p>Jos ohjelma käyttäisi muunkin tyyppisiä olioita kuin <em>muistiinpanoja</em> sopisi sama funktio niidenkin muotoiluun. Jatkon kannalta on kuitenkin parempi, että pidämme alkuperäisen version funktiosta.</p>
<p>On myös mahdollista estää mongoosea palauttamasta tiettyjen kenttien arvoa, tai pyytää sitä palauttamaan vain tietyt kentät. Saamme estettyä parametrin <em>__v</em>:n lisäämällä <em>find</em>-metodiin toiseksi parametriksi <em>{\</em>_v: 0}_ seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> __v<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>formatNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Kyselyjen palauttamien kenttien määrittely tapahtuu Mongon <a href="https://docs.mongodb.com/manual/tutorial/project-fields-from-query-results/">syntaksin mukaan</a>.</p>
<h3>Tietokantamäärittelyjen eriyttäminen omaksi moduuliksi</h3>
<p>Ennen kuin täydennämme backendin muutkin osat käyttämään tietokantaa, eriytetään mongoose-spesifinen koodi omaan moduuliin.</p>
<p>Tehdään moduulia varten hakemisto <em>models</em> ja sinne tiedosto <em>note.js</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> url <span class="token operator">=</span>
  <span class="token string">&#x27;mongodb://fullstack:sekred@ds211088.mlab.com:11088/fullstack-notes&#x27;</span><span class="token punctuation">;</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Note <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Note&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  date<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>
  important<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Note<span class="token punctuation">;</span></code></pre></div>
<p>Noden <a href="https://nodejs.org/docs/latest-v8.x/api/modules.html">moduulien</a> määrittely poikkeaa hiukan osassa 2 määrittelemistämme frontendin käyttämistä <a href="/osa2/#refaktorointia---moduulit">ES6-moduuleista</a>.</p>
<p>Moduulin ulos näkyvä osa määritellään asettamalla arvo muuttujalle <em>module.exports</em>. Asetamme arvoksi määritellyn modelin <em>Note</em>. Muut moduulin sisällä määritellyt asiat, esim. muuttujat <em>mongoose</em> ja <em>url</em> eivät näy moduulin käyttäjälle.</p>
<p>Moduulin käyttöönotto tapahtuu lisäämällä tiedostoon <em>index.js</em> seuraava rivi</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> Note <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./models/note&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Näin muuttuja <em>Note</em> saa arvokseen saman olion, jonka moduuli määrittelee.</p>
<h3>Muut operaatiot</h3>
<p>Muutetaan nyt kaikki operaatiot tietokantaa käyttävään muotoon.</p>
<p>Uuden muistiinpanon luominen tapahtuu seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">.</span>content <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&#x27;content missing&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Note</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> body<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> body<span class="token punctuation">.</span>important <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  note<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>savedNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Muistiinpano-oliot siis luodaan <em>Note</em>-konstruktorifunktiolla. Pyyntöön vastataan <em>save</em>-operaation takaisinkutsufunktion sisällä. Näin varmistutaan, että operaatio vastaus tapahtuu vain jos operaatio on onnistunut. Palaamme virheiden käsittelyyn myöhemmin.</p>
<p>Takaisinkutsufunktion parametrina oleva <em>savedNote</em> on talletettu muistiinpano. HTTP-pyyntöön palautetaan kuitenkin siitä funktiolla <em>formatNote</em> formatoitu muoto:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>savedNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Yksittäisen muistiinpanon tarkastelu muuttuu muotoon</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes/:id&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>note<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3>Frontendin ja backendin yhteistominnallisuuden varmistaminen</h3>
<p>Kun backendia laajennetaan, kannattaa sitä testailla aluksi <strong>ehdottomasti selaimella, postmanilla tai VS Coden REST clientillä:</strong>. Seuraavassa kokeillaan uuden muistiinpanon luomista tietokannan käyttöönoton jälkeen:</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/2def90a692336392cb9534ae8253a381/14be6/14b.png"/></picture>
<p>Vasta kun kaikki on todettu toimivaksi, kannattaa siirtyä testailemaan että muutosten jälkeinen backend toimii yhdessä myös frontendin kanssa. Kaikkien kokeilujen tekeminen ainoastaan frontendin kautta on todennäköisesti varsin tehotonta.</p>
<p>Todennäköisesti voi olla kannattavaa edetä frontin ja backin integroinnissa toiminnallisuus kerrallaan, eli ensin voidaan toteuttaa esim. kaikkien muistiinpanojen näyttäminen backendiin ja testata että toiminnallisuus toimii selaimella. Tämän jälkeen varmistetaan, että frontend toimii yhteen muutetun backendin kanssa. Kun kaikki on todettu olevan kunnossa, siirrytään seuraavan ominaisuuden toteuttamiseen.</p>
<p>Kun kuvioissa on mukana tietokanta, on tietokannan tilan tarkastelu mlabin hallintanäkymästä varsin hyödyllistä, usein myös suoraan tietokantaa käyttävät Node-apuohjelmat, kuten tiedostoon <em>mongo.js</em> kirjoittamamme koodi auttavat sovelluskehityksen edetessä.</p>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part3-notes-backend/tree/part3-3">githubissa</a>, tagissa <em>part3-3</em>.</p>
<h3>Tehtäviä</h3>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#backend-ja-tietokanta">3.13-3.15</a></p>
<h3>Virheiden käsittely</h3>
<p>Jos yritämme mennä selaimella sellaisen yksittäisen muistiinpanon sivulle, jota ei ole olemassa, eli esim. urliin <a href="http://localhost:3001/api/notes/5a3b80015b6ec6f1bdf68d">http://localhost:3001/api/notes/5a3b80015b6ec6f1bdf68d</a> missä <em>5a3b80015b6ec6f1bdf68d</em> ei ole minkään tietokannassa olevan muistiinpanon tunniste, jää selain &quot;jumiin&quot; sillä palvelin ei vastaa pyyntöön koskaan.</p>
<p>Palvelimen konsolissa näkyykin virheilmoitus:</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/2d82fd94406b1a9ca544c70fecd262dc/14be6/15.png"/></picture>
<p>Kysely on epäonnistunut ja kyselyä vastaava promise mennyt tilaan <em>rejected</em>. Koska emme käsittele promisen epäonnistumista, ei pyyntöön vastata koskaan. Osassa 2 tutustuimme jo <a href="/osa2#promise-ja-virheet">promisejen virhetilanteiden käsittelyyn</a>.</p>
<p>Lisätään tilanteeseen yksinkertainen virheidenkäsittelijä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes/:id&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>note<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Kaikissa virheeseen päättyvissä tilanteissa HTTP-pyyntöön vastataan statuskoodilla 404 not found. Konsoliin tulostetaan tarkempi tieto virheestä.</p>
<p>Tapauksessamme on itseasiassa olemassa kaksi erityyppistä virhetilannetta. Toinen vastaa sitä, että yritetään hakea muistiinpanoa virheellisen muotoisella <em>id</em>:llä, eli sellasiella mikä ei vastaa mongon id:iden muotoa.</p>
<p>Jos teemme näin tulostuu konsoliin:</p>
<pre>

Method: GET
Path:   /api/notes/5a3b7c3c31d61cb9f8a0343
Body:   {}
---
{ CastError: Cast to ObjectId failed for value &quot;5a3b7c3c31d61cb9f8a0343&quot; at path &quot;_id&quot;
    at CastError (/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/node_modules/mongoose/lib/error/cast.js:27:11)
    at ObjectId.cast (/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/node_modules/mongoose/lib/schema/objectid.js:158:13)
    ...
</pre>
<p>Toinen virhetilanne taas vastaa tilannetta, missä haettavan muistiinpanon id on periaatteessa oikeassa formaatissa, mutta tietokannasta ei löydy indeksillä mitään:</p>
<pre>

Method: GET
Path:   /api/notes/5a3b7c3c31d61cbd9f8a0343
Body:   {}
---
TypeError: Cannot read property &#x27;_doc&#x27; of null
    at formatNote (/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/index.js:46:33)
    at Note.findById.then.note (/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/index.js:65:21)
</pre>
<p>Nämä tilanteet on syytä erottaa toisistaan, ja itseasiassa jälkimmäinen poikkeus on oman koodimme <code>/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/index.js:46</code> aiheuttama.</p>
<p>Muutetaan koodia seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes/:id&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>note<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>note<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&#x27;malformatted id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Jos kannasta ei löydy haettua olioa, muuttujan <em>note</em> arvo on <em>undefined</em> ja koodi ajautuu <em>else</em>-haaraan. Siellä vastataan kyselyyn <em>404 not found</em>.</p>
<p>Jos id ei ole hyväksyttävässä muodossa, ajaudutaan <em>catch</em>:in avulla määriteltyyn virheidenkäsittelijään. Sopiva statuskoodi on <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.1">400 bad request</a> koska kyse on juuri siitä:</p>
<blockquote>
<p>The request could not be understood by the server due to malformed syntax. The client SHOULD NOT repeat the request without modifications.</p>
</blockquote>
<p>Vastaukseen on lisätty myös hieman dataa kertomaan virheen syystä.</p>
<p>Promisejen yhteydessä kannattaa melkeinpä aina lisätä koodiin myös virhetilainteiden käsittely, muuten seurauksena on usein hämmentäviä vikoja.</p>
<p>Ei ole koskaan huono idea tulostaa poikkeuksen aiheuttanutta olioa konsoliin virheenkäsittelijässä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&#x27;malformatted id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Virheenkäsittelijään joutumisen syy voi olla joku ihan muu kuin mitä on tullut alunperin ajatelleeksi. Jos virheen tulostaa konsoliin, voi säästyä pitkiltä ja turhauttavilta väärää asiaa debuggaavilta sessioilta.</p>
<p>Aina kun ohjelmoit ja projektissa on mukana backend <strong>tulee ehdottomasti koko ajan pitää silmällä backendin konsolin tulostuksia</strong>. Jos työskentelet pienellä näytöllä, riittää että konsolista on näkyvissä edes pieni kaistale:</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/b5656dca7416a1a37670dc5a51bfbbc7/14be6/15b.png"/></picture>
<h3>loput operaatiot</h3>
<p>Toteutetaan vielä jäljellä olevat operaatiot, eli yksittäisen muistiinpanon poisto ja muokkaus.</p>
<p>Poisto onnistuu helpoiten metodilla <a href="http://mongoosejs.com/docs/api.html#findbyidandremove_findByIdAndRemove">findByIdAndRemove</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes/:id&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&#x27;malformatted id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Vastauksena on statauskoodi <em>204 no content</em> molemmissa &quot;onnistuneissa&quot; tapauksissa, eli jos olio poistettiin tai olioa ei ollut mutta <em>id</em> oli periaatteessa oikea. Takaisinkutsun parametrin <em>result</em> perusteella olisi mahdollisuus haarautua ja palauttaa tilanteissa eri statuskoodi jos sille on tarvetta.</p>
<p>Muistiinpanon tärkeyden muuttamisen mahdollistava olemassaolevan muistiinpanon päivitys onnistuu helposti metodilla <a href="http://mongoosejs.com/docs/api.html#findoneandupdate_findOneAndUpdate">findOneAndUpdate</a>. Tässä ja myöhemmin sivulla on <em>findOneAndUpdate</em>, mutta koodissa alla <a href="http://mongoosejs.com/docs/api.html#findbyidandupdate_findByIdAndUpdate">findByIdAndUpdate</a>, joka vastaa <code class="language-text">findOneAndUpdate({ _id: id }, ...)</code> kutsua.</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes/:id&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> body<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> body<span class="token punctuation">.</span>important<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  Note<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> note<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">new</span><span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>updatedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>updatedNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&#x27;malformatted id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Operaatio mahdollistaa myös muistiinpanon sisällön editoinnin. Päivämäärän muuttaminen ei ole mahdollista.</p>
<p>Huomaa, että metodin <em>findOneAndUpdate</em> parametrina tulee antaa normaali Javascript-olio, eikä uuden olion luomisessa käytettävä <em>Note</em>-konstruktorifunktiolla luotu olio.</p>
<p>Pieni, mutta tärkeä detalji liittyen operaatioon <em>findOneAndUpdate</em>. Oletusarvoisesti tapahtumankäsittelijä saa parametrikseen <em>updatedNote</em> päivitetyn olion <a href="http://mongoosejs.com/docs/api.html#findoneandupdate_findOneAndUpdate">ennen muutosta</a> olleen tilan. Lisäsimme operaatioon parametrin <code>{ new: true }</code> jotta saamme muuttuneen olion palautetuksi kutsujalle.</p>
<p>Backend vaikuttaa toimivan postmanista ja VS Code REST clientistä tehtyjen kokeilujen perusteella ja myös frontend toimii moitteettomasti tietokantaa käyttävän backendin kanssa.</p>
<h3>Tehtäviä</h3>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#lis%C3%A4%C3%A4-operaatioita">3.16-3.18</a></p>
<h2>Refaktorointia - promisejen ketjutus</h2>
<p>Useat routejen tapahtumankäsittelijöistä muuttivat palautettavan datan oikeaan formaattiin kutsumalla metodia <em>formatNote</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">formatNote</span> <span class="token operator">=</span> note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> note<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> note<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> note<span class="token punctuation">.</span>date<span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> note<span class="token punctuation">.</span>important<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>esim uuden muistiinpanon luomisessa metodia kutsutaan <em>then</em>:in parametrina palauttama olio parametrina:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  note<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">formatNote</span><span class="token punctuation">(</span>savedNote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Voisimme tehdä saman myös hieman tyylikkäämmin <a href="https://javascript.info/promise-chaining">promiseja ketjuttamalla</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  note
    <span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">formatNote</span><span class="token punctuation">(</span>savedNote<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedAndFormattedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>savedAndFormattedNote<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Eli ensimmäisen <em>then</em>:in takaisinkutsussa otamme mongoosen palauttaman olion <em>savedNote</em> ja formatoimme sen. Operaation tulos palautetaan returnilla. Kuten osassa 2 <a href="/osa2/#palvelimen-kanssa-tapahtuvan-kommunikoinnin-erist%C3%A4minen-omaan-moduuliin">todettiin</a>, promisen then-metodi palauttaa myös promisen. Eli kun palautamme <em>formatNote(savedNote)</em>:n takaisinkutsufunktiosta, syntyy promise, jonka arvona on formatoitu muistiinpano. Pääsemme käsiksi arvoon rekisteröimällä <em>then</em>-kutsulla uuden tapahtumankäsittelijän.</p>
<p>Itseasiassa selviämme vieläkin tiiviimmällä koodilla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  note
    <span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>formatNote<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedAndFormattedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>savedAndFormattedNote<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>koska <em>formatNote</em> on viite funktioon, on oleellisesti ottaen kyse samasta kuin kirjoittaisimme:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  note
    <span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> savedNote<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>
        content<span class="token punctuation">:</span> savedNote<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
        date<span class="token punctuation">:</span> savedNote<span class="token punctuation">.</span>date<span class="token punctuation">,</span>
        important<span class="token punctuation">:</span> savedNote<span class="token punctuation">.</span>important<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>savedAndFormattedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>savedAndFormattedNote<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Sovelluksen vieminen tuotantoon</h2>
<p>Sovelluksen pitäisi toimia tuotannossa, eli herokussa sellaisenaan. Frontendin muutosten takia on tehtävä siitä uusi tuotantoversio ja kopioitava se backendiin.</p>
<p>Sovellusta voi käyttää sekä frontendin kautta <a href="https://fullstack-notes.herokuapp.com">https://fullstack-notes.herokuapp.com</a>, ja myös API:n <a href="https://fullstack-notes.herokuapp.com/api/notes">https://fullstack-notes.herokuapp.com/api/notes</a> suora käyttö selaimella ja postmanilla onnistuu.</p>
<p>Sovelluksessamme on tällä hetkellä eräs ikävä piirre. Tietokannan osoite on kovakoodattu backendiin ja samaa tietokantaa käytetään sekä tuotannossa, että sovellusta kehitettäessä.</p>
<p>Tarvitsemme oman kannan sovelluskehitystä varten. Luodaan mlabiin toinen tietokanta ja sille käyttäjä.</p>
<p>Tietokannan osoitetta ei kannata kirjoittaa koodiin. Eräs hyvä tapa tietokannan osoitteen määrittelemiseen on <a href="https://en.wikipedia.org/wiki/Environment_variable">ympäristömuuttujien</a> käyttö.</p>
<p>Talletetaan kannan osoite ympäristömuuttujaan <em>MONGODB</em>URI_.</p>
<p>Ympäristömuuttujiin pääsee Node-sovelluksesta käsiksi seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> url <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Note<span class="token punctuation">;</span></code></pre></div>
<p>Tee muutos koodiin ja deployaa uusi versio herokuun. Sovelluksen pitäisi toimia kun asetat ympäristömuuttujan arvo herokuun komennolla <em>heroku config:set</em></p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">heroku config:set MONGODB_URI<span class="token operator">=</span>mongodb://fullstack:sekred@ds211088.mlab.com:11088/fullstack-notes</code></pre></div>
<p>Sovelluksen pitäisi toimia muutosten jälkeen. Aina kaikki ei kuitenkaan mene suunnitelmien mukaan. Jos ongelmia ilmenee, <em>heroku logs</em> auttaa. Oma sovellukseni ei toiminut muutoksen jälkeen. Loki kertoi seuraavaa</p>
<picture><img style="border-color:#EEAC5D" alt="fullstack content" src="/static/587a9adad88b7baec09ea3997325169d/14be6/21.png"/></picture>
<p>eli tietokannan osoite olikin jostain syystä määrittelemätön. Komento <em>heroku config</em> paljasti että olin vahingossa määritellyt ympäristömuuttujan <em>MONGO</em>URL_ kun koodi oletti sen olevan nimeltään <em>MONGODB</em>URI_.</p>
<p>Muutoksen jälkeen sovellus ei toimi paikallisesti, koska ympäristömuuttujalla <em>MONGODB</em>URI_ ei ole mitään arvoa. Tapoja määritellä ympäristömuuttujalle arvo on monia, käytetään nyt <a href="https://www.npmjs.com/package/dotenv">dotenv</a>-kirjastoa.</p>
<p>Asennetaan kirjasto komennolla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> dotenv --save</code></pre></div>
<p>Sovelluksen juurihakemistoon tehdään sitten tiedosto nimeltään <em>.env</em>, minne tarvittavien ympäristömuuttujien arvot asetetaan. Määritellään tiedostoon sovelluskehitystä varten luodun tietokannan osoite:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">MONGODB_URI<span class="token operator">=</span>mongodb://fullstack:sekred@ds111078.mlab.com:11078/fullstact-notes-dev</code></pre></div>
<p>Tiedosto .env <strong>tulee heti gitignorata</strong> sillä emme halua julkaista .env -tiedoston sisältöä verkkoon.</p>
<p>dotenvissä määritellyt ympäristömuuttujat otetaan koodissa käyttöön komennolla</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;dotenv&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ja niihin viitataan Nodessa kuten &quot;normaaleihin&quot; ympäristömuuttujiin syntaksilla <em>process.env.MONGODB</em>URI_</p>
<p>Otetaan dotenv käyttöön seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#x27;production&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;dotenv&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> url <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Note<span class="token punctuation">;</span></code></pre></div>
<p>Nyt dotenvissä olevat ympäristömuuttujat otetaan käyttöön ainoastaan silloin kun sovellus ei ole <em>production</em>- eli tuotantomoodissa (kuten esim. Herokussa).</p>
<p>Uudelleenkäynnistyksen jälkeen sovellus toimii taas paikallisesti.</p>
<p>Node-sovellusten konfigurointiin on olemassa ympäristömuuttujien ja dotenvin lisäksi lukuisia vaihtoehtoja, mm. <a href="https://github.com/lorenwest/node-config">node-conf</a>. Ympäristömuuttujien käyttö riittää meille nyt, joten emme rupea overengineeraamaan. Palaamme aiheeseen kenties myöhemmin.</p>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part3-notes-backend/tree/part3-4">githubissa</a>, tagissa <em>part3-4</em>.</p>
<h3>Tehtäviä</h3>
<p>Tee nyt tehtävät <a href="/teht%C3%A4v%C3%A4t#loppuhuipennus">3.19 - 3.21</a></p></div><div class="container spacing element--flex element--column element--centered"><div class="body-text "><p class="body-text__content bold">Tehtävien palautus</p></div><a href="https://studies.cs.helsinki.fi/fullstackopen/" style="padding:1rem 0" class="col-2 centered spacing--small"><div class="triple-border nav-item-hover triple-border--large-margin" style="padding:"><div class="triple-border__container triple-border__return-tasks" style="background-color:transparent">Palauta tehtävät palautussovellukseen</div></div></a></div><div class="container spacing spacing--after-large "><a class="push-right-1" href="/osa2"><div class=" element--flex element--column"><p style="text-align:right">Osa <!-- -->2</p><b>Edellinen osa</b></div></a><a class="push-left-1" href="/osa4"><div class=" element--flex element--column"><p>Osa <!-- -->4</p><b>Seuraava osa</b></div></a></div></div></div><div id="footer" class="container spacing--after" style="justify-content:space-between"><div class="col-4" style="display:flex;justify-content:space-between"><a href="https://www.helsinki.fi/" class="image--large image--contain" style="width:100%"><div class="image image--large image--contain "><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/hgin_yliopisto-30c68104749d830b6cef6ea8c6339b16.png" alt=""/></div></div></a><a href="https://www.houston-inc.com/" class="push-right-2" style="width:100%"><div class="image image--large image--contain "><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/houston_logo-356bd2a9a75b44bdf7897b2cdd387600.png" alt=""/></div></div></a></div><div class="col-2" style="display:flex;justify-content:space-between;align-items:center"><a class="nav-item-hover" style="margin-left:4.5rem" href="/about">KURSSISTA</a><a class="nav-item-hover" href="/faq">FAQs</a></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-content-template-js","jsonName":"osa-3-mongo-959","path":"/osa3/mongo"};window.dataPath="408/path---osa-3-mongo-959-220-34dIRIS7m3iQK3lHj2jBbSHs";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.f588656cc80a065e5f1e.css","/app-fa244daad336a8aa7e8d.js"],"component---src-templates-content-template-js":["/component---src-templates-content-template-js.c0d0f03baf394c11b8c4.css","/component---src-templates-content-template-js-2a50e8f99d285d1eb2fa.js"],"component---src-templates-part-intro-template-js":["/component---src-templates-part-intro-template-js.38e4ec59db5f27597a1e.css","/component---src-templates-part-intro-template-js-fb13bf43df31b8fcadfe.js"],"component---src-pages-404-js":["/component---src-pages-404-js.fd93c6ad38e28b06a68d.css","/component---src-pages-404-js-61f260769b59a0878ce8.js"],"component---src-pages-about-js":["/component---src-pages-about-js.e7097f581891269e2d4a.css","/component---src-pages-about-js-bad52414f65d7233e01d.js"],"component---src-pages-companies-js":["/component---src-pages-companies-js.3e06a6290cc684db40a8.css","/component---src-pages-companies-js-0037a4762b91dde960fd.js"],"component---src-pages-faq-js":["/component---src-pages-faq-js.3e06a6290cc684db40a8.css","/component---src-pages-faq-js-c9376b248d0ab545f777.js"],"component---src-pages-index-js":["/component---src-pages-index-js.054d4c52cecca6da6c62.css","/component---src-pages-index-js-4101432097c35cc71ed2.js"]};/*]]>*/</script><script src="/webpack-runtime-da32002e7694c54ce478.js" async=""></script><script src="/2-a7fa0caf03e95b04c98b.js" async=""></script><script src="/13-f61652fac8eae3082b73.js" async=""></script><script src="/1-2caf8348e3ff7cbc2e8e.js" async=""></script><script src="/component---src-templates-content-template-js-2a50e8f99d285d1eb2fa.js" async=""></script><script src="/app-fa244daad336a8aa7e8d.js" async=""></script></body></html>
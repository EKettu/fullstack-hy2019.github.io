<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/4.66d0c9c8f4627206aedf.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);.arrow__container{position:relative}.arrow__container:not():first-child{border-left:none}.arrow__container:not():first-child:before{content:"";background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NzcuMTc1IDQ3Ny4xNzUiPjxwYXRoIGQ9Ik0zNjAuNzMxIDIyOS4wNzVsLTIyNS4xLTIyNS4xYy01LjMtNS4zLTEzLjgtNS4zLTE5LjEgMHMtNS4zIDEzLjggMCAxOS4xbDIxNS41IDIxNS41LTIxNS41IDIxNS41Yy01LjMgNS4zLTUuMyAxMy44IDAgMTkuMSAyLjYgMi42IDYuMSA0IDkuNSA0IDMuNCAwIDYuOS0xLjMgOS41LTRsMjI1LjEtMjI1LjFjNS4zLTUuMiA1LjMtMTMuOC4xLTE5eiIvPjwvc3ZnPg==) no-repeat;background-size:contain;position:absolute;top:0;left:0;height:100%;width:100%}.arrows--horizontal{display:flex;position:relative;margin:0;align-items:flex-start}.arrow__wrapper{display:flex;justify-content:flex-start;align-items:center;margin:0}.arrow__wrapper:first-of-type{border-right:none;z-index:20}.arrow__wrapper:nth-of-type(n+2){margin-left:-4rem;z-index:10}.arrow__wrapper:nth-of-type(n+2) .arrow__rectangle{border-left:none;padding-left:4rem}.arrow__wrapper:nth-of-type(3){z-index:5}.arrow__rectangle{padding:1rem;justify-content:center;align-items:center;border:2px solid #33332d;border-right:none;z-index:2;overflow:hidden}.arrow__rectangle .bold{font-weight:600}.arrow__rectangle--thick-border{border:3px solid #33332d;border-right:none}.arrow__point{padding:1.25rem;border:2px solid #33332d;border-bottom:none;border-left:none;-webkit-transform:translate(-1.3rem) rotate(45deg);transform:translate(-1.3rem) rotate(45deg);z-index:1;overflow:hidden}.arrow__point--thick-border{border:3px solid #33332d;border-bottom:none;border-left:none}.arrow__wrapper--stacked{display:flex;justify-content:flex-start;align-items:center;margin:auto auto auto 0}.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:-2px}.arrow--stacked-letter{margin-right:2rem}.arrow--stacked-title{text-transform:uppercase;white-space:nowrap}.arrow__container--with-link{width:100%!important}.element--flex{display:flex;flex-wrap:wrap}.element--space-around{justify-content:space-around}.element--space-between{justify-content:space-between}.element--column{flex-direction:column}.element--centered{align-items:center}.element--horizontal-half{width:45%}.element--auto-bottom-margin{margin-bottom:auto}.element--flex-start{align-content:flex-start}.banner{display:flex;align-items:center;position:relative;padding:2.22rem 0;background-color:#e1e1e1}@media (min-width:992px){.banner{padding:3.444rem 3.444rem 4.444rem}}.image__content{position:absolute;top:0;left:0;height:100%;width:100%;-o-object-fit:cover;object-fit:cover}.image--contain .image__content{-o-object-fit:contain;object-fit:contain}.image{border-radius:10px;overflow:hidden;width:100%;position:relative}@media (min-width:992px){.image{width:40%}}.image .image__container{height:0;position:relative;width:100%;padding-bottom:89.0625%}.image--circle{border-radius:50%}.image--circle .image__content{background-color:#e1e1e1}.image--square-big{width:100%}.image--square-big .image__container{width:100%;padding-bottom:100%}.image--extra-small{width:8%}.image--extra-small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--extra-small{width:calc(33.33333% - 1rem)}}.image--small{width:15%}.image--small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--small{width:calc(33.33333% - 1rem)}}.image--medium{width:50%}.image--medium .image__container{width:100%;padding-bottom:71.25%}.image--large{width:100%}@media (min-width:992px){.image--large{width:60%}}.image--large .image__container{padding-bottom:59.37%;width:100%}.image--full-width{width:100%}.image--full-width .image__container{padding-bottom:59.37%;width:100%}.image--actual-size{width:100%}.image--actual-size .image__container{height:0;position:relative;width:100%;padding-bottom:60%}html{font-family:IBM Plex Mono,monospace;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:IBM Plex Mono,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em IBM Plex Mono,monospace;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:IBM Plex Mono,monospace;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}body,html{margin:0;padding:0;font-family:IBM Plex Mono,monospace;font-weight:500;color:#33332d;font-size:14px;line-height:1.555rem}@media (min-width:992px){body,html{font-size:18px}}body{padding-top:2.055rem}p{margin:0;text-align:left;line-height:1.5em}a,p{color:#33332d}a{text-decoration:none}.container{position:relative;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;width:90%;max-width:1200px}.hidden{display:none!important}.centered{text-align:center}.spacing{margin-top:2.22rem}@media (min-width:992px){.spacing{margin-top:5.55rem}}.spacing--small{margin-top:1.11rem}@media (min-width:992px){.spacing--small{margin-top:3.444rem}}.spacing--large{margin-top:4.44rem}@media (min-width:992px){.spacing--large{margin-top:11.1rem}}.spacing--extra-large{margin-top:4.44rem}@media (min-width:992px){.spacing--extra-large{margin-top:22.2rem}}.spacing--after{margin-bottom:2.22rem}@media (min-width:992px){.spacing--after{margin-bottom:5.55rem}}.spacing--after-small{margin-bottom:1.11rem}@media (min-width:992px){.spacing--after-small{margin-bottom:2.775rem}}.spacing--after-large{margin-bottom:4.44rem}@media (min-width:992px){.spacing--after-large{margin-bottom:11.1rem}}@media (max-width:991px){.spacing--mobile{margin-top:2.22rem}}.col-1{width:100%}@media (min-width:992px){.col-1{width:10%}}.col-2{width:100%}@media (min-width:992px){.col-2{width:20%}}.col-3{width:100%}@media (min-width:992px){.col-3{width:30%}}.col-4{width:100%}@media (min-width:992px){.col-4{width:40%}}.col-5{width:100%}@media (min-width:992px){.col-5{width:50%}}.col-6{width:100%}@media (min-width:992px){.col-6{width:60%}}.col-7{width:100%}@media (min-width:992px){.col-7{width:70%}}.col-8{width:100%}@media (min-width:992px){.col-8{width:80%}}.col-9{width:100%}@media (min-width:992px){.col-9{width:90%}}.col-10{width:100%}@media (min-width:992px){.col-10{width:100%}}@media (min-width:992px){.push-right-1{margin-left:10%}.push-right-2{margin-left:20%}.push-right-3{margin-left:30%}.push-right-4{margin-left:40%}.push-right-5{margin-left:50%}.push-left-1{margin-right:10%}.push-left-2{margin-right:20%}.push-left-3{margin-right:30%}.push-left-4{margin-right:40%}.push-left-5{margin-right:50%}.push-left{margin-right:auto}.push-right{margin-left:auto}}@media (max-width:991px){.col-5--mobile{width:50%}.col-10--mobile{width:100%}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}.centered-vertically{display:flex;flex-direction:column;justify-content:center}.nav-item-hover{font-size:1.111rem;font-weight:600;text-decoration:none;color:#33332d;padding:.2em}.nav-item-hover:active,.nav-item-hover:focus,.nav-item-hover:hover{color:#fff;background-color:#33332d}.nav-item-hover:active,.nav-item-hover:focus{outline:2px solid #706be4}.flex-fix-aligning:after,.flex-fix-aligning:before{content:"";width:30%;order:2}#footer .nav-item-hover{font-size:.777rem;font-weight:500}.triple-border{margin:5px;position:relative;padding:2px;border-radius:5px 0;transition:color .1s ease-in-out,background-color .1s ease-in-out}.triple-border:after,.triple-border:before{content:"";border:2px solid #33332d;border-radius:5px;position:absolute;width:calc(100% + 5px);height:calc(100% + 5px)}.triple-border:before{left:0;top:0}.triple-border:after{bottom:0;right:0}.triple-border__container{overflow:hidden;border-radius:3px 0}.triple-border--large-margin{margin:13px;padding:3px}.triple-border--large-margin:after,.triple-border--large-margin:before{content:"";border-width:3px;border-radius:13px;width:calc(100% + 13px);height:calc(100% + 13px)}.triple-border--large-margin .triple-border__container{border-radius:10px 0}.triple-border__logo{padding:.2rem;font-size:1.111rem;font-weight:600}.triple-border__return-tasks{font-size:.9rem;padding:1rem .2rem}</style><style data-href="/app.f588656cc80a065e5f1e.css">code[class*=language-],pre[class*=language-]{color:#fff;background:none;text-shadow:0 -.1em .2em #000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#4d4033}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:.3em solid #7a6652;border-radius:.5em;box-shadow:inset 1px 1px .5em #000}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998066}.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#d1949e}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#bde052}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f5b83d}.token.atrule,.token.attr-value,.token.keyword{color:#d1949e}.token.important,.token.regex{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}</style><style data-href="/component---src-templates-content-template-js.14b7932af346543b0873.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);.course{position:relative}.course h1,.course h2,.course h3,.course h4,.course p{margin-left:3rem;padding-bottom:2rem}.course pre{margin:2rem 0;background-color:#33332d;color:#fff}.course em{font-family:Courier;font-style:normal;background-color:#e1e1e1;padding:.1rem}.course img{border:11px solid transparent}.course .banner,.course .container{position:static}.course .letter{width:4rem;height:4rem;border-width:5px;border-style:solid;border-radius:2.5rem;text-align:center;margin:1rem;line-height:.8em}@media (min-width:640px){.course .letter{-webkit-transform:translate(-3rem,5rem);transform:translate(-3rem,5rem)}}.course .letter,.course h1{font-size:3.444rem;font-weight:700}.course-content a{border:0;border-bottom-width:2px;border-style:solid;padding:2px}.gatsby-highlight-code-line{background-color:hsla(0,0%,88.2%,.3);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em}.body-text:not(:last-of-type){margin-bottom:2.775rem}.body-text__title{color:#33332d;font-size:1.44rem;line-height:1.25em;font-weight:700;margin:0;position:relative;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.body-text__content:not(:last-of-type){padding-bottom:2em}.bold{font-weight:700}.body-text--no-padding{padding:0!important}.scroll-navigation{padding-right:1rem}.course li{list-style-type:none}.level-h1{font-weight:700;padding-left:2.8rem;text-indent:-2.8rem}.level-h2{padding-left:1.6rem;text-indent:-1.6rem}.level-h1:hover,.level-h2:hover{cursor:pointer;background-color:#000;color:#fff}.level-h1:before,.level-h2:before{content:"-";margin-right:1rem}.accordion__container{margin-bottom:1rem}.accordion__title{padding-left:2.149rem!important;padding-right:2.149rem!important;font-size:1.111rem!important;font-weight:600}.accordion{background-color:#fff;border:3px solid #33332d;border-radius:5px;color:#444;cursor:pointer;padding:1rem;width:100%;text-align:left;outline:none;font-size:15px;transition:max-width .4s}.accordion:hover,.active{background-color:#ccc}.accordion:after{content:"\2795";font-size:1rem;color:#33332d;float:right;margin-left:5px}.active{border-color:#fff}.active:after{content:"\2796"}.panel{background-color:#fff;transition:height .3s;transition-timing-function:ease-in-out;overflow:hidden}.accordion--side-navigation .accordion{border:none;padding:0}.accordion--side-navigation .accordion:hover,.accordion--side-navigation .active{background-color:#33332d;color:#fff}.accordion--side-navigation .accordion:after,.accordion--side-navigation .active:after{content:""}.sub-header{color:#33332d;font-family:IBM Plex Mono,monospace;padding-bottom:1.357rem}@media (min-width:992px){.sub-header{padding-bottom:2.333rem}}</style><meta name="generator" content="Gatsby 2.0.53"/><title data-react-helmet="true"></title><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/app-683ebd50c29e203eb678.js"/><link as="script" rel="preload" href="/component---src-templates-content-template-js-b5141e8f6c7da82f06b2.js"/><link as="script" rel="preload" href="/4-6173a9fdc003dfef6b3d.js"/><link as="script" rel="preload" href="/14-58d81fad4e9808f19056.js"/><link as="script" rel="preload" href="/2-78e57f9413ee9edc6799.js"/><link as="script" rel="preload" href="/webpack-runtime-f62914cca2ec440c7bae.js"/><link rel="preload" href="/static/d/173/path---osa-2-react-bb-8-7c8-oe9t7piJUnw4ntyTcYNeXOtrGYI.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div class="container" style="align-items:center"><a style="text-decoration:none" href="/"><div class="triple-border nav-item-hover " style="padding:0.2em"><div class="triple-border__container triple-border__logo" style="background-color:transparent">{() =&gt; fs}</div></div></a><div class="col-6 push-left-2" style="display:flex;justify-content:space-between;font-weight:bold"><a class="nav-item-hover" href="/about">KURSSISTA</a><a class="nav-item-hover" href="/#course-contents">KURSSIN SISÄLTÖ</a><a class="nav-item-hover" href="/faq">FAQs</a><a class="nav-item-hover" href="/companies">YRITYSESITTELYT</a></div></div><div class="spacing--small spacing--after"><div class="course-container"><div class="banner spacing--after" style="background-image:url(/static/part-2-2c709798e38da8a809241016507d8154.svg);background-position:center center;background-size:80%;background-repeat:no-repeat;background-color:#EB8755"><div class="container"><div class="col-10 spacing spacing--after"><div class="arrow__container arrows--horizontal"><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:#EB8755;color:black"><a href="/about">FULLSTACK</a></div><div class="arrow__point " style="background-color:#EB8755;color:black"></div></div><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:#EB8755;color:black"><a href="/osa2">OSA 2</a></div><div class="arrow__point " style="background-color:#EB8755;color:black"></div></div><div class="arrow__wrapper "><div class="arrow__rectangle  " style="background-color:black;color:white">REACT</div><div class="arrow__point " style="background-color:black;color:white"></div></div></div></div></div></div><div class="course"><div class="container"><div class="col-7 course-content push-right-3"><p class="col-1 letter" style="border-color:#EB8755">b</p><h1 class="sub-header ">React</h1></div></div><div class="container"><div class="scroll-navigation col-3 element--flex element--column"><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Web-sovellusten toiminnan perusteet</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b React</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Javascript</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div></div><div class="course-content col-7">
<h2>Taulukkojen käyttö Javascriptissä</h2>
<p>Tästä osasta lähtien käytämme runsaasti Javascriptin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">taulukkojen</a> funktionaalisia käsittelymetodeja, kuten <em>find</em>, <em>filter</em> ja <em>map</em>. Periaate niissä on täysin sama kuin Java 8:sta tutuissa streameissa, joita on käytetty jo runsaan vuoden ajan laitoksen Ohjelmoinnin perusteissa ja jatkokurssilla.</p>
<p>Jos taulukon funktionaalinen käsittely tuntuu vielä vieraalta, kannattaa katsoa Youtubessa olevasta videosarjasta <em>Functional Programming in JavaScript</em> ainakin kolme ensimmäistä osaa</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=BMUiFMZr7vk&amp;list=PL0zVEGEvSaeEd9hlmCXrk5yUyqUag-n84">Higher-order functions</a></li>
<li><a href="https://www.youtube.com/watch?v=bCqtb-Z5YGQ&amp;list=PL0zVEGEvSaeEd9hlmCXrk5yUyqUag-n84&amp;index=2">Map</a></li>
<li><a href="https://www.youtube.com/watch?v=Wl98eZpkp-c&amp;t=31s">Reduce basics</a></li>
</ul>
<h2>Kokoelmien renderöiminen</h2>
<p>Tehdään nyt Reactilla <a href="/osa1">ensimmäisen osan</a> alussa käytettyä esimerkkisovelluksen <a href="https://fullstack-exampleapp.herokuapp.com/spa">Single page app -versiota</a> vastaavan sovelluksen &#x27;frontend&#x27; eli selainpuolen sovelluslogiikka.</p>
<p>Aloitetaan seuraavasta:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;

const notes = [
  {
    id: 1,
    content: &#x27;HTML on helppoa&#x27;,
    date: &#x27;2017-12-10T17:30:31.098Z&#x27;,
    important: true
  },
  {
    id: 2,
    content: &#x27;Selain pystyy suorittamaan vain javascriptiä&#x27;,
    date: &#x27;2017-12-10T18:39:34.091Z&#x27;,
    important: false
  },
  {
    id: 3,
    content: &#x27;HTTP-protokollan tärkeimmät metodit ovat GET ja POST&#x27;,
    date: &#x27;2017-12-10T19:20:14.298Z&#x27;,
    important: true
  }
]

const App = (props) =&gt; {
  const { notes } = props;

  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        &lt;li&gt;{notes[0].content}&lt;/li&gt;
        &lt;li&gt;{notes[1].content}&lt;/li&gt;
        &lt;li&gt;{notes[2].content}&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}

ReactDOM.render(
  &lt;App notes={notes} /&gt;,
  document.getElementById(&#x27;root&#x27;)
)</code></pre></div>
<p>Jokaiseen muistiinpanoon on merkitty tekstuaalisen sisällön ja aikaleiman lisäksi myös <em>boolean</em>-arvo, joka kertoo onko muistiinpano luokiteltu tärkeäksi, sekä yksikäsitteinen tunniste <em>id</em>.</p>
<p>Koodin toiminta perustuu siihen, että taulukossa on tasan kolme muistiinpanoa, yksittäiset muistiinpanot renderöidään &#x27;kovakoodatusti&#x27; viittaamalla suoraan taulukossa oleviin olioihin:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{note[1].content}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Tämä ei tietenkään ole järkevää. Ratkaisu voidaan yleistää generoimalla taulukon perusteella joukko React-elementtejä käyttäen <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a>-funktiota:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">notes.map<span class="token punctuation">(</span>note <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span>note.content<span class="token punctuation">}</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span><span class="token punctuation">)</span></code></pre></div>
<p>nyt tuloksena on taulukko, jonka sisältö on joukko <em>li</em>-elementtejä</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">[</span>
  <span class="token string">&#x27;&lt;li&gt;HTML on helppoa&lt;/li&gt;&#x27;</span><span class="token punctuation">,</span>
  <span class="token string">&#x27;&lt;li&gt;Selain pystyy suorittamaan vain javascriptiä&lt;/li&gt;&#x27;</span><span class="token punctuation">,</span>
  <span class="token string">&#x27;&lt;li&gt;HTTP-protokollan tärkeimmät metodit ovat GET ja POST&lt;/li&gt;&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>jotka voidaan sijoittaa <em>ul</em>-tagien sisälle:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const App = (props) =&gt; {
  const { notes } = props;

  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {notes.map(note =&gt; &lt;li&gt;{note.content}&lt;/li&gt;)}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Koska li-tagit generoiva koodi on Javascriptia, tulee se sijoittaa JSX-templatessa aaltosulkujen sisälle kaiken muun Javascript-koodin tapaan.</p>
<p>Usein vastaavissa tilanteissa dynaamisesti generoitava sisältö eristetään omaan metodiin, jota JSX-template kutsuu:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const App = (props) =&gt; {
  const { notes } = props;
  const rivit = () =&gt; notes.map(note =&gt; &lt;li&gt;{note.content}&lt;/li&gt;)

  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {rivit()}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Vaikka sovellus näyttää toimivan, tulee konsoliin ikävä varoitus</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/3f32af5a03d1fea93cfc8faa68fbcee5/14be6/1.png"/></picture>
<p>Kuten virheilmoituksen linkittämä <a href="https://reactjs.org/docs/lists-and-keys.html#keys">sivu</a> kertoo, tulee taulukossa olevilla, eli käytännössä <em>map</em>-metodilla muodostetuilla elementeillä olla uniikki avain, eli kenttä nimeltään <em>key</em>.</p>
<p>Lisätään avaimet:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const App = (props) =&gt; {
  const { notes } = props;
  const rivit = () =&gt; notes.map(note =&gt; &lt;li key={note.id}&gt;{note.content}&lt;/li&gt;)

  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {rivit()}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Virheilmoitus katoaa.</p>
<p>React käyttää taulukossa olevien elementtien key-kenttiä päätellessään miten sen tulee päivittää komponentin generoimaa näkymää silloin kun komponentti uudelleenrenderöidään. Lisää aiheesta <a href="https://reactjs.org/docs/reconciliation.html#recursing-on-children">täällä</a>.</p>
<h3>Map</h3>
<p>Taulukoiden metodin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a> toiminnan sisäistäminen on jatkon kannalta äärimmäisen tärkeää.</p>
<p>Sovellus siis sisältää taulukon <em>notes</em></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;HTML on helppoa&#x27;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&#x27;2017-12-10T17:30:31.098Z&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Selain pystyy suorittamaan vain javascriptiä&#x27;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&#x27;2017-12-10T18:39:34.091Z&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;HTTP-protokollan tärkeimmät metodit ovat GET ja POST&#x27;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&#x27;2017-12-10T19:20:14.298Z&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>Pysähdytään hetkeksi tarkastelemaan miten <em>map</em> toimii.</p>
<p>Jos esim. tiedoston loppuun lisätään seuraava koodi</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>tulostuu konsoliin <em>[1, 2, 3]</em> eli <em>map</em> muodostaa uuden taulukon, jonka jokainen alkio on saatu alkuperäisen taulukon <em>notes</em> alkioista <em>mappaamalla</em> komennon parametrina olevan funktion avulla.</p>
<p>Funktio on</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>id<span class="token punctuation">;</span></code></pre></div>
<p>eli kompaktissa muodossa kirjoitettu nuolifunktio, joka on täydelliseltä kirjoitustavaltaan seuraava</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> note<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>eli funktio saa parametrikseen muistiinpano-olion ja <em>palauttaa</em> sen kentän <em>id</em> arvon.</p>
<p>Muuttamalla komento muotoon</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>tuloksena on taulukko, joka koostuu muistiinpanojen sisällöistä.</p>
<p>Tämä on jo lähellä käyttämäämme React-koodia:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">notes.map<span class="token punctuation">(</span>note <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>note.id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>note.content<span class="token punctuation">}</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span><span class="token punctuation">)</span></code></pre></div>
<p>joka muodostaa jokaista muistiinpano-olioa vastaavan <em>li</em>-tagin, jonka sisään tulee muistiinpanon sisältö.</p>
<p>Koska metodin <em>map</em> parametrina olevan funktion</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">note <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>note.id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>note.content<span class="token punctuation">}</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span></code></pre></div>
<p>käyttötarkoitus on näkymäelementtien muodostaminen, tulee muuttujan arvo renderöidä aaltosulkeiden sisällä. Kokeile mitä koodi tekee, jos poistat aaltosulkeet.</p>
<p>Aaltosulkeiden käyttö tulee varmaan aiheuttamaan alussa pientä päänvaivaa, mutta totut niihin pian. Reactin antama visuaalinen feedback on välitön.</p>
<p>Tarkastellaan vielä erästä bugien lähdettä. Lisää koodiin seuraava</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">const result <span class="token operator">=</span> notes.map<span class="token punctuation">(</span>note <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>note.content<span class="token punctuation">}</span> <span class="token punctuation">)</span>
console.log<span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre></div>
<p>Tulostuu</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token punctuation">[</span>undefined, undefined, undefined<span class="token punctuation">]</span></code></pre></div>
<p>Missä on vika? Koodihan on ihan sama kun äsken toiminut koodi. Paitsi ei ihan. Metodin <em>map</em> parametrina on nyt seuraava funktio</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">note <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  note<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Koska funktio koostuu nyt <em>koodilohkosta</em> on funktion paluuarvo määrittelemätön eli <em>undefined</em>. Nuolifunktiot siis palauttavat ainoan komentonsa arvon, ainoastaan jos nuolifunktio on määritelty kompaktissa muodossaan, ilman koodilohkoa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>content<span class="token punctuation">;</span></code></pre></div>
<p>huomaa, että &#x27;oneliner&#x27;-nuolifunktioissa kaikkea ei tarvitse eikä aina kannatakaan kirjoittaa samalle riville.</p>
<p>Parempi muotoilu ohjelmamme muistiinpanorivit tuottavalle apufunktiolle saattaakin olla seuraava useille riveille jaoteltu versio:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">const rivit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> notes.map<span class="token punctuation">(</span>note <span class="token operator">=</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>note.id<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>note.content<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Kyse on kuitenkin edelleen yhden komennon sisältävästä nuolifunktiosta, komento vain sattuu olemaan hieman monimutkaisempi.</p>
<h3>Antipattern: taulukon indeksit avaimina</h3>
<p>Olisimme saaneet konsolissa olevan varoituksen katoamaan myös käyttämällä avaimina taulukon indeksejä. Indeksit selviävät käyttämällä map-metodissa myös toista parametria:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>note<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span></code></pre></div>
<p>näin kutsuttaessa <em>i</em> saa arvokseen sen paikan indeksin taulukossa, missä <em>note</em> sijaitsee.</p>
<p>Eli virheetön tapa määritellä rivien generointi on</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">const rivit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> notes.map<span class="token punctuation">((</span>note, i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>note.content<span class="token punctuation">}</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span><span class="token punctuation">)</span></code></pre></div>
<p>Tämä <strong>ei kuitenkaan ole suositeltavaa</strong> ja voi näennäisestä toimimisestaan aiheuttaa joissakin tilanteissa pahoja ongelmia. Lue lisää esim. <a href="https://medium.com/@robinpokorny/index-as-a-key-is-an-anti-pattern-e0349aece318">täältä</a>.</p>
<h3>Refaktorointia - moduulit</h3>
<p>Siistitään koodia hiukan. Koska olemme kiinnostuneita ainoastaan propsien kentästä <em>notes</em>, otetaan se vastaan suoraan <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destrukturointia</a> hyödyntäen:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const App = ({ notes }) =&gt; {
  // ...

  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {rivit()}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Erotetaan yksittäisen muistiinpanon esittäminen oman komponenttinsa <em>Note</em> vastuulle:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Note = ({ note }) =&gt; {
  return (
    &lt;li&gt;{note.content}&lt;/li&gt;
  )
}

const App = ({ notes }) =&gt; {
  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {notes.map(note=&gt;&lt;Note key={note.id} note={note}/&gt;)}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Huomaa, että <em>key</em>-attribuutti täytyy nyt määritellä <em>Note</em>-komponenteille, eikä <em>li</em>-tageille kuten ennen muutosta.</p>
<p>Koko React-sovellus on mahdollista määritellä samassa tiedostossa, mutta se ei luonnollisesti ole järkevää. Usein käytäntönä on määritellä yksittäiset komponentit omassa tiedostossaan <em>ES6-moduuleina</em>.</p>
<p>Koodissamme on käytetty koko ajan moduuleja. Tiedoston ensimmäiset rivit</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#x27;react-dom&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">importtaavat</a> eli ottavat käyttöönsä kaksi moduulia. Moduuli <em>react</em> sijoitetaan muuttujaan <em>React</em> ja <em>react-dom</em> muuttujaan <em>ReactDOM</em>.</p>
<p>Siirretään nyt komponentti <em>Note</em> omaan moduuliinsa.</p>
<p>Pienissä sovelluksissa komponentit sijoitetaan yleensä <em>src</em>-hakemiston alle sijoitettavaan hakemistoon <em>components</em>. Konventiona on nimetä tiedosto komponentin mukaan, eli tehdään hakemisto <em>components</em> ja sinne tiedosto <em>Note.js</em> jonka sisältö on seuraava:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;

const Note = ({ note }) =&gt; {
  return (
    &lt;li&gt;{note.content}&lt;/li&gt;
  )
}

export default Note</code></pre></div>
<p>Koska kyseessä on React-komponentti, tulee React importata komponentissa.</p>
<p>Moduulin viimeisenä rivinä <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export">eksportataan</a> määritelty komponentti, eli muuttuja <em>Note</em>.</p>
<p>Nyt komponenttia käyttävä tiedosto <em>index.js</em> voi <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">importata</a> moduulin:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import Note from &#x27;./components/Note&#x27;</code></pre></div>
<p>Moduulin eksporttaama komponentti on nyt käytettävissä muuttujassa <em>Note</em> täysin samalla tavalla kuin aiemmin.</p>
<p>Huomaa, että itse määriteltyä komponenttia importatessa komponentin sijainti tulee ilmaista <em>suhteessa importtaavaan tiedostoon</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">&#x27;./components/Note&#x27;</code></pre></div>
<p>Piste alussa viittaa nykyiseen hakemistoon, eli kyseessä on nykyisen hakemiston alihakemisto <em>components</em> ja sen sisällä tiedosto <em>Note.js</em>. Tiedoston päätteen voi jättää pois.</p>
<p>Koska myös <em>App</em> on komponentti, eristetään sekin omaan moduuliinsa. Koska kyseessä on sovelluksen juurikomponentti, sijoitetaan se suoraan hakemistoon <em>src</em>. Tiedoston sisältö on seuraava:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import Note from &#x27;./components/Note&#x27;

const App = ({ notes }) =&gt; {
  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {notes.map(note =&gt; &lt;Note key={note.id} note={note} /&gt;)}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}

export default App</code></pre></div>
<p>Tiedoston <em>index.js</em> sisällöksi jää:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import App from &#x27;./App&#x27;

const notes = [
  ...
]

ReactDOM.render(
  &lt;App notes={notes} /&gt;,
  document.getElementById(&#x27;root&#x27;)
)</code></pre></div>
<p>Moduuleilla on paljon muutakin käyttöä kuin mahdollistaa komponenttien määritteleminen omissa tiedostoissaan, palaamme moduuleihin tarkemmin myöhemmin kurssilla.</p>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-1">githubissa</a></p>
<p>Huomaa, että repositorion master-haarassa on myöhemmän vaiheen koodi, tämän hetken koodi on tagissa <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-1">part2-1</a>:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/923772eecec018fc9fa017a858fd8e35/14be6/1b.png"/></picture>
<p>Jos kloonaat projektin itsellesi, suorita komento <em>npm install</em> ennen käynnistämistä eli komentoa <em>npm start</em>.</p>
<h3>Tehtäviä kokoelmien renderöinnistä</h3>
</div></div>
<div class="banner spacing spacing--after" style="background-color:#EB8755"><div class="container"><div class="course-content col-7 push-right-3" style="border-color:#EB8755">
<h3>Tehtävät 2.1</h3>
<h4>kurssien sisältö</h4>
<p>Viimeistellään nyt tehtävien 1.1-1.5 kurssin sisältöjä renderöivän ohjelman koodi. Voit ottaa tarvittaessa pohjaksi mallivastauksen koodin.</p>
<p>Muutetaan komponentti <em>App</em> seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const App = () =&gt; {
  const kurssi = {
    nimi: &#x27;Half Stack -sovelluskehitys&#x27;,
    osat: [
      {
        nimi: &#x27;Reactin perusteet&#x27;,
        tehtavia: 10,
        id: 1
      },
      {
        nimi: &#x27;Tiedonvälitys propseilla&#x27;,
        tehtavia: 7,
        id: 2
      },
      {
        nimi: &#x27;Komponenttien tila&#x27;,
        tehtavia: 14,
        id: 3
      }
    ]
  }

  return (
    &lt;div&gt;
      &lt;Kurssi kurssi={kurssi} /&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Määrittele sovellukseen yksittäisen kurssin muotoilusta huolehtiva komponentti <em>Kurssi</em>.</p>
<p>Sovelluksen komponenttirakenne voi olla esim. seuraava:</p>
<pre>

App
  Kurssi
    Otsikko
    Sisalto
      Osa
      Osa
      ...
</pre>
<p>ja renderöityvä sivu voi näyttää esim. seuraavalta:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/649b77631e24c268ac9aa2c363a1c666/14be6/8.png"/></picture>
<p>Tässä vaiheessa siis tehtävien yhteenlaskettua lukumäärää ei vielä tarvita.</p>
<p>Sovelluksen täytyy luonnollisesti toimia <em>riippumatta kurssissa olevien osien määrästä</em>, eli varmista että sovellus toimii jos lisäät tai poistat kurssin osia.</p>
<p>Varmista, että konsolissa ei näy mitään virheilmoituksia!</p>
<h3>Tehtävät 2.2</h3>
<h4>tehtävien määrä</h4>
<p>Ilmoita myös kurssin yhteenlaskettu tehtävien lukumäärä:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/2bcadc83ab65d725be7cb32629210702/14be6/9.png"/></picture>
<h3>Tehtävät 2.3*</h3>
<h4>reduce</h4>
<p>Jos et jo niin tehnyt, laske koodissasi tehtävien määrä taulukon metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a>.</p>
<h3>Tehtävät 2.4</h3>
<h4>monta kurssia</h4>
<p>Laajennetaan sovellusta siten, että kursseja voi olla <em>mielivaltainen määrä</em>:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const App = () =&gt; {
  const kurssit = [
    {
      nimi: &#x27;Half Stack -sovelluskehitys&#x27;,
      id: 1,
      osat: [
        {
          nimi: &#x27;Reactin perusteet&#x27;,
          tehtavia: 10,
          id: 1
        },
        {
          nimi: &#x27;Tiedonvälitys propseilla&#x27;,
          tehtavia: 7,
          id: 2
        },
        {
          nimi: &#x27;Komponenttien tila&#x27;,
          tehtavia: 14,
          id: 3
        }
      ]
    },
    {
      nimi: &#x27;Node.js&#x27;,
      id: 2,
      osat: [
        {
          nimi: &#x27;Routing&#x27;,
          tehtavia: 3,
          id: 1
        },
        {
          nimi: &#x27;Middlewaret&#x27;,
          tehtavia: 7,
          id: 2
        }
      ]
    }
  ]

  return (
    &lt;div&gt;
      // ...
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Sovelluksen ulkoasu voi olla esim seuraava:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/5594d574622b8b8c7373f2cbc4af74a0/14be6/10.png"/></picture>
<h3>Tehtävät 2.5</h3>
<h4>erillinen moduuli</h4>
<p>Määrittele komponentti <em>Kurssi</em> omana moduulinaan, jonka komponentti <em>App</em> importtaa. Voit sisällyttää kaikki kurssin alikomponentit samaan moduuliin.</p>
</div></div></div>
<div class="container"><div class="scroll-navigation col-3 element--flex element--column"><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Web-sovellusten toiminnan perusteet</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b React</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Javascript</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div></div><div class="course-content col-7">
<h2>Lomakkeet</h2>
<p>Jatketaan sovelluksen laajentamista siten, että se mahdollistaa uusien muistiinpanojen lisäämisen.</p>
<p>Jotta saisimme sivun päivittymään uusien muistiinpanojen lisäyksen yhteydessä, on parasta sijoittaa muistiinpanot komponentin <em>App</em> tilaan. Funktionaalisilla komponenteilla ei ole tilaa, joten muutetaan <em>App</em> luokkaan perustuvaksi komponentiksi:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      notes: props.notes
    }
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
        &lt;ul&gt;
          {this.state.notes.map(note =&gt; &lt;Note key={note.id} note={note} /&gt;)}
        &lt;/ul&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Konstruktori asettaa nyt propseina saatavan <em>notes</em>-taulukon tilaan avaimen <em>notes</em> arvoksi:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    notes<span class="token punctuation">:</span> props<span class="token punctuation">.</span>notes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>tila siis näyttää komponentin alustuksen jälkeen seuraavalta:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      content<span class="token punctuation">:</span> <span class="token string">&#x27;HTML on helppoa&#x27;</span><span class="token punctuation">,</span>
      date<span class="token punctuation">:</span> <span class="token string">&#x27;2017-12-10T17:30:31.098Z&#x27;</span><span class="token punctuation">,</span>
      important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<blockquote>
<p><strong>HUOM</strong> komponenttien tilan alustaminen propseina välitettyjen arvojen perusteella ei välttämättä ole hyvä tapa, se on monien mukaan jopa <a href="https://vasanthk.gitbooks.io/react-bits/anti-patterns/01.props-in-initial-state.html">antipattern</a>. Jos kuitenkin tutkitaan vähän pintaa syvemmälle, kyseessä on ongelma lähinnä silloin <a href="https://medium.com/@justintulk/react-anti-patterns-props-in-initial-state-28687846cc2e">jos propsien arvo voi muuttua</a>. Näin ei ohjelmassamme ole, eli tilan alustaminen propsien perusteella on hyväksyttävää.</p>
</blockquote>
<p>Lisätään sitten lomake uuden muistiinpanon lisäämistä varten:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      notes: props.notes
    }
  }

  addNote = (event) =&gt; {
    event.preventDefault()
    console.log(&#x27;nappia painettu&#x27;)
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
        &lt;ul&gt;
          {this.state.notes.map(note =&gt; &lt;Note key={note.id} note={note} /&gt;)}
        &lt;/ul&gt;
        &lt;form onSubmit={this.addNote}&gt;
          &lt;input/&gt;
          &lt;button type=&quot;submit&quot;&gt;tallenna&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Lomakkeelle on lisätty myös tapahtumankäsittelijäksi metodi <em>addNote</em> reagoimaan sen &quot;lähettämiseen&quot;, eli napin painamiseen.</p>
<p>Tapahtumankäsittelijä on <a href="/osa1#tapahtumank%C3%A4sittely">osasta 1</a> tuttuun tapaan määritelty seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">addNote</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;nappia painettu&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Parametrin <em>event</em> arvona on metodin kutsun aiheuttama <a href="https://reactjs.org/docs/handling-events.html">tapahtuma</a>.</p>
<p>Tapahtumankäsittelijä kutsuu heti tapahtuman metodia <code>event.preventDefault()</code> jolla se estää lomakkeen lähetyksen oletusarvoisen toiminnan, joka aiheuttaisi mm. sivun uudelleenlatautumisen.</p>
<p>Tapahtuman kohde, eli <em>event.target</em> on tulostettu konsoliin</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/402afeb2ecdcbfb536289f933caa11aa/14be6/2.png"/></picture>
<p>Kohteena on siis komponentin määrittelemä lomake.</p>
<p>Miten pääsemme käsiksi lomakkeen <em>input</em>-komponenttiin syötettyyn dataan?</p>
<p>Tapoja on useampia, tutustumme ensin ns. <a href="https://reactjs.org/docs/forms.html#controlled-components">kontrolloituina komponentteina</a> toteutettuihin lomakkeisiin.</p>
<p>Lisätään komponentin <em>App</em> tilaan kenttä <em>newNote</em> lomakkeen syötettä varten:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      notes<span class="token punctuation">:</span> props<span class="token punctuation">.</span>notes<span class="token punctuation">,</span>
      newNote<span class="token punctuation">:</span> <span class="token string">&#x27;uusi muistiinpano...&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Määritellään tilaan lisätty kenttä <em>input</em>-komponentin attribuutin <em>value</em> arvoksi:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{this.addNote}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{this.state.newNote}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>tallenna<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Tilaan määritelty &quot;placeholder&quot;-teksti <em>uusi muistiinpano...</em> ilmestyy syötekomponenttiin, tekstiä ei kuitenkaan voi muuttaa. Konsoliin tuleekin ikävä varoitus joka kertoo mistä on kyse</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/9c8e6d08ec7b853179f16d7a8ff4604e/14be6/4.png"/></picture>
<p>Koska määrittelimme syötekomponentille <em>value</em>-attribuutiksi komponentin <em>App</em> tilassa olevan kentän, alkaa <em>App</em> <a href="https://reactjs.org/docs/forms.html#controlled-components">kontrolloimaan</a> syötekomponentin toimintaa.</p>
<p>Jotta kontrolloidun syötekomponentin editoiminen olisi mahdollista, täytyy sille rekisteröidä <em>tapahtumankäsittelijä</em>, joka synkronoi syötekenttään tehdyt muutokset komponentin <em>App</em> tilaan:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  // ...

  handleNoteChange = (event) =&gt; {
    console.log(event.target.value)
    this.setState({ newNote: event.target.value })
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
        &lt;ul&gt;
          {this.state.notes.map(note =&gt; &lt;Note key={note.id} note={note} /&gt;)}
        &lt;/ul&gt;
        &lt;form onSubmit={this.addNote}&gt;
          &lt;input
            value={this.state.newNote}
            onChange={this.handleNoteChange}
          /&gt;
          &lt;button type=&quot;submit&quot;&gt;tallenna&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Lomakkeen <em>input</em>-komponentille on nyt rekisteröity tapahtumankäsittelijä tilanteeseen <em>onChange</em>:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{this.state.newNote}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onChange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{this.handleNoteChange}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></code></pre></div>
<p>Tapahtumankäsittelijää kutsutaan <em>aina kun syötekomponentissa tapahtuu jotain</em>. Tapahtumankäsittelijämetodi saa parametriksi tapahtumaolion <em>event</em></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">handleNoteChange</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> newNote<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Tapahtumaolion kenttä <em>target</em> vastaa nyt kontrolloitua <em>input</em>-kenttää ja <em>event.target.value</em> viittaa inputin syötekentän arvoon.</p>
<p>Huomaa, että toisin kuin tapahtuman <em>onSubmit</em> käsittelijässä, nyt oletusarvoisen toiminnan estävää metodikutusua <em>event.preventDefault()</em> ei tarvita sillä syötekentän muutoksella ei ole oletusarvoista toimintaa toisin kuin lomakkeen lähettämisellä.</p>
<p>Voit seurata konsolista miten tapahtumankäsittelijää kutsutaan:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/b5f424c1a27a758a88c8bba86dc78aaf/14be6/5.png"/></picture>
<p>Muistithan jo asentaa <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React devtoolsin</a>? Devtoolsista näet, miten tila muuttuu syötekenttään kirjoitettaessa:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/de515c2b2e73fed381f6b4182773ac99/14be6/5a.png"/></picture>
<p>Nyt komponentin <em>App</em> tilan kenttä <em>newNote</em> heijastaa koko ajan syötekentän arvoa, joten voimme viimeistellä uuden muistiinpanon lisäämisestä huolehtivan metodin <em>addNote</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">addNote</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> noteObject <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>newNote<span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>noteObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    notes<span class="token punctuation">:</span> notes<span class="token punctuation">,</span>
    newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Ensin luodaan uutta muistiinpanoa vastaava olio <em>noteObject</em>, jonka sisältökentän arvo saadaan komponentin tilasta <em>this.state.newNote</em>. Yksikäsitteinen tunnus eli <em>id</em> generoidaan kaikkien muistiinpanojen lukumäärän perusteella. Koska muistiinpanoja ei poisteta, menetelmä toimii sovelluksessamme. Komennon <code>Math.random()</code> avulla muistiinpanosta tulee 50% todennäköisyydellä tärkeä.</p>
<p>Uusi muistiinpano lisätään vanhojen joukkoon oikeaoppisesti käyttämällä <a href="/osa1#taulukon-k%C3%A4sittely%C3%A4">osasta 1</a> tuttua taulukon metodia <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">concat</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>noteObject<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Metodi ei muuta alkuperäistä taulukkoa <em>this.state.notes</em> vaan luo uuden taulukon, joka sisältää myös lisättävän alkion. Tämä on tärkeää, sillä Reactin tilaa <a href="https://reactjs.org/docs/state-and-lifecycle.html#using-state-correctly">ei saa muuttaa suoraan</a>!</p>
<p>Lopussa komponentin tila päivitetään uusilla muistiinpanoilla ja tyhjentämällä syötekomponentin arvoa kontrolloiva kenttä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> notes<span class="token punctuation">,</span>
  newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3>Kehittyneempi tapa olioliteraalien kirjoittamiseen</h3>
<p>Voimme muuttaa tilan päivittämän koodin</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">:</span> notes<span class="token punctuation">,</span>
  newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>muotoon</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  notes<span class="token punctuation">,</span>
  newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tämä johtuu siitä, että ES6:n myötä (ks. kohta <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer">property definitions</a>) Javascriptiin on tullut uusi ominaisuus, joka mahdollistaa hieman tiiviimmän tavan muuttujien avulla tapahtuvaan olioiden määrittelyyn.</p>
<p>Tarkastellaan tilannetta, jossa meillä on muuttujissa arvoja</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&#x27;Leevi&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p>ja haluamme määritellä näiden perusteella olion, jolla on kentät <em>name</em> ja <em>age</em>.</p>
<p>Vanhassa Javascriptissä olio täytyi määritellä seuraavaan tyyliin</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> age<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>koska muuttujien ja luotavan olion kenttien nimi nyt on sama, riittää ES6:ssa kirjoittaa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>lopputulos molemmilla tavoilla luotuun olioon on täsmälleen sama.</p>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-2">githubissa</a>, tagissa <em>part2-2</em>.</p>
<h2>Näytettävien elementtien filtteröinti</h2>
<p>Tehdään sovellukseen toiminto, joka mahdollistaa ainoastaan tärkeiden muistiinpanojen näyttämisen.</p>
<p>Lisätään komponentin <em>App</em> tilaan tieto siitä näytetäänkö muistiinpanoista kaikki vai ainoastaan tärkeät:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      notes: props.notes ,
      newNote: &#x27;&#x27;,
      showAll: true
    }
  }
  // ...
}</code></pre></div>
<p>Muutetaan metodia <em>render</em> siten, että se tallettaa muuttujaan <em>notesToShow</em> näytettävien muistiinpanojen listan riippuen siitä tuleeko näyttää kaikki vai vain tärkeät:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">render() {
  const notesToShow =
    this.state.showAll ?
      this.state.notes :
      this.state.notes.filter(note =&gt; note.important === true)

  return (
    &lt;div&gt;
      &lt;h1&gt;Muistiinpanot&lt;/h1&gt;
      &lt;ul&gt;
        {notesToShow.map(note =&gt; &lt;Note key={note.id} note={note} /&gt;)}
      &lt;/ul&gt;
      &lt;form onSubmit={this.addNote}&gt;
        &lt;input
          value={this.state.newNote}
          onChange={this.handleNoteChange}
        /&gt;
        &lt;button type=&quot;submit&quot;&gt;tallenna&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Muuttujan <em>notesToShow</em> määrittely on melko kompakti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> notesToShow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>showAll
  <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes
  <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Käytössä on monissa muissakin kielissä oleva <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">ehdollinen</a> operaatio.</p>
<p>Operaatio toimii seuraavasti. Jos meillä on esim:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> tulos <span class="token operator">=</span> ehto <span class="token operator">?</span> val1 <span class="token punctuation">:</span> val2<span class="token punctuation">;</span></code></pre></div>
<p>muuttujan <em>tulos</em> arvoksi asetetaan <em>val1</em>:n arvo jos <em>ehto</em> on tosi. Jos <em>ehto</em> ei ole tosi, muuttujan <em>tulos</em> arvoksi tulee <em>val2</em>:n arvo.</p>
<p>Jos ehto <em>this.state.showAll</em> on epätosi, muuttuja <em>notesToShow</em> saa arvokseen vaan ne muistiinpanot, joiden <em>important</em>-kentän arvo on tosi. Filtteröinti tapahtuu taulukon metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>vertailu-operaatio on oikeastaan turha koska <em>note.important</em> on arvoltaan joko <em>true</em> tai <em>false</em>, eli riittää kirjoittaa</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>important<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tässä käytettiin kuitenkin ensin vertailuoperaattoria, mm. korostamaan erästä tärkeää seikkaa: Javascriptissa <code>arvo1 == arvo2</code> ei toimi kaikissa tilanteissa loogisesti ja onkin varmempi käyttää aina vertailuissa muotoa <code>arvo1 === arvo2</code>. Enemmän aiheesta <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Equality_comparisons_and_sameness">täällä</a>.</p>
<p>Filtteröinnin toimivuutta voi jo nyt kokeilla vaihtelemalla sitä, miten tilan kentän <em>showAll</em> alkuarvo määritelään konstruktorissa.</p>
<p>Lisätään sitten toiminnallisuus, mikä mahdollistaa <em>showAll</em>:in tilan muuttamisen sovelluksesta.</p>
<p>Oleelliset muutokset ovat seuraavassa:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  // ...

  toggleVisible = () =&gt; {
    this.setState({showAll: !this.state.showAll})
  }

  render() {
    const notesToShow =
      this.state.showAll ?
        this.state.notes :
        this.state.notes.filter(note =&gt; note.important === true)

    const label = this.state.showAll ? &#x27;vain tärkeät&#x27; : &#x27;kaikki&#x27;

    return (
      &lt;div&gt;
        &lt;h1&gt;Muistiinpanot&lt;/h1&gt;

        &lt;div&gt;
          &lt;button onClick={this.toggleVisible}&gt;
            näytä {label}
          &lt;/button&gt;
        &lt;/div&gt;

        &lt;ul&gt;
          {notesToShow.map(note =&gt; &lt;Note key={note.id} note={note} /&gt;)}
        &lt;/ul&gt;
        &lt;form onSubmit={this.addNote}&gt;
          &lt;input
            value={this.state.newNote}
            onChange={this.handleNoteChange}
          /&gt;
          &lt;button type=&quot;submit&quot;&gt;tallenna&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Näkyviä muistiinpanoja (kaikki vai ainoastaan tärkeät) siis kontrolloidaan napin avulla. Napin tapahtumankäsittelijä on yksinkertainen, se muuttaa <em>this.state.showAll</em>:n arvon truesta falseksi ja päinvastoin:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">toggleVisible</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showAll<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>showAll <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Napin teksti määritellään muuttujaan, jonka arvo määräytyy tilan perusteella:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> label <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>showAll <span class="token operator">?</span> <span class="token string">&#x27;vain tärkeät&#x27;</span> <span class="token punctuation">:</span> <span class="token string">&#x27;kaikki&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-3">githubissa</a>, tagissa <em>part2-3</em>.</p>
</div></div>
<div class="banner spacing spacing--after" style="background-color:#EB8755"><div class="container"><div class="course-content col-7 push-right-3" style="border-color:#EB8755">
<h3>Tehtävät 2.6</h3>
<h4>puhelinluettelo osa 1</h4>
<p>Toteutetaan yksinkertainen puhelinluettelo. <strong>Aluksi luetteloon lisätään vaan nimiä.</strong></p>
<p>Voit ottaa sovelluksesi pohjaksi seuraavan:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;;

class App extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      persons: [
        { name: &#x27;Arto Hellas&#x27; }
      ],
      newName: &#x27;&#x27;
    }
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h2&gt;Puhelinluettelo&lt;/h2&gt;
        &lt;form&gt;
          &lt;div&gt;
            nimi: &lt;input /&gt;
          &lt;/div&gt;
          &lt;div&gt;
            &lt;button type=&quot;submit&quot;&gt;lisää&lt;/button&gt;
          &lt;/div&gt;
        &lt;/form&gt;
        &lt;h2&gt;Numerot&lt;/h2&gt;
        ...
      &lt;/div&gt;
    )
  }
}

export default App</code></pre></div>
<p>Tilassa oleva kenttä <em>newName</em> on tarkoitettu lomakkeen kentän kontrollointiin.</p>
<p>Joskus tilan muuttujia ja tarvittaessa muitakin voi olla hyödyllistä renderöidä debugatessa komponenttiin, eli voi tilapäisesti lisätä komponentin metodin <em>render</em> palauttamaan koodiin esim. seuraavan:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>debug: {this.state.newName}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Muista myös osan 1 luku <a href="#react-sovellusten-debuggaus">React-sovellusten debuggaus</a>, erityisesti <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">react developer tools</a> on välillä todella kätevä komponentin tilan muutosten seuraamisessa.</p>
<p>Sovellus voi näyttää tässä vaiheessa seuraavalta:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/60446030ea8355a3fb52e43afb9b73b4/14be6/11.png"/></picture>
<p>Huomaa, React developer toolsin käyttö!</p>
<p><strong>Huom:</strong></p>
<ul>
<li>voit käyttää kentän <em>key</em> arvona henkilön nimeä</li>
<li>muista estää lomakkeen lähetyksen oletusarvoinen toiminta!</li>
</ul>
<h3>Tehtävät 2.7</h3>
<h4>puhelinluettelo osa 2</h4>
<p>Jos lisättävä nimi on jo sovelluksen tiedossa, estä lisäys. Taulukolla on lukuisia sopivia <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">metodeja</a> tehtävän tekemiseen.</p>
<p>Voit antaa halutessasi virheilmoituksen esim. komennolla <em>alert()</em>. Se ei kuitenkaan ole tarpeen.</p>
<h3>Tehtävät 2.8</h3>
<h4>puhlelinluettelo osa 3</h4>
<p>Lisää sovellukseen mahdollisuus antaa henkilöille puhelinnumero. Tarvitset siis lomakkeeseen myös toisen <em>input</em>-elementin (ja sille oman muutoksenkäsittelijän):</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>nimi: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>numero: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>lisää<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Sovellus voi näyttää tässä vaiheessa seuraavalta. Kuvassa myös <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">react developer tools</a>:in tarjoama näkymä komponentin <em>App</em> tilaan:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/dd6fe4b6d9f8013fd1244ecd77b3010d/14be6/12.png"/></picture>
<h3>Tehtävät 2.9*</h3>
<h4>puhelinluettelo osa 4</h4>
<p>Tee lomakkeeseen hakukenttä, jonka avulla näytettävien nimien listaa voidaan rajata:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/3257039afad6bed5eec6657bd4a3b484/14be6/12c.png"/></picture>
<p>Rajausehdon syöttämisen voi hoitaa omana lomakkeeseen kuulumattomana <em>input</em>-elementtinä. Kuvassa rajausehdosta on tehty <em>caseinsensitiivinen</em> eli ehto <em>arto</em> löytää isolla kirjaimella kirjoitetun Arton.</p>
<p><strong>Huom:</strong> Kun toteutat jotain uutta toiminnallisuutta, on usein hyötyä &#x27;kovakoodata&#x27; sovellukseen jotain sisältöä, esim.</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    persons<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&#x27;Arto Hellas&#x27;</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token string">&#x27;040-123456&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&#x27;Martti Tienari&#x27;</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token string">&#x27;040-123456&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&#x27;Arto Järvinen&#x27;</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token string">&#x27;040-123456&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&#x27;Lea Kutvonen&#x27;</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token string">&#x27;040-123456&#x27;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    newName<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
    newNumber<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
    filter<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Näin vältytään turhalta manuaaliselta työltä, missä testaaminen edellyttäisi myös testiaineiston syöttämistä käsin soveluksen lomakkeen kautta.</p>
<p>Kurssin seuraavasta osasta alkaen alamme määrittelemään sovelluksemme <em>testejä</em> jotka tietyissä tapauksissa hoitavat kovakoodatun apusyötteen roolia.</p>
<h3>Tehtävät 2.10</h3>
<h4>puhelinluettelo osa 5</h4>
<p>Jos koko sovelluksesi on tehty yhteen komponenttiin, refaktoroi sitä eriyttämällä sopivia komponentteja. Pidä kuitenkin edelleen kaikki tila juurikomponentissa.</p>
<p>Riittää että erotat sovelluksesta kaksi komponenttia. Hyviä kandidaatteja ovat esim. filtteröintilomake, yksittäisten henkilön tietojen esittäminen ja uuden henkilön lisäävä lomake.</p>
</div></div></div>
<div class="container"><div class="scroll-navigation col-3 element--flex element--column"><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Web-sovellusten toiminnan perusteet</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b React</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Javascript</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div></div><div class="course-content col-7">
<h2>Datan haku palvelimelta</h2>
<p>Olemme nyt viipyneet tovin keskittyen pelkkään &quot;frontendiin&quot;, eli selainpuolen toiminnallisuuteen. Rupeamme itse toteuttamaan &quot;backendin&quot;, eli palvelinpuolen toiminnallisuutta vasta kurssin kolmannessa osassa, mutta otamme nyt jo askeleen sinne suuntaan tutustumalla siihen miten selaimessa suoritettava koodi kommunikoi backendin kanssa.</p>
<p>Käytetään nyt palvelimena sovelluskehitykseen tarkoitettua <a href="https://github.com/typicode/json-server">JSON Serveriä</a>.</p>
<p>Tee projektin juurihakemistoon tiedosto <em>db.json</em>, jolla on seuraava sisältö:</p>
<div class="gatsby-highlight" data-language="json"><pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;notes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HTML on helppoa&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2017-12-10T17:30:31.098Z&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;important&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Selain pystyy suorittamaan vain javascriptiä&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2017-12-10T18:39:34.091Z&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;important&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HTTP-protokollan tärkeimmät metodit ovat GET ja POST&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2017-12-10T19:20:14.298Z&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;important&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>JSON server on mahdollista <a href="https://github.com/typicode/json-server#install">asentaa</a> koneelle ns. globaalisti komennolla <em>npm install -g json-server</em>. Globaali asennus edellyttää kuitenkin pääkäyttäjän oikeuksia, eli se ei ole mahdollista laitoksen koneilla tai uusilla fuksiläppäreillä.</p>
<p>Globaali asennus ei kuitenkaan ole tarpeen, voimme käynnistää <em>json-serverin</em> komennon <em>npx</em> avulla:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">npx json-server --port<span class="token operator">=</span>3001 --watch db.json</code></pre></div>
<p>Oletusarvoisesti <em>json-server</em> käynnistyy porttiin 3000, mutta create-react-app:illa luodut projektit varaavat portin 3000, joten joudumme nyt määrittelemään json-server:ille vaihtoehtoisen portin 3001.</p>
<p>Mennään selaimella osoitteeseen <a href="http://localhost:3001/notes">http://localhost:3001/notes</a>. Kuten huomaamme, <em>json-server</em> tarjoaa osoitteessa tiedostoon tallentamamme muistiinpanot JSON-muodossa:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/118d8a18ebbe17bd894c7be2f57b5bc2/14be6/6.png"/></picture>
<p>Ideana jatkossa onkin se, että muistiinpanot talletetaan palvelimelle, eli tässä vaiheessa <em>json-server</em>:ille. React-koodi lataa muistiinpanot palvelimelta ja renderöi ne ruudulle. Kun sovellukseen lisätään uusi muistiinpano, React-koodi lähettää sen myös palvelimelle, jotta uudet muistiinpanot jäävät pysyvästi &quot;muistiin&quot;.</p>
<p>json-server tallettaa kaiken datan palvelimella sijaitsevaan tiedostoon <em>db.json</em>. Todellisuudessa data tullaan tallentamaan johonkin tietokantaan. json-server on kuitenkin käyttökelpoinen apuväline, joka mahdollistaa palvelinpuolen toiminnallisuuden käyttämisen kehitysvaiheessa ilman tarvetta itse ohjelmoida mitään.</p>
<p>Tutustumme palvelinpuolen toteuttamisen periaatteisiin tarkemmin kurssin <a href="/osa3">osassa 3</a>.</p>
<h3>Selain suoritusympäristönä</h3>
<p>Ensimmäisenä tehtävänämme on siis hakea React-sovellukseen jo olemassaolevat mustiinpanot osoitteesta <a href="http://localhost:3001/notes">http://localhost:3001/notes</a>.</p>
<p>Osan 0 <a href="/osa0#selaimessa-suoritettava-sovelluslogiikka">esimerkkiprojektissa</a> nähtiin jo eräs tapa hakea Javascript-koodista palvelimella olevaa dataa. Esimerkin koodissa data haettiin <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>- eli XHR-olion avulla muodostetulla HTTP-pyynnöllä. Kyseessä on vuonna 1999 lanseerattu tekniikka, jota kaikki web-selaimet ovat jo pitkään tukeneet.</p>
<p>Nykyään XHR:ää ei kuitenkaan kannata käyttää ja selaimet tukevatkin jo laajasti <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch">fetch</a>-metodia, joka perustuu XHR:n käyttämän tapahtumapohjaisen mallin sijaan ns. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promiseihin</a>.</p>
<p>Muistutuksena edellisestä osasta (oikeastaan tätä tapaa pitää lähinnä <em>muistaa olla käyttämättä</em> ilman painavaa syytä), XHR:llä haettiin dataa seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> xhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhttp<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// käsittele muuttujaan data sijoitettu kyselyn tulos</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#x27;GET&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;/data.json&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Heti alussa HTTP-pyyntöä vastaavalle <em>xhttp</em>-oliolle rekisteröidään <em>tapahtumankäsittelijä</em>, jota Javascript runtime kutsuu kun <em>xhttp</em>-olion tila muuttuu. Jos tilanmuutos tarkoittaa että pyynnön vastaus on saapunut, käsitellään data halutulla tavalla.</p>
<p>Huomionarvoista on se, että tapahtumankäsittelijän koodi on määritelty jo ennen kun itse pyyntö lähetetään palvelimelle. Tapahtumankäsittelijäfunktio tullaan kuitenkin suorittamaan vasta jossain myöhäisemmässä vaiheessa. Koodin suoritus ei siis etene synkronisesti &quot;ylhäältä alas&quot;, vaan <em>asynkronisesti</em>, Javascript kutsuu sille rekisteröityä tapahtumankäsittelijäfunktiota jossain vaiheessa.</p>
<p>Esim. Java-ohjelmoinnista tuttu synkroninen tapa tehdä kyselyjä etenisi seuraavaan tapaan (huomaa että kyse ei ole oikeasti toimivasta Java-koodista):</p>
<div class="gatsby-highlight" data-language="java"><pre><code class="language-java">HTTPRequest request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTTPRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

String url <span class="token operator">=</span> <span class="token string">&quot;https://fullstack-exampleapp.herokuapp.com/data.json&quot;</span><span class="token punctuation">;</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>Muistiinpano<span class="token punctuation">&gt;</span></span> muistiinpanot <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

muistiinpanot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>m <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Javassa koodi etenee nyt rivi riviltä ja koodi pysähtyy odottamaan HTTP-pyynnön, eli komennon <em>request.get(...)</em> valmistumista. Komennon palauttama data, eli muistiinpanot talletetaan muuttujaan ja dataa aletaan käsittelemään halutulla tavalla.</p>
<p>Javascript-enginet eli suoritusympäristöt kuitenkin noudattavat <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop">asynkronista mallia</a>, eli periaatteena on se, että kaikki <a href="https://en.wikipedia.org/wiki/Input/output">IO-operaatiot</a> (poislukien muutama poikkeus) suoritetaan ei-blokkaavana, eli operaatioiden tulosta ei jäädä odottamaan vaan koodin suoritusta jatketaan heti eteenpäin.</p>
<p>Siinä vaiheessa kun operaatio valmistuu tai tarkemmin sanoen jonain valmistumisen jälkeisenä ajanhetkenä, kutsuu Javascript-engine operaatiolle rekisteröityjä tapahtumankäsittelijöitä.</p>
<p>Nykyisellään Javascript-moottorit ovat <em>yksisäikeisiä</em> eli ne eivät voi suorittaa rinnakkaista koodia. Tämän takia on käytännössä pakko käyttää ei-blokkaavaa mallia IO-operaatioiden suorittamiseen, sillä muuten selain &#x27;jäätyisi&#x27; siksi aikaa kun esim. palvelimelta haetaan dataa.</p>
<p>Javascript-moottoreiden yksisäikeisyydellä on myös sellainen seuraus, että jos koodin suoritus kestää erittäin pitkään, menee selain jumiin suorituksen ajaksi. Jos lisätään jonnekin kohtaa sovellustamme, esim. konstruktoriin seuraava koodi:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;loop..&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">50000000000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;end&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Kaikki toimii 5 sekunnin ajan normaalisti. Kun <em>setTimeout</em>:in parametrina määritelty funktio suoritetaan, menee selaimen sivu jumiin pitkän loopin suorituksen ajaksi. Ainakaan Chromessa selaimen tabia ei pysty edes sulkemaan luupin suorituksen aikana.</p>
<p>Eli jotta selain säilyy <em>responsiivisena</em>, eli että se reagoi koko ajan riittävän nopeasti käyttäjän haluamiin toimenpiteisiin, koodin logiikan tulee olla sellainen, että yksittäinen laskenta ei saa kestää liian kauaa.</p>
<p>Aiheesta löytyy paljon lisämateriaalia internetistä, eräs varsin havainnollinen esitys aiheesta Philip Robertsin esitelmä <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">What the heck is the event loop anyway?</a></p>
<p>Nykyään selaimissa on mahdollisuus suorittaa myös rinnakkaista koodia ns. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">web workerien</a> avulla. Yksittäisen selainikkunan koodin ns. event loopista huolehtii kuitenkin edelleen <a href="https://medium.com/techtrument/multithreading-javascript-46156179cf9a">vain yksi säie</a>.</p>
<h2>npm</h2>
<p>Palaamme jälleen asiaan, eli datan hakemiseen palvelimelta.</p>
<p>Voisimme käyttää datan palvelimelta hakemiseen aiemmin mainittua promiseihin perustuvaa funktiota <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch">fetch</a>. Fetch on hyvä työkalu, se on standardoitu ja kaikkien modernien selaimien (poislukien IE) tukema.</p>
<p>Käytetään selaimen ja palvelimen väliseen kommunikaatioon kuitenkin <a href="https://github.com/axios/axios">axios</a>-kirjastoa, joka toimii samaan tapaan kuin fetch, mutta on hieman mukavampikäyttöinen. Hyvä syy axios:in käytölle on myös se, että pääsemme tutustumaan siihen miten ulkopuolisia kirjastoja eli <em>npm-paketteja</em> liitetään React-projektiin.</p>
<p>Nykyään lähes kaikki Javascript-projektit määritellään node &quot;pakkausmanagerin&quot; eli <a href="https://docs.npmjs.com/getting-started/what-is-npm">npm</a>:n avulla. Myös create-react-app:in avulla generoidut projektit ovat npm-muotoisia projekteja. Varma tuntomerkki siitä on projektin juuressa oleva tiedosto <em>package.json</em>:</p>
<div class="gatsby-highlight" data-language="json"><pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;osa2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-dom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-scripts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.17&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts test --env=jsdom&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts eject&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Tässä vaiheessa meitä kiinnostaa osa <em>dependencies</em>, joka määrittelee mitä <em>riippuvuuksia</em> eli ulkoisia kirjastoja projektilla on.</p>
<p>Haluamme nyt käyttöömme axioksen. Voisimme määritellä kirjaston suoraan tiedostoon <em>package.json</em>, mutta on parempi asentaa se komentoriviltä</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> axios --save</code></pre></div>
<p><strong>Huomaa, että <em>npm</em>-komennot tulee antaa aina projektin juurihakemistossa</strong>, eli siinä minkä sisältä tiedosto <em>package.json</em> löytyy.</p>
<p>Nyt axios on mukana riippuvuuksien joukossa:</p>
<div class="gatsby-highlight" data-language="json"><pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.17.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-dom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-scripts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.17&quot;</span>
  <span class="token punctuation">}</span>
  /*...*/
<span class="token punctuation">}</span></code></pre></div>
<p>Sen lisäksi, että komento <em>npm install</em> lisäsi axiosin riippuvuuksien joukkoon, se myös <em>latasi</em> kirjaston koodin. Koodi löytyy muiden riippuvuuksien tapaan projektin juuren hakemistosta <em>node</em>modules_, mikä kuten huomata saattaa sisältääkin runsaasti kaikenlaista.</p>
<p>Tehdään toinenkin pieni lisäys. Asennetaan myös <em>json-server</em> projektin riippuvuudeksi komennolla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> json-server --save</code></pre></div>
<p>ja lisätään tiedoston <em>package.json</em> osaan <em>scripts</em> rivi</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token string">&quot;server&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;json-server -p3001 db.json&quot;</span></code></pre></div>
<p>eli muutetaan se muotoon</p>
<div class="gatsby-highlight" data-language="json"><pre><code class="language-json"><span class="token punctuation">{</span>
  /*...*/
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts test --env=jsdom&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts eject&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;json-server -p3001 db.json&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Nyt voimme käynnistää (muista sammuttaa aiemmin käynnistämäsi!) json-serverin projektin hakemistosta mukavasti ilman tarvetta parametrien määrittelylle komennolla</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash"><span class="token function">npm</span> run server</code></pre></div>
<p>Tutustumme npm:n tarkemmin kurssin <a href="/osa3">kolmannessa osassa</a>.</p>
<h3>Axios ja promiset</h3>
<p>Olemme nyt valmiina käyttämään axiosia. Jatkossa oletetaan että <em>json-server</em> on käynnissä portissa 3001.</p>
<p>Kirjaston voi ottaa käyttöön samaan tapaan kuin esim. React otetaan käyttöön, eli sopivalla <em>import</em>-lauseella.</p>
<p>Lisätään seuraava tiedostoon <em>index.js</em></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#x27;axios&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise2 <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/foobar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>promise2<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Konsoliin tulostuu seuraavaa</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/b1f90db7a9d23af450c57e7e5631f819/14be6/8.png"/></picture>
<p>Axiosin metodi <em>get</em> palauttaa <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">promisen</a>.</p>
<p>Mozillan dokumentaatio sanoo promisesta seuraavaa:</p>
<blockquote>
<p>A Promise is an object representing the eventual completion or failure of an asynchronous operation.</p>
</blockquote>
<p>Promise siis edustaa asynkronista operaatiota. Promise voi olla kolmessa eri tilassa:</p>
<ul>
<li>aluksi promise on <em>pending</em>, eli promisea vastaava asynkroninen operaatio ei ole vielä tapahtunut</li>
<li>jos operaatio päättyy onnistuneesti, menee promise tilaan <em>fulfilled</em>, josta joskus käytetään nimitystä <em>resolved</em></li>
<li>kolmas mahdollinen tila on <em>rejected</em>, joka edustaa epäonnistunutta operaatiota</li>
</ul>
<p>Esimerkkimme ensimmäinen promise on <em>fulfilled</em>, eli vastaa onnistunutta <em>axios.get(&#x27;<a href="http://localhost:3001/notes&#x27;">http://localhost:3001/notes&#x27;</a>)</em> pyyntöä. Promiseista toinen taas on <em>rejected</em>, syy selviää konsolista, eli yritettiin tehdä HTTP GET -pyyntöä osoitteeseen, jota ei ole olemassa.</p>
<p>Jos ja kun haluamme tietoon promisea vastaavan operaation tuloksen, tulee promiselle rekisteröidä tapahtumankuuntelija. Tämä tapahtuu metodilla <em>then</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Konsoliin tulostuu seuraavaa</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/4426ab24bfa41ec484b8d69ccb7f8328/14be6/9.png"/></picture>
<p>Javascriptin suoritusympäristö kutsuu <em>then</em>-metodin avulla rekisteröityä takaisinkutsufunktiota antaen sille parametriksi olion <em>result</em>, joka sisältää kaiken oleellisen HTTP GET -pyynnön vastaukseen liittyvän, eli palautetun <em>datan</em>, <em>statuskoodin</em> ja <em>headerit</em>.</p>
<p>Promise-olioa ei ole yleensä tarvetta tallettaa muuttujaan, ja onkin tapana ketjuttaa metodin <em>then</em> kutsu suoraan axiosin metodin kutsun perään:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notes <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Takaisinkutsufunktio ottaa nyt vastauksen sisällä olevan datan muuttujaan ja tulostaa muistiinpanot konsoliin.</p>
<p>Luettavampi tapa formatoida <em>ketjutettuja</em> metodikutsuja on sijoittaa jokainen kutsu omalle rivilleen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notes <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>näin jo nopea, ruudun vasempaan laitaan kohdistunut vilkaisu kertoo mistä on kyse.</p>
<p>Palvelimen palauttama data on pelkkää tekstiä, käytännössä yksi iso merkkijono. Asian voi todeta, esim. tekemällä HTTP-pyyntö komentoriviltä <a href="https://curl.haxx.se">curl</a>:illa</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/e094a975ba60f5ec62e789472e502275/14be6/10.png"/></picture>
<p>Axios-kirjasto osaa kuitenkin parsia datan Javascript-taulukoksi, sillä palvelin on kertonut headerin <em>content-type</em> avulla että datan muoto on <em>application/json; charset=utf-8</em> (ks ylempi kuva).</p>
<p>Voimme vihdoin siirtyä käyttämään sovelluksessamme palvelimelta haettavaa dataa.</p>
<p>Tehdään se aluksi &quot;huonosti&quot;, eli lisätään sovellusta vastaavan komponentin <em>App</em> renderöinti takaisinkutsufunktion sisälle muuttamalla <em>index.js</em> seuraavaan muotoon:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import ReactDOM from &#x27;react-dom&#x27;
import React from &#x27;react&#x27;
import App from &#x27;./App&#x27;

import axios from &#x27;axios&#x27;

axios.get(&#x27;http://localhost:3001/notes&#x27;).then(response =&gt; {
  const notes = response.data
  ReactDOM.render(
    &lt;App notes={notes} /&gt;,
    document.getElementById(&#x27;root&#x27;)
  )
})</code></pre></div>
<p>Joissain tilanteissa tämäkin tapa voisi olla ok, mutta se on hieman ongelmallinen ja päätetäänkin siirtää datan hakeminen komponenttiin <em>App</em>.</p>
<p>Ei ole kuitenkaan ihan selvää, mihin kohtaan komponentin koodia komento <em>axios.get</em> olisi hyvä sijoittaa.</p>
<h3>Komponenttien lifecycle-metodit</h3>
<p>Reactin luokkien avulla määritellyillä komponenteilla voidaan määritellä joukko <a href="https://reactjs.org/docs/state-and-lifecycle.html#adding-lifecycle-methods-to-a-class">lifecycle</a>-metodeita, eli metodeita, joita React kutsuu tietyssä komponentin &quot;elinkaaren&quot; vaiheessa.</p>
<p>Yleinen tapa datan palvelimelta tapahtuvaan hakemiseen on suorittaa se metodissa <a href="https://reactjs.org/docs/react-component.html#componentdidmount">componentDidMount</a>. React kutsuu metodia sen jälkeen kun konstruktori on suoritettu ja <em>render</em>-metodi on suoritettu ensimmäistä kertaa.</p>
<p>Muutetaan sovellusta nyt seuraavasti.</p>
<p>Poistetaan datan hakeminen tiedostosta <em>index.js</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Komponentille <em>App</em> ei ole enää tarvetta välittää dataa propseina.</p>
<p>Komponentti <em>App</em> muuttuu seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">import React from &#x27;react&#x27;
import axios from &#x27;axios&#x27;

class App extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      notes: [],
      newNote: &#x27;&#x27;,
      showAll: true
    }
    console.log(&#x27;constructor&#x27;)
  }

  componentDidMount() {
    console.log(&#x27;did mount&#x27;)
    axios
      .get(&#x27;http://localhost:3001/notes&#x27;)
      .then(response =&gt; {
        console.log(&#x27;promise fulfilled&#x27;)
        this.setState({ notes: response.data })
      })
  }

  render() {
    console.log(&#x27;render&#x27;)
    // ...
  }
}</code></pre></div>
<p>Eli konstruktorissa asetetaan tilan <em>notes</em> kentäksi tyhjä taulukko. Lifecycle-metodi <em>componentDidMount</em> hakee datan axiosin avulla ja rekisteröi takaisinkutsufunktion, joka promisen valmistumisen (<em>fulfillment</em>) yhteydessä päivittää komponentin tilan asettamalla palvelimen palauttamat muistiinpanot tilan kentän <em>notes</em> arvoksi.</p>
<p>Koodiin on myös lisätty muutama aputulostus, jotka auttavat hahmottamaan miten suoritus etenee.</p>
<p>Konsoliin tulostuu</p>
<pre>

constructor
render
did mount
promise fulfilled
render
</pre>
<p>Ensin siis suoritetaan konstruktori ja metodi <em>render</em>, ja sen jälkeen metodi <em>componentDidMount</em>. Tämän jälkeen kutsutaan kuitenkin vielä metodia <em>render</em>; miksi näin?</p>
<p>Metodissa <em>componentDidMount</em> suoritetaan axiosin avulla HTTP GET -pyyntö ja samalla <em>rekisteröidään</em> pyynnön palauttamalle promiselle tapahtumankäsittelijä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;promise fulfilled&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes<span class="token punctuation">:</span> response<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tapahtumankäsittelijän koodia, eli then:in parametrina olevaa <em>funktiota</em> ei siis suoriteta vielä tässä vaiheessa. Javascriptin runtime kutsuu sitä jossain vaiheessa sen jälkeen kun palvelin on vastannut HTTP GET -pyyntöön.</p>
<p>Kun kutsutaan metodia <em>render</em> ensimmäistä kertaa (heti konstruktorin jälkeen) komponentti <em>App</em> piirtyy ruudulle aluksi siten, että yhtään muistiinpanoa ei näytetä. Emme kuitenkaan ehdi huomaamaan asiaa, sillä palvelimen vastaus tulee pian, ja se taas saa aikaan tapahtumankäsittelijän suorituksen. Tapahtumankäsittelijä päivittää komponentin tilaa kutsumalla <em>setState</em> ja tämä saa aikaan komponentin uudelleenrenderöinnin.</p>
<p>Mieti tarkasti äsken läpikäytyä tapahtumasarjaa, sen ymmärtäminen on erittäin tärkeää!</p>
<p>Huomaa, että olisimme voineet kirjoittaa koodin myös seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">eventHandler</span> <span class="token operator">=</span> response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;promise fulfilled&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes<span class="token punctuation">:</span> response<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>eventHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Muuttujaan <em>eventHandler</em> on sijoitettu viite funktioon. Axiosin metodin get palauttama promise on talletettu muuttujaan <em>promise</em>. Takaisinkutsun rekisteröinti tapahtuu antamalla promisen then-metodin parametrina muuttuja <em>eventHandler</em>, joka viittaa käsittelijäfunktioon.</p>
<p>React-komponenteilla on myös joukko muita <a href="https://reactjs.org/docs/react-component.html">lifecycle-metodeja</a>, palaamme niihin myöhemmin.</p>
<p>Kokeillaan mitä tapahtuu, jos muistiinpanojen tallettavaa kenttää <em>notes</em> ei alusteta konstruktorissa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">//notes: [],</span>
      newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
      showAll<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Seurauksena on ongelmia:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/872ed9895b9514a24a76a0b3ef59988e/14be6/10a.png"/></picture>
<p>Virheen aiheuttaa komento <em>notesToShow.map</em> sillä muuttujan <em>notesToShow</em> arvo ei ole määritelty ja näin ollen metodin <em>map</em> kutsuminen on mahdotonta.</p>
<p>Muuttuja saa arvonsa metodin <em>render</em> alkuosassa:</p>
<div class="gatsby-highlight" data-language="text"><pre><code class="language-text">const notesToShow =
  this.state.showAll ?
    this.state.notes :
    this.state.notes.filter(note =&gt; note.important === true)</code></pre></div>
<p>Koska metodia <em>render</em> kutsutaan ensimmäisen kerran <em>ennen kuin palvelimelta haettava data saapuu</em>, ei tilan kentälle <em>notes</em> ole asetettu mitään arvoa.</p>
<p>Tulet 100% varmuudella törmäämään kurssilla vastaavaan ongelmaan, eli <em>render</em> metodissa on jollain tavalla aina varauduttava siihen, että ensimmäinen renderöitymiskerta tapahtuu ennen kuin palvelimelta haettava data on saapunut.</p>
<p>Palautetaan konstruktori ennalleen.</p>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-4">githubissa</a>, tagissa <em>part2-4</em>.</p>
</div></div>
<div class="banner spacing spacing--after" style="background-color:#EB8755"><div class="container"><div class="course-content col-7 push-right-3" style="border-color:#EB8755">
<h3>Tehtävät 2.11</h3>
<h4>puhelinluettelo osa 6</h4>
<p>Talleta sovelluksen alkutila projektin juureen sijoitettavaan tiedostoon <em>db.json</em>:</p>
<div class="gatsby-highlight" data-language="json"><pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;persons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Arto Hellas&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;040-123456&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Martti Tienari&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;040-123456&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Arto Järvinen&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;040-123456&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Lea Kutvonen&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;040-123456&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Käynnistä json-server porttiin 3001 ja varmista selaimella osoitteesta <a href="http://localhost:3001/persons">http://localhost:3001/persons</a>, että palvelin palauttaa henkilölistan.</p>
<p>Jos saat virheilmoituksen:</p>
<div class="gatsby-highlight" data-language="bash"><pre><code class="language-bash">events.js:182
      throw er<span class="token punctuation">;</span> // Unhandled <span class="token string">&#x27;error&#x27;</span> event
      ^

Error: listen EADDRINUSE 0.0.0.0:3001
    at Object._errnoException <span class="token punctuation">(</span>util.js:1019:11<span class="token punctuation">)</span>
    at _exceptionWithHostPort <span class="token punctuation">(</span>util.js:1041:20<span class="token punctuation">)</span></code></pre></div>
<p>on portti 3001 jo jonkin muun sovelluksen, esim. jo käynnissä olevan json-serverin käytössä. Sulje toinen sovellus tai jos se ei onnistu, vaihda porttia.</p>
<p>Muuta sovellusta siten, että datan alkutila haetaan <em>axios</em>-kirjaston avulla palvelimelta. Hoida datan hakeminen <a href="/osa2#komponenttien-lifecycle-metodit">lifecyclemetodissa</a> <em>componentDidMount</em>.</p>
<h3>Tehtävät 2.12*</h3>
<h4>maiden tiedot</h4>
<p>Rajapinta <a href="https://restcountries.eu">https://restcountries.eu</a> tarjoaa paljon eri maihin liittyvää tietoa koneluettavassa muodossa REST-apina.</p>
<p>Tee sovellus, jonka avulla voit tarkastella eri maiden tietoja. Sovelluksen kannattaa hakea tiedot endpointista <a href="https://restcountries.eu/#api-endpoints-all">all</a>.</p>
<p>Sovelluksen käyttöliittymä on yksinkertainen. Näytettävä maa haetaan kirjoittamalla hakuehto etsintäkenttään.</p>
<p>Jos ehdon täyttäviä maita on liikaa (yli 10), kehoitetaan tarkentamaan hakuehtoa:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/a47ea7bcd82b8c8848e16c0c6fb3617d/14be6/13.png"/></picture>
<p>Jos maita on alle kymmenen, mutta yli 1 näytetään hakuehdon täyttävät maat:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/21c45c6fd07f9da013cab54bdf8935f5/14be6/14.png"/></picture>
<p>Kun ehdon täyttäviä maita on enää yksi, näytetään maan lippu sekä perustiedot:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/4f93ad869b80169444bfff56175c3d1c/14be6/15.png"/></picture>
<p><strong>Huom:</strong> riittää että sovelluksesi toimii suurimmalle osalle maista. Jotkut maat kuten <em>Sudan</em> voivat tuottaa ongelmia, sillä maan nimi on toisen maan <em>South Sudan</em> osa. Näistä corner caseista ei tarvitse välittää.</p>
<h3>Tehtävät 2.13*</h3>
<h4>puhelinluettelo osa 4</h4>
<p><strong>Älä juutu tähän tehtävään!</strong></p>
<p>Paranna edellisen tehtävän maasovellusta siten, että kun sivulla näkyy useiden maiden nimiä, riittää maan nimen klikkaaminen tarkentamaan haun siten, että klikatun maan tarkemmat tiedot saadaan näkyviin.</p>
<p>Huomaa, että saat &quot;nimestä&quot; klikattavan kiinnittämällä nimen sisältävään elementtiin, esim. diviin klikkaustenkuuntelijan:</p>
<div class="gatsby-highlight" data-language="text"><pre><code class="language-text">&lt;div onClick={...}&gt;
  {country.name}
&lt;/div&gt;</code></pre></div>
</div></div></div>
<div class="container"><div class="scroll-navigation col-3 element--flex element--column"><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Web-sovellusten toiminnan perusteet</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b React</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Javascript</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div></div><div class="course-content col-7">
<h2>REST API:n käyttö</h2>
<p>Kun sovelluksella luodaan uusia muistiinpanoja, täytyy ne tallentaa palvelimelle.</p>
<p>json-server mainitsee olevansa ns. REST tai RESTful API</p>
<blockquote>
<p>Get a full fake REST API with zero coding in less than 30 seconds (seriously)</p>
</blockquote>
<p>Ihan alkuperäisen <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">määritelmän</a> mukainen RESTful API json-server ei ole, mutta ei ole kovin moni muukaan itseään REST:iksi kutsuva rajapinta.</p>
<p>Tutustumme REST:iin tarkemmin kurssin <a href="/osa3">seuraavassa osassa</a>, mutta jo nyt on tärkeä ymmärtää minkälaista <a href="https://en.wikipedia.org/wiki/Representational_state_transfer#Applied_to_Web_services">konventiota</a> json-server ja yleisemminkin REST API:t käyttävät <a href="https://github.com/typicode/json-server#routes">reittien</a>, eli URL:ien ja käytettävien HTTP-pyyntöjen tyyppien suhteen.</p>
<p>REST:issä yksittäisiä asioita esim. meidän tapauksessamme muistiinpanoja kutsutaan <em>resursseiksi</em>. Jokaisella resurssilla on yksilöivä osoite eli URL. json-serverin noudattaman yleisen konvention mukaan yksittäistä muistiinpanoa kuvaavan resurssin URL on muotoa <em>notes/3</em>, missä 3 on resurssin tunniste. Osoite <em>notes</em> taas vastaa kaikkien yksittäisten muistiinpanojen kokoelmaa.</p>
<p>Resursseja haetaan palvelimelta HTTP GET -pyynnöillä. Esim. HTTP GET osoitteeseen <em>notes/3</em> palauttaa muistiinpanon, jonka id-kentän arvo on 3. Kun taas HTTP GET -pyyntö osoitteeseen <em>notes</em> palauttaa kaikki muistiinpanot.</p>
<p>Uuden muistiinpanoa vastaavan resurssin luominen tapahtuu json-serverin noudattamassa REST-konventiossa tekemällä HTTP POST -pyyntö, joka kohdistuu myös samaan osoitteeseen <em>notes</em>. Pyynnön mukana sen runkona eli <em>bodynä</em> lähetetään luotavan muistiinpanon tiedot.</p>
<p>json-server vaatii, että tiedot lähetetään JSON-muodossa, eli käytännössä sopivasti muotoiltuna merkkijonona ja asettamalla headerille <em>Content-Type</em> arvo <em>application/json</em>.</p>
<h2>Datan lähetys palvelimelle</h2>
<p>Muutetaan nyt uuden muistiinpanon lisäämisestä huolehtivaa tapahtumankäsittelijää seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">addNote</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> noteObject <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>newNote<span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">,</span> noteObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>eli luodaan muistiinpanoa vastaava olio, ei kuitenkaan lisätä sille kenttää <em>id</em>, parempi jättää id:n generointi palvelimen vastuulle!</p>
<p>Lähetetään sitten olio palvelimelle käyttämällä axiosin metodia <em>post</em>. Rekisteröidään tapahtumankäsittelijä, joka tulostaa konsoliin palvelimen vastauksen.</p>
<p>Kun nyt kokeillaan luoda uusi muistiinpano, konsoliin tulostus näyttää seuraavalta:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/60f7c022db4db463b5a634e05acde7ad/14be6/11.png"/></picture>
<p>Uusi muistiinpano on siis <em>response</em>-olion kentän <em>data</em> arvona. Palvelin on lisännyt muistiinpanolle tunnisteen, eli <em>id</em>-kentän.</p>
<p>Joskus on hyödyllistä tarkastella HTTP-pyyntöjä <a href="/osa0#http-get">osan 0 alussa</a> paljon käytetyn konsolin <em>Network</em>-välilehden kautta:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/d2ccd9eb946dce179331c3b7b077d8d9/14be6/12.png"/></picture>
<p>Voimme esim. tarkastaa onko POST-pyynnön mukana menevä data juuri se mitä oletimme, onko headerit asetettu oikein ym.</p>
<p>Koska POST-pyynnössä lähettämämme data oli Javascript-olio, osasi axios automaattisesti asettaa pyynnön <em>content-type</em> headerille oikean arvon eli <em>application/json</em>.</p>
<p>Uusi muistiinpano ei vielä renderöidy ruudulle, sillä emme aseta komponentille <em>App</em> uutta tilaa muistiinpanon luomisen yhteydessä. Viimeistellään sovellus vielä tältä osin:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">addNote</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> noteObject <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>newNote<span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">,</span> noteObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
      newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Palvelimen palauttama uusi muistiinpano siis lisätään tilassa olevien muiden muistiinpanojen joukkoon (kannattaa <a href="/osa1#taulukon-k%C3%A4sittely%C3%A4">muistaa tärkeä detalji</a> siitä, että metodi <em>concat</em> ei muuta komponentin alkuperäistä tilaa, vaan luo uuden taulukon) ja tyhjennetään lomakkeen teksti.</p>
<p>Kun palvelimella oleva data alkaa vaikuttaa web-sovelluksen toimintalogiikkaan, tulee sovelluskehitykseen heti iso joukko uusia haasteita, joita tuo mukanaan mm. kommunikoinnin asynkronisuus. Debuggaamiseenkin tarvitaan uusia strategiota, debug-printtaukset ym. muuttuvat vain tärkeämmäksi, myös Javascriptin runtimen periaatteita ja React-komponenttien elinkaarta on pakko tuntea riittävällä tasolla, arvaileminen ei riitä.</p>
<p>Palvelimen tilaa kannattaa tarkastella myös suoraan, esim. selaimella:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/352d93979ae65852217997909ddbe704/14be6/13.png"/></picture>
<p>näin on mahdollista varmistua, mm. siirtyykö kaikki oletettu data palvelimelle.</p>
<p>Kurssin seuraavassa osassa alamme toteuttaa itse myös palvelimella olevan sovelluslogiikan, tutustumme silloin tarkemmin palvelimen debuggausta auttaviin työkaluihin, mm. <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop">postmaniin</a>. Tässä vaiheessa json-server-palvelimen tilan tarkkailuun riittänee selain.</p>
<blockquote>
<p><strong>HUOM:</strong> sovelluksen nykyisessä versiossa selain lisää uudelle muistiinpanolle sen luomishetkeä kuvaavan kentän. Koska koneen oma kello voi näyttää periaatteessa mitä sattuu, on aikaleimojen generointi todellisuudessa viisaampaa hoitaa palvelimella ja tulemmekin tekemään tämän muutoksen kurssin seuraavassa osassa.</p>
</blockquote>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-5">githubissa</a>, tagissa <em>part2-5</em>.</p>
<h2>Muistiinpanon tärkeyden muutos</h2>
<p>Lisätään muistiinpanojen yhteyteen painike, millä niiden tärkeyttä voi muuttaa.</p>
<p>Muistiinpanon määrittelevän komponentin muutos on seuraava:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">Note</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> note<span class="token punctuation">,</span> toggleImportance <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> label <span class="token operator">=</span> note<span class="token punctuation">.</span>important <span class="token operator">?</span> <span class="token string">&#x27;make not important&#x27;</span> <span class="token punctuation">:</span> <span class="token string">&#x27;make important&#x27;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>note<span class="token punctuation">.</span>content<span class="token punctuation">}</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>toggleImportance<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Komponentissa on nappi, jolle on rekisteröity klikkaustapahtuman käsittelijäksi propsien avulla välitetty funktio <em>toggleImportance</em>.</p>
<p>Tapahtumankäsittelijän alustava versio on määritelty komponentissa <em>App</em> seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">toggleImportanceOf</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;importance of &#x27;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&#x27; needs to be toggled&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Kyseessä on jälleen funktio, joka palauttaa funktion. Palataan sen sisältöön kohta.</p>
<p>Komponentin <em>App</em> metodissa <em>render</em> välitetään jokaiselle muistiinpanolle tapahtumankäsittelijäfunktio:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  {notesToShow.map(note =&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Note</span>
      <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span>{note.id}</span>
      <span class="token attr-name">note</span><span class="token attr-value"><span class="token punctuation">=</span>{note}</span>
      <span class="token attr-name">toggleImportance</span><span class="token attr-value"><span class="token punctuation">=</span>{this.toggleImportanceOf(note.id)}</span>
    <span class="token punctuation">/&gt;</span></span>
  )}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Jokaisen muistiinpanon tapahtumankäsittelijä on nyt <em>yksilöllinen</em>, sillä se sisältää muistiinpanon <em>id:n</em>. Esim. jos <em>note.id</em> on 3 tulee tapahtumankäsittelijäksi <em>this.toggleImportance(note.id)</em> eli käytännössä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;importance of 3 needs to be toggled&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Eli komponentin <em>App</em> metodi <em>toggleImportanceOf</em> ei itsessään ole tapahtumankäsittelijä, vaan <em>tehdas</em>, jonka avulla kullekin muistiinpanolle luodaan oma tapahtumankäsittelijä.</p>
<p>Pieni huomio tähän väliin. Tapahtumankäsittelijän koodin tulostuksessa muodostetaan tulostettava merkkijono Javan tyyliin plussaamalla stringejä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;importance of &#x27;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&#x27; needs to be toggled&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ES6:n <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template string</a> -ominaisuuden ansiosta Javascriptissa vastaavat merkkijonot voidaan kirjottaa hieman mukavammin:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`importance of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> needs to be toggled`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Merkkijonon sisälle voi nyt määritellä &quot;dollari-aaltosulku&quot;-syntaksilla kohtia, minkä sisälle evaluoidaan javascript-lausekkeita, esim. muuttujan arvo. Huomaa, että template stringien hipsutyyppi poikkeaa Javascriptin normaaleista merkkijonojen käyttämistä hipsuista.</p>
<p>Yksittäistä json-serverillä olevaa muistiinpanoa voi muuttaa kahdella tavalla, joko <em>korvaamalla</em> sen tekemällä HTTP PUT -pyyntö muistiinpanon yksilöivään osoitteeseen tai muuttamalla ainoastaan joidenkin muistiinpanon kenttien arvoja HTTP PATCH -pyynnöllä.</p>
<p>Korvaamme nyt muistiinpanon kokonaan, sillä samalla tulee esille muutama tärkeä React:iin ja Javascriptiin liittyvä seikka.</p>
<p>Metodi on seuraavassa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">toggleImportanceOf</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`http://localhost:3001/notes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> changedNote <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>note<span class="token punctuation">,</span> important<span class="token punctuation">:</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important <span class="token punctuation">}</span><span class="token punctuation">;</span>

    axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> changedNote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span>
          note<span class="token punctuation">.</span>id <span class="token operator">!==</span> id <span class="token operator">?</span> note <span class="token punctuation">:</span> response<span class="token punctuation">.</span>data
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Melkein joka riville sisältyy tärkeitä yksityiskohtia. Ensimmäinen rivi määrittelee jokaiselle muistiinpanolle id-kenttään perustuvan yksilöivän url:in.</p>
<p>Taulukon metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find">find</a> etsitään muutettava muistiinpano ja talletetaan muuttujaan <em>note</em> viite siihen.</p>
<p>Sen jälkeen luodaan <em>uusi olio</em>, jonka sisältö on sama kuin vanhan olion sisältö poislukien kenttä important. Luominen näyttää hieman erikoiselta:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> changedNote <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>note<span class="token punctuation">,</span> important<span class="token punctuation">:</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Kyseessä on vielä standardoimattoman <a href="https://github.com/tc39/proposal-object-rest-spread">object spread</a> -operaation soveltaminen.</p>
<p>Käytännössä <code>{...note}</code> luo olion, jolla on kenttinään kopiot olion <em>note</em> kenttien arvoista. Kun aaltosulkeisiin lisätään asioita, esim. <code>{ ...note, important: true }</code>, tulee uuden olion kenttä <em>important</em> saamaan arvon <em>true</em>. Eli esimerkissämme <em>important</em> saa uudessa oliossa vanhan arvonsa käänteisarvon.</p>
<p>Uusi olio olisi voitu luoda myös vanhemmalla komennolla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> changedNote <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> note<span class="token punctuation">,</span> <span class="token punctuation">{</span>important<span class="token punctuation">:</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important<span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre></div>
<p>Object spread -syntaksi on kuitenkin yleisesti käytössä Reactissa, joten mekin käytämme sitä.</p>
<p>Pari huomioita. Miksi teimme muutettavasta oliosta kopion vaikka myös seuraava koodi näyttää toimivan:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span>
note<span class="token punctuation">.</span>important <span class="token operator">=</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important

axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> note<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code></pre></div>
<p>Näin ei ole suositetavaa tehdä, sillä muuttuja <em>note</em> on viite komponentin tilassa, eli <em>this.state.notes</em>-taulukossa olevaan olioon, ja kuten muistamme tilaa ei Reactissa saa muuttaa suoraan!</p>
<p>Kannattaa myös huomata, että uusi olio <em>changedNote</em> on ainoastaan ns <a href="https://en.wikipedia.org/wiki/Object_copying#Shallow_copy">shallow copy</a>, eli uuden olion kenttien arvoina on vanhan olion kenttien arvot. Jos vanhan olion kentät olisivat itsessään olioita, viittaisivat uuden olion kentät samoihin olioihin.</p>
<p>Uusi muistiinpano lähetetään sitten PUT-pyynnön mukana palvelimelle, jossa se korvaa aiemman muistiinpanon.</p>
<p>Takaisinkutsufunktiossa asetetaan komponentin <em>App</em> tilaan kaikki vanhat muistiinpanot paitsi muuttuneen, josta tilaan asetetaan palvelimen palauttama versio:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> changedNote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span>
      note<span class="token punctuation">.</span>id <span class="token operator">!==</span> id <span class="token operator">?</span> note <span class="token punctuation">:</span> response<span class="token punctuation">.</span>data
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tämä saadaan aikaan metodilla <em>map</em> joka siis luo uuden taulukon vanhan taulukon perusteella. Jokainen uuden taulukon alkio luodaan ehdollisesti siten, että jos ehto <em>note.id !== id</em> on tosi, otetaan uuteen taulukkoon suoraan vanhan taulukon kyseinen alkio. Jos ehto on epätosi, eli kyseessä on muutettu muistiinpano, otetaan uuteen taulukkoon palvelimen palauttama olio.</p>
<p>Käytetty <em>map</em>-kikka saattaa olla aluksi hieman hämmentävä. Asiaa kannattaakin miettiä tovi. Tapaa tullaan käyttämään kurssilla vielä kymmeniä kertoja.</p>
<h2>Palvelimen kanssa tapahtuvan kommunikoinnin eristäminen omaan moduuliin</h2>
<p><em>App</em>-komponentti alkaa kasvaa uhkaavasti kun myös palvelimen kanssa kommunikointi tapahtuu komponentissa. <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Single responsibility</a> -periaatteen hengessä kommunikointi onkin viisainta eristää omaan <a href="#refaktorointia---moduulit">moduuliinsa</a>.</p>
<p>Luodaan hakemisto <em>src/services</em> ja sinne tiedosto <em>notes.js</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#x27;axios&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> baseUrl <span class="token operator">=</span> <span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> newObject <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">,</span> newObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> newObject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> newObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> getAll<span class="token punctuation">,</span> create<span class="token punctuation">,</span> update <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Moduuli palauttaa nyt olion, jonka kenttinä on kolme muistiinpanojen käsittelyä hoitavaa funktiota. Funktiot palauttavat suoraan axiosin metodien palauttaman promisen.</p>
<p>Komponentti <em>App</em> saa moduulin käyttöön <em>import</em>-lauseella</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> noteService <span class="token keyword">from</span> <span class="token string">&#x27;./services/notes&#x27;</span>

App <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span></code></pre></div>
<p>moduulin funktioita käytetään importatun muuttujan <em>noteService</em> kautta seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  noteService
    <span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>notes<span class="token punctuation">:</span> response<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">addNote</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  noteService
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>noteObject<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
        newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">toggleImportanceOf</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    noteService
      <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> changedNote<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>note <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>id <span class="token operator">!==</span> id <span class="token operator">?</span> note <span class="token punctuation">:</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Voisimme viedä ratkaisua vielä askeleen pidemmälle, sillä käyttäessään moduulin funktioita komponentti <em>App</em> saa olion, joka sisältää koko HTTP-pyynnön vastauksen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes<span class="token punctuation">:</span> response<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Eli asia mistä <em>App</em> on kiinnostunut on parametrin kentässä <em>response.data</em>.</p>
<p>Moduulia olisi miellyttävämpi käyttää, jos se HTTP-pyynnön vastauksen sijaan palauttaisi suoraan muistiinpanot sisältävän taulukon. Tällöin moduulin käyttö näyttäisi seuraavalta</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes<span class="token punctuation">:</span> notes <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>joka voitaisiin <a href="#kehittyneempi-tapa-olioliteraalien-kirjoittamiseen">ilmaista hieman tiiviimmin</a> seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>notes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tämä onnistuu muuttamalla moduulin koodia seuraavasti (koodiin jää ikävästi copy-pastea, emme kuitenkaan nyt välitä siitä):</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#x27;axios&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> baseUrl <span class="token operator">=</span> <span class="token string">&#x27;http://localhost:3001/notes&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> newObject <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">,</span> newObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> newObject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> newObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> getAll<span class="token punctuation">,</span> create<span class="token punctuation">,</span> update <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>eli enää ei palautetakaan suoraan axiosin palauttamaa promisea, vaan otetaan promise ensin muuttujaan <em>request</em> ja kutsutaan sille metodia <em>then</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Täydellisessä muodossa kirjoitettuna viimeinen rivi olisi:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Myös nyt funktio <em>getAll</em> palauttaa promisen, sillä promisen metodi <em>then</em> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then">palauttaa promisen</a>.</p>
<p>Koska <em>then</em>:in parametri palauttaa suoraan arvon <em>response.data</em>, on funktion <em>getAll</em> palauttama promise sellainen, että jos HTTP-kutsu onnistuu, antaa promise takaisinkutsulleen HTTP-pyynnön mukana olleen datan, eli se toimii juuri niin kuin haluamme.</p>
<p>Moduulin muutoksen jälkeen täytyy komponentti <em>App</em> muokata <em>noteService</em>:n metodien takaisinkutsujen osalta ottamaan huomioon, että ne palauttavat datan suoraan:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    noteService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes<span class="token punctuation">:</span> response <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">addNote</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    noteService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>noteObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>newNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newNote<span class="token punctuation">)</span><span class="token punctuation">,</span>
        newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">toggleImportanceOf</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>

      noteService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> changedNote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          notes<span class="token punctuation">:</span> notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>changedNote<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Tämä kaikki on hieman monimutkaista ja asian selittäminen varmaan vaan vaikeuttaa sen ymmärtämistä. Internetistä löytyy paljon vaihtelevatasoista materiaalia aiheesta, esim. <a href="https://javascript.info/promise-chaining">tämä</a>.</p>
<p><a href="https://github.com/getify/You-Dont-Know-JS">You do not know JS</a> sarjan kirja &quot;Async and performance&quot; selittää asian <a href="https://github.com/getify/You-Dont-Know-JS/blob/master/async%20%26%20performance/ch3.md">hyvin</a> mutta tarvitsee selitykseen kohtuullisen määrän sivuja.</p>
<p>Promisejen ymmärtäminen on erittäin keskeistä modernissa Javascript-sovelluskehityksessä, joten asiaan kannattaa uhrata kohtuullisessa määrin aikaa.</p>
<h2>Promise ja virheet</h2>
<p>Jos sovelluksemme mahdollistaisi muistiinpanojen poistamisen, voisi syntyä tilanne, missä käyttäjä yrittää muuttaa sellaisen muistiinpanon tärkeyttä, joka on jo poistettu järjestelmästä.</p>
<p>Simuloidaan tälläistä tilannetta &quot;kovakoodaamalla&quot; noteServiceen funktioon <em>getAll</em> muistiinpano, jota ei ole todellisuudessa (eli palvelimella) olemassa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nonExisting <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Tätä muistiinpanoa ei ole palvelimelta&#x27;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&#x27;2017-12-10T17:30:31.098Z&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>nonExisting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Kun valemuistiinpanon tärkeyttä yritetään muuttaa, konsoliin tulee virheilmoitus, joka kertoo palvelimen vastanneen urliin <em>/notes/10000</em> tehtyyn HTTP PUT -pyyntöön statuskoodilla 404 <em>not found</em>:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/2dccb8bbe15f5d18f3416b77104869d0/14be6/14.png"/></picture>
<p>Sovelluksen tulisi pystyä käsittelemään tilanne hallitusti. Jos konsoli ei ole auki, ei käyttäjä huomaa mitään muuta kuin sen, että muistiinpanon tärkeys ei vaihdu napin painelusta huolimatta.</p>
<p>Jo <a href="#axios-ja-promiset">aiemmin</a> mainittiin, että promisella voi olla kolme tilaa. Kun HTTP-pyyntö epäonnistuu, menee pyyntöä vastaava promise tilaan <em>rejected</em>. Emme tällä hetkellä käsittele koodissamme promisen epäonnistumista mitenkään.</p>
<p>Promisen epäonnistuminen <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">käsitellään</a> antamalla <em>then</em> --metodille parametriksi myös toinen takaisinkutsufunktio, jota kutsutaan siinä tapauksessa jos promise epäonnistuu.</p>
<p>Ehkä yleisempi tapa kuin kahden tapahtumankäsittelijän käyttö on liittää promiseen epäonnistumistilanteen käsittelijä kutsumalla metodia <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch">catch</a>.</p>
<p>Käytännössä virhetilanteen käsittelijän rekisteröiminen tapahtuisi seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios
  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://example.com/probably_will_fail&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;success!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;fail&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Jos pyyntö epäonnistuu, kutsutaan <em>catch</em>-metodin avulla rekisteröityä käsittelijää.</p>
<p>Metodia <em>catch</em> hyödynnetään usein siten, että se sijoitetaan syvemmälle promiseketjuun.</p>
<p>Kun sovelluksemme tekee HTTP-operaation syntyy oleellisesti ottaen <a href="https://javascript.info/promise-chaining">promiseketju</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> newObject<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Metodilla <em>catch</em> voidaan määritellä ketjun lopussa käsittelijäfunktio, jota kutsutaan siinä vaiheessa jos mikä tahansa ketjun promisesta epäonnistuu, eli menee tilaan <em>rejected</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">axios
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> newObject<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;fail&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Hyödynnetään tätä ominaisuutta, ja sijoitetaan virheenkäsittelijä komponenttiin <em>App</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">toggleImportanceOf</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> changedNote <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>note<span class="token punctuation">,</span> important<span class="token punctuation">:</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>important <span class="token punctuation">}</span><span class="token punctuation">;</span>

    noteService
      <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> changedNote<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          notes<span class="token punctuation">:</span> notes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>changedNote<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token string">`muistiinpano &#x27;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
            note<span class="token punctuation">.</span>content
          <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#x27; on jo valitettavasti poistettu palvelimelta`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Virheilmoitus annetaan vanhan kunnon <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/alert">alert</a>-dialogin avulla ja palvelimelta poistettu muistiinpano poistetaan tilasta.</p>
<p>Olemattoman muistiinpanon poistaminen siis tapahtuu metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a>, joka muodostaa uuden taulukon, jonka sisällöksi tulee alkuperäisen taulukon sisällöstä ne alkiot, joille parametrina oleva funktio palauttaa arvon true:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span> <span class="token punctuation">}</span></code></pre></div>
<p>Alertia tuskin kannattaa käyttää todellisissa React-sovelluksissa. Opimme kohta kehittyneemmän menetelmän käyttäjille tarkoitettujen tiedotteiden antamiseen. Toisaalta on tilanteita, joissa simppeli battle tested -menetelmä kuten <em>alert</em> riittää aluksi aivan hyvin. Hienomman tavan voi sitten tehdä myöhemmin jos aikaa ja intoa riittää.</p>
<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-6">githubissa</a>, tagissa <em>part2-6</em>.</p>
</div></div>
<div class="banner spacing spacing--after" style="background-color:#EB8755"><div class="container"><div class="course-content col-7 push-right-3" style="border-color:#EB8755">
<h3>Tehtävät 2.14</h3>
<h4>puhelinluettelo osa 7</h4>
<p>Palataan jälleen puhelinluettelon pariin.</p>
<p>Tällä hetkellä luetteloon lisättäviä uusia numeroita ei synkronoida palvelimelle. Korjaa tilanne.</p>
<h3>Tehtävät 2.15</h3>
<h4>puhelinluettelo osa 8</h4>
<p>Siirrä palvelimen kanssa kommunikoinnista vastaava toiminnallisuus omaan moduuliin osan 2 <a href="/osa2/#palvelimen-kanssa-tapahtuvan-kommunikoinnin-erist%C3%A4minen-omaan-moduuliin">esimerkin</a> tapaan.</p>
<h3>Tehtävät 2.16</h3>
<h4>puhelinluettelo osa 9</h4>
<p>Tee ohjelmaan mahdollisuus yhteystietojen poistamiseen. Poistaminen voi tapahtua esim. nimen yhteyteen liitetyllä napilla. Poiston suorittaminen voidaan varmistaa käyttäjältä <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/confirm">window.confirm</a>-metodilla:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/317a917a29c7d9d0860fce84aab3ccd5/14be6/16.png"/></picture>
<p>Palvelimelta tiettyä henkilöä vastaava resurssi tuhotaan tekemällä HTTP DELETE -pyyntö resurssia vastaavaan <em>URL</em>:iin, eli jos poistaisimme esim. käyttäjän, jonka <em>id</em> on 2, tulisi tapauksessamme tehdä HTTP DELETE osoitteeseen <em>localhost:3001/persons/2</em>. Pyynnön mukana ei lähetetä mitään dataa.</p>
<p><a href="https://github.com/axios/axios">Axios</a>-kirjaston avulla HTTP DELETE -pyyntö tehdään samaan tapaan kuin muutkin pyynnöt.</p>
<h3>Tehtävät 2.17*</h3>
<h4>puhelinluettelo osa 10</h4>
<p>Muuta toiminnallisuutta siten, että jos jo olemassaolevalle henkilölle lisätään numero, korvaa lisätty numero aiemman numeron. Korvaaminen kannattaa tehdä HTTP PUT -pyynnöllä.</p>
<p>Jos henkilön tiedot löytyvät jo luettelosta, voi ohjelma kysyä käyttäjältä varmistuksen korvataanko numero:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/651c1945ef229063ffb370db0fcbf80b/14be6/16a.png"/></picture>
</div></div></div>
<div class="container"><div class="scroll-navigation col-3 element--flex element--column"><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Web-sovellusten toiminnan perusteet</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b React</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  ">b Javascript</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div></div><div class="course-content col-7">
<h2>Tyylien lisääminen</h2>
<p>Sovelluksemme ulkoasu on tällä hetkellä hyvin vaatimaton. Osaan 0 liittyvässä <a href="/teht%C3%A4v%C3%A4t/#web-sovellusten-perusteet">tehtävässä 0.1</a> oli tarkoitus tutustua Mozillan <a href="https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/CSS_basics">CSS-tutoriaaliin</a>.</p>
<p>Katsotaan vielä tämän osan lopussa nopeasti erästä tapaa liittää tyylejä React-sovellukseen. Tapoja on useita ja tulemme tarkastelemaan muita myöhemmin. Liitämme nyt CSS:n sovellukseemme vanhan kansan tapaan yksittäisenä, käsin eli ilman <a href="https://developer.mozilla.org/en-US/docs/Glossary/CSS_preprocessor">esiprosessorien</a> apua kirjoitettuna tiedostona (tämä ei itseasiassa ole täysin totta, kuten myöhemmin tulemme huomaamaan).</p>
<p>Tehdään sovelluksen hakemistoon <em>src</em> tiedosto <em>index.css</em> ja liitetään se sovellukseen lisäämällä tiedostoon <em>index.js</em> seuraava import:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token string">&#x27;./index.css&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>Lisätään seuraava sääntö tiedostoon <em>index.css</em>:</p>
<div class="gatsby-highlight" data-language="css"><pre><code class="language-css"><span class="token selector">h1</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>CSS-säännöt koostuvat valitsimesta, eli <em>selektorista</em> ja määrittelystä eli <em>deklaraatiosta</em>. Valitsin määrittelee, mihin elementteihin sääntö kohdistuu. Valitsimena on nyt <em>h1</em>, eli kaikki sovelluksessa käytetyt <em>h1</em>-otsikkotägit.</p>
<p>Määrittelyosa asettaa ominaisuuden <em>color</em>, eli fontin värin arvoksi vihreän, eli <em>green</em>.</p>
<p>Sääntö voi sisältää mielivaltaisen määrän määrittelyjä. Muutetaan edellistä siten, että tekstistä tulee kursivoitua, eli fontin tyyliksi asetetaan <em>italics</em>:</p>
<div class="gatsby-highlight" data-language="css"><pre><code class="language-css"><span class="token selector">h1</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Erilaisia selektoreja eli tapoja valita tyylien kohde on <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors">lukuisia</a>.</p>
<p>Jos haluamme kohdistaa tyylejä esim. jokaiseen muistiinpanoon, voisimme nyt käyttää selektoria <em>li</em>, sillä muistiinpanot ovat <em>li</em>-tagien sisällä:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Note = ({ note, toggleImportance}) =&gt; {
  const label = note.important ? &#x27;make not important&#x27; : &#x27;make important&#x27;
  return (
    &lt;li&gt;{note.content} &lt;button onClick={toggleImportance}&gt;{label}&lt;/button&gt;&lt;/li&gt;
  )
}</code></pre></div>
<p>lisätään tyylitiedostoon seuraava (koska osaamiseni tyylikkäiden web-sivujen tekemiseen on lähellä nollaa, nyt käytettävissä tyyleissä ei ole sinänsä mitään järkeä):</p>
<div class="gatsby-highlight" data-language="css"><pre><code class="language-css"><span class="token selector">li</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Tyylien kohdistaminen elementtityypin sijaan on kuitenkin hieman ongelmallista, jos sovelluksessa olisi myös muita <em>li</em>-tageja, kaikki saisivat samat tyylit.</p>
<p>Jos haluamme kohdistaa tyylit nimenomaan muistiinpanoihin, on parempi käyttää <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Class_selectors">class selectoreja</a>.</p>
<p>Normaalissa HTML:ssä luokat määritellään elementtien attribuutin <em>class</em> arvona:</p>
<div class="gatsby-highlight" data-language="html"><pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>note<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>tekstiä<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>Reactissa tulee kuitenkin classin sijaan käyttää attribuuttia <a href="https://reactjs.org/docs/dom-elements.html#classname">className</a>, eli muutetaan komponenttia <em>Note</em> seuraavasti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Note = ({ note, toggleImportance}) =&gt; {
  const label = note.important ? &#x27;make not important&#x27; : &#x27;make important&#x27;
  return (
    &lt;li className=&quot;note&quot;&gt;
      {note.content} &lt;button onClick={toggleImportance}&gt;{label}&lt;/button&gt;
    &lt;/li&gt;
  )
}</code></pre></div>
<p>Luokkaselektori määritellään syntaksilla <em>.classname</em>, eli:</p>
<div class="gatsby-highlight" data-language="css"><pre><code class="language-css"><span class="token selector">.note</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Jos nyt lisäät sovellukseen muita li-elementtejä, ne eivät saa muistiinpanoille määriteltyjä tyylejä.</p>
<h3>Parempi virheilmoitus</h3>
<p>Toteutimme äsken olemassaolemattoman muistiinpanon tärkeyden muutokseen liittyvän virheilmoituksen <em>alert</em>-metodilla. Toteutetaan se nyt Reactilla omana komponenttinaan.</p>
<p>Komponentti on yksinkertainen:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">const Notification = ({ message }) =&gt; {
  if (message === null) {
    return null
  }
  return (
    &lt;div className=&quot;error&quot;&gt;
      {message}
    &lt;/div&gt;
  )
}</code></pre></div>
<p>Jos propsin <em>message</em> arvo on <em>null</em> ei renderöidä mitään, muussa tapauksessa renderöidään viesti div-elementtiin. Elementille on liitetty tyylien lisäämistä varten luokka <em>error</em>.</p>
<p>Lisätään komponentin <em>App</em> tilaan kenttä <em>error</em> virheviestiä varten, laitetaan kentälle jotain sisältöä, jotta pääsemme heti testaamaan komponenttia:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      notes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      newNote<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
      showAll<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      error<span class="token punctuation">:</span> <span class="token string">&#x27;something went wrong...&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Renderöidään uusi komponentti:</p>
<div class="gatsby-highlight" data-language="react"><pre><code class="language-react">class App extends React.Component {
  render() {
    //...

    return (
      &lt;div&gt;
        &lt;h1&gt;Muistiinpanot&lt;/h1&gt;

        &lt;Notification message={this.state.error}/&gt;

        ...
      &lt;/div&gt;
    )
  }
}</code></pre></div>
<p>Lisätään sitten virheviestille sopiva tyyli:</p>
<div class="gatsby-highlight" data-language="error"><pre><code class="language-error">.error {
  color: red;
  background: lightgrey;
  font-size: 20px;
  border-style: solid;
  border-radius: 5px;
  padding: 10px;
  margin-bottom: 10px;
}</code></pre></div>
<p>Nyt olemme valmiina lisäämään virheviestin logiikan. Alustetaan virheviesti konstruktorissa arvoon <em>null</em> ja muutetaan metodia <em>toggleImportanceOf</em> seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function-variable function">toggleImportanceOf</span> <span class="token operator">=</span> id <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>

    noteService
      <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> changedNote<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changedNote <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          error<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`muistiinpano &#x27;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
            note<span class="token punctuation">.</span>content
          <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#x27; on jo valitettavasti poistettu palvelimelta`</span></span><span class="token punctuation">,</span>
          notes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Eli virheen yhteydessä asetetaan tilan kenttään <em>error</em> sopiva virheviesti. Samalla käynnistetään ajastin, joka asettaa 5 sekunnin kuluttua tilan <em>error</em>-kentän arvoksi <em>null</em>.</p>
<p>Lopputulos näyttää seuraavalta</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/402de74bd283edcbf960eae5b45f6390/14be6/15b.png"/></picture>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/FullStack-HY/part2-notes/tree/part2-7">githubissa</a>, tagissa <em>part2-7</em>.</p>
</div></div>
<div class="banner spacing spacing--after" style="background-color:#EB8755"><div class="container"><div class="course-content col-7 push-right-3" style="border-color:#EB8755">
<h3>Tehtävät 2.18</h3>
<h4>puhelinluettelo osa 11</h4>
<p>Toteuta osan 2 esimerkin <a href="/osa2/#parempi-virheilmoitus">parempi virheilmoitus</a> tyyliin ruudulla muutaman sekunnin näkyvä ilmoitus, joka kertoo onnistuneista operaatioista (henkilön lisäys ja poisto, sekä numeron muutos):</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/e3d2a2214b222843ce8fc575c80a7b7a/14be6/17.png"/></picture>
<h3>Tehtävät 2.19*</h3>
<h4>puhelinluettelo osa 12</h4>
<p>Jos poistat jonkun henkilön toisesta selaimesta hieman ennen kun yrität <em>muuttaa henkilön numeroa</em> toisesta selaimesta, tapahtuu virhetilanne:</p>
<picture><img style="border-color:#EB8755" alt="fullstack content" src="/static/0444c2c661bed5a4a764b2c37e928a9a/14be6/18.png"/></picture>
<p>Korjaa ongelma osan 2 esimerkin <a href="/osa2/#promise-ja-virheet">promise ja virheet</a> tapaan. Loogisin korjaus lienee henkilön lisääminen uudelleen palvelimelle. Toinen vaihtoehto on ilmoittaa käyttäjälle, että muutettavaksi yritettävän henkilön tiedot on jo poistettu.</p>
</div></div></div></div><div class="container spacing element--flex element--column element--centered"><div class="body-text "><p class="body-text__content bold">Tehtävien palautus</p></div><a href="https://studies.cs.helsinki.fi/fullstackopen/" style="padding:1rem 0" class="col-2 centered spacing--small"><div class="triple-border nav-item-hover triple-border--large-margin" style="padding:"><div class="triple-border__container triple-border__return-tasks" style="background-color:transparent">Palauta tehtävät palautussovellukseen</div></div></a></div><div class="container spacing spacing--after-large "><a class="push-right-1" href="/osa1"><div class=" element--flex element--column"><p style="text-align:right">Osa <!-- -->1</p><b>Edellinen osa</b></div></a><a class="push-left-1" href="/osa3"><div class=" element--flex element--column"><p>Osa <!-- -->3</p><b>Seuraava osa</b></div></a></div></div></div><div id="footer" class="container spacing--after" style="justify-content:space-between"><div class="col-4" style="display:flex;justify-content:space-between"><a href="https://www.helsinki.fi/" class="image--large image--contain" style="width:100%"><div class="image image--large image--contain "><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/hgin_yliopisto-30c68104749d830b6cef6ea8c6339b16.png" alt=""/></div></div></a><a href="https://www.houston-inc.com/" class="push-right-2" style="width:100%"><div class="image image--large image--contain "><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/houston_logo-356bd2a9a75b44bdf7897b2cdd387600.png" alt=""/></div></div></a></div><div class="col-2" style="display:flex;justify-content:space-between;align-items:center"><a class="nav-item-hover" style="margin-left:4.5rem" href="/about">KURSSISTA</a><a class="nav-item-hover" href="/faq">FAQs</a></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-content-template-js","jsonName":"osa-2-react-bb8","path":"/osa2/react"};window.dataPath="173/path---osa-2-react-bb-8-7c8-oe9t7piJUnw4ntyTcYNeXOtrGYI";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.f588656cc80a065e5f1e.css","/app-683ebd50c29e203eb678.js"],"component---src-templates-part-intro-template-js":["/component---src-templates-part-intro-template-js.38e4ec59db5f27597a1e.css","/component---src-templates-part-intro-template-js-f8472cc459f1b3cc7861.js"],"component---src-templates-content-template-js":["/component---src-templates-content-template-js.14b7932af346543b0873.css","/component---src-templates-content-template-js-b5141e8f6c7da82f06b2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-1f1b00d5d0daf786f2f9.js"],"component---src-pages-about-js":["/component---src-pages-about-js.e7097f581891269e2d4a.css","/component---src-pages-about-js-1ffc074ab73d0a1f9484.js"],"component---src-pages-companies-js":["/component---src-pages-companies-js-8a966e508857f2c579eb.js"],"component---src-pages-faq-js":["/component---src-pages-faq-js-081220b81e6c91dee12e.js"],"component---src-pages-index-js":["/component---src-pages-index-js.054d4c52cecca6da6c62.css","/component---src-pages-index-js-d7b4f2848985969ebdbc.js"]};/*]]>*/</script><script src="/webpack-runtime-f62914cca2ec440c7bae.js" async=""></script><script src="/2-78e57f9413ee9edc6799.js" async=""></script><script src="/14-58d81fad4e9808f19056.js" async=""></script><script src="/4-6173a9fdc003dfef6b3d.js" async=""></script><script src="/component---src-templates-content-template-js-b5141e8f6c7da82f06b2.js" async=""></script><script src="/app-683ebd50c29e203eb678.js" async=""></script></body></html>